var V=/[$_\p{ID_Start}]/u,Z=/[$_\u200C\u200D\p{ID_Continue}]/u;function q(e,t){return(t?/^[\x00-\xFF]*$/:/^[\x00-\x7F]*$/).test(e)}function L(e,t=!1){const n=[];let r=0;for(;r<e.length;){const o=e[r],c=function(h){if(!t)throw new TypeError(h);n.push({type:"INVALID_CHAR",index:r,value:e[r++]})};if(o==="*"){n.push({type:"ASTERISK",index:r,value:e[r++]});continue}if(o==="+"||o==="?"){n.push({type:"MODIFIER",index:r,value:e[r++]});continue}if(o==="\\"){n.push({type:"ESCAPED_CHAR",index:r++,value:e[r++]});continue}if(o==="{"){n.push({type:"OPEN",index:r,value:e[r++]});continue}if(o==="}"){n.push({type:"CLOSE",index:r,value:e[r++]});continue}if(o===":"){let h="",s=r+1;for(;s<e.length;){const i=e.substr(s,1);if(s===r+1&&V.test(i)||s!==r+1&&Z.test(i)){h+=e[s++];continue}break}if(!h){c(`Missing parameter name at ${r}`);continue}n.push({type:"NAME",index:r,value:h}),r=s;continue}if(o==="("){let h=1,s="",i=r+1,f=!1;if(e[i]==="?"){c(`Pattern cannot start with "?" at ${i}`);continue}for(;i<e.length;){if(!q(e[i],!1)){c(`Invalid character '${e[i]}' at ${i}.`),f=!0;break}if(e[i]==="\\"){s+=e[i++]+e[i++];continue}if(e[i]===")"){if(h--,h===0){i++;break}}else if(e[i]==="("&&(h++,e[i+1]!=="?")){c(`Capturing groups are not allowed at ${i}`),f=!0;break}s+=e[i++]}if(f)continue;if(h){c(`Unbalanced pattern at ${r}`);continue}if(!s){c(`Missing pattern at ${r}`);continue}n.push({type:"PATTERN",index:r,value:s}),r=i;continue}n.push({type:"CHAR",index:r,value:e[r++]})}return n.push({type:"END",index:r,value:""}),n}function N(e,t={}){const n=L(e),{prefixes:r="./"}=t,o=`[^${R(t.delimiter===void 0?"/#?":t.delimiter)}]+?`,c=[];let h=0,s=0,i="",f=new Set;const a=l=>{if(s<n.length&&n[s].type===l)return n[s++].value},p=()=>{const l=a("MODIFIER");return l||a("ASTERISK")},u=l=>{const m=a(l);if(m!==void 0)return m;const{type:b,index:E}=n[s];throw new TypeError(`Unexpected ${b} at ${E}, expected ${l}`)},x=()=>{let l="",m;for(;m=a("CHAR")||a("ESCAPED_CHAR");)l+=m;return l},G=l=>l,P=t.encodePart||G;for(;s<n.length;){const l=a("CHAR"),m=a("NAME");let b=a("PATTERN");if(!m&&!b&&a("ASTERISK")&&(b=".*"),m||b){let S=l||"";r.indexOf(S)===-1&&(i+=S,S=""),i&&(c.push(P(i)),i="");const d=m||h++;if(f.has(d))throw new TypeError(`Duplicate name '${d}'.`);f.add(d),c.push({name:d,prefix:P(S),suffix:"",pattern:b||o,modifier:p()||""});continue}const E=l||a("ESCAPED_CHAR");if(E){i+=E;continue}if(a("OPEN")){const S=x(),d=a("NAME")||"";let y=a("PATTERN")||"";!d&&!y&&a("ASTERISK")&&(y=".*");const K=x();u("CLOSE");const A=p()||"";if(!d&&!y&&!A){i+=S;continue}if(!d&&!y&&!S)continue;i&&(c.push(P(i)),i=""),c.push({name:d||(y?h++:""),pattern:d&&!y?o:y,prefix:P(S),suffix:P(K),modifier:A});continue}i&&(c.push(P(i)),i=""),u("END")}return c}function R(e){return e.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function U(e){return e&&e.ignoreCase?"ui":"u"}function J(e,t){if(!t)return e;const n=/\((?:\?<(.*?)>)?(?!\?)/g;let r=0,o=n.exec(e.source);for(;o;)t.push({name:o[1]||r++,prefix:"",suffix:"",modifier:"",pattern:""}),o=n.exec(e.source);return e}function Q(e,t,n){const r=e.map(o=>D(o,t,n).source);return new RegExp(`(?:${r.join("|")})`,U(n))}function X(e,t,n){return O(N(e,n),t,n)}function O(e,t,n={}){const{strict:r=!1,start:o=!0,end:c=!0,encode:h=a=>a}=n,s=`[${R(n.endsWith===void 0?"":n.endsWith)}]|$`,i=`[${R(n.delimiter===void 0?"/#?":n.delimiter)}]`;let f=o?"^":"";for(const a of e)if(typeof a=="string")f+=R(h(a));else{const p=R(h(a.prefix)),u=R(h(a.suffix));if(a.pattern)if(t&&t.push(a),p||u)if(a.modifier==="+"||a.modifier==="*"){const x=a.modifier==="*"?"?":"";f+=`(?:${p}((?:${a.pattern})(?:${u}${p}(?:${a.pattern}))*)${u})${x}`}else f+=`(?:${p}(${a.pattern})${u})${a.modifier}`;else a.modifier==="+"||a.modifier==="*"?f+=`((?:${a.pattern})${a.modifier})`:f+=`(${a.pattern})${a.modifier}`;else f+=`(?:${p}${u})${a.modifier}`}if(c)r||(f+=`${i}?`),f+=n.endsWith?`(?=${s})`:"$";else{const a=e[e.length-1],p=typeof a=="string"?i.indexOf(a[a.length-1])>-1:a===void 0;r||(f+=`(?:${i}(?=${s}))?`),p||(f+=`(?=${i}|${s})`)}return new RegExp(f,U(n))}function D(e,t,n){return e instanceof RegExp?J(e,t):Array.isArray(e)?Q(e,t,n):X(e,t,n)}var w={delimiter:"",prefixes:"",sensitive:!0,strict:!0},Y={delimiter:".",prefixes:"",sensitive:!0,strict:!0},ee={delimiter:"/",prefixes:"/",sensitive:!0,strict:!0};function te(e,t){return e.length?e[0]==="/"?!0:!t||e.length<2?!1:(e[0]=="\\"||e[0]=="{")&&e[1]=="/":!1}function _(e,t){return e.startsWith(t)?e.substring(t.length,e.length):e}function ne(e,t){return e.endsWith(t)?e.substr(0,e.length-t.length):e}function H(e){return!e||e.length<2?!1:e[0]==="["||(e[0]==="\\"||e[0]==="{")&&e[1]==="["}var j=["ftp","file","http","https","ws","wss"];function M(e){if(!e)return!0;for(const t of j)if(e.test(t))return!0;return!1}function re(e,t){if(e=_(e,"#"),t||e==="")return e;const n=new URL("https://example.com");return n.hash=e,n.hash?n.hash.substring(1,n.hash.length):""}function se(e,t){if(e=_(e,"?"),t||e==="")return e;const n=new URL("https://example.com");return n.search=e,n.search?n.search.substring(1,n.search.length):""}function ie(e,t){return t||e===""?e:H(e)?W(e):z(e)}function ae(e,t){if(t||e==="")return e;const n=new URL("https://example.com");return n.password=e,n.password}function oe(e,t){if(t||e==="")return e;const n=new URL("https://example.com");return n.username=e,n.username}function he(e,t,n){if(n||e==="")return e;if(t&&!j.includes(t))return new URL(`${t}:${e}`).pathname;const r=e[0]=="/";return e=new URL(r?e:"/-"+e,"https://example.com").pathname,r||(e=e.substring(2,e.length)),e}function ce(e,t,n){return F(t)===e&&(e=""),n||e===""?e:B(e)}function fe(e,t){return e=ne(e,":"),t||e===""?e:T(e)}function F(e){switch(e){case"ws":case"http":return"80";case"wws":case"https":return"443";case"ftp":return"21";default:return""}}function T(e){if(e==="")return e;if(/^[-+.A-Za-z0-9]*$/.test(e))return e.toLowerCase();throw new TypeError(`Invalid protocol '${e}'.`)}function ue(e){if(e==="")return e;const t=new URL("https://example.com");return t.username=e,t.username}function le(e){if(e==="")return e;const t=new URL("https://example.com");return t.password=e,t.password}function z(e){if(e==="")return e;if(/[\t\n\r #%/:<>?@[\]^\\|]/g.test(e))throw new TypeError(`Invalid hostname '${e}'`);const t=new URL("https://example.com");return t.hostname=e,t.hostname}function W(e){if(e==="")return e;if(/[^0-9a-fA-F[\]:]/g.test(e))throw new TypeError(`Invalid IPv6 hostname '${e}'`);return e.toLowerCase()}function B(e){if(e===""||/^[0-9]*$/.test(e)&&parseInt(e)<=65535)return e;throw new TypeError(`Invalid port '${e}'.`)}function pe(e){if(e==="")return e;const t=new URL("https://example.com");return t.pathname=e[0]!=="/"?"/-"+e:e,e[0]!=="/"?t.pathname.substring(2,t.pathname.length):t.pathname}function de(e){return e===""?e:new URL(`data:${e}`).pathname}function me(e){if(e==="")return e;const t=new URL("https://example.com");return t.search=e,t.search.substring(1,t.search.length)}function ge(e){if(e==="")return e;const t=new URL("https://example.com");return t.hash=e,t.hash.substring(1,t.hash.length)}var xe=class{constructor(e){this.tokenList=[],this.internalResult={},this.tokenIndex=0,this.tokenIncrement=1,this.componentStart=0,this.state=0,this.groupDepth=0,this.hostnameIPv6BracketDepth=0,this.shouldTreatAsStandardURL=!1,this.input=e}get result(){return this.internalResult}parse(){for(this.tokenList=L(this.input,!0);this.tokenIndex<this.tokenList.length;this.tokenIndex+=this.tokenIncrement){if(this.tokenIncrement=1,this.tokenList[this.tokenIndex].type==="END"){if(this.state===0){this.rewind(),this.isHashPrefix()?this.changeState(9,1):this.isSearchPrefix()?(this.changeState(8,1),this.internalResult.hash=""):(this.changeState(7,0),this.internalResult.search="",this.internalResult.hash="");continue}else if(this.state===2){this.rewindAndSetState(5);continue}this.changeState(10,0);break}if(this.groupDepth>0)if(this.isGroupClose())this.groupDepth-=1;else continue;if(this.isGroupOpen()){this.groupDepth+=1;continue}switch(this.state){case 0:this.isProtocolSuffix()&&(this.internalResult.username="",this.internalResult.password="",this.internalResult.hostname="",this.internalResult.port="",this.internalResult.pathname="",this.internalResult.search="",this.internalResult.hash="",this.rewindAndSetState(1));break;case 1:if(this.isProtocolSuffix()){this.computeShouldTreatAsStandardURL();let e=7,t=1;this.shouldTreatAsStandardURL&&(this.internalResult.pathname="/"),this.nextIsAuthoritySlashes()?(e=2,t=3):this.shouldTreatAsStandardURL&&(e=2),this.changeState(e,t)}break;case 2:this.isIdentityTerminator()?this.rewindAndSetState(3):(this.isPathnameStart()||this.isSearchPrefix()||this.isHashPrefix())&&this.rewindAndSetState(5);break;case 3:this.isPasswordPrefix()?this.changeState(4,1):this.isIdentityTerminator()&&this.changeState(5,1);break;case 4:this.isIdentityTerminator()&&this.changeState(5,1);break;case 5:this.isIPv6Open()?this.hostnameIPv6BracketDepth+=1:this.isIPv6Close()&&(this.hostnameIPv6BracketDepth-=1),this.isPortPrefix()&&!this.hostnameIPv6BracketDepth?this.changeState(6,1):this.isPathnameStart()?this.changeState(7,0):this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 6:this.isPathnameStart()?this.changeState(7,0):this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 7:this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 8:this.isHashPrefix()&&this.changeState(9,1);break}}}changeState(e,t){switch(this.state){case 0:break;case 1:this.internalResult.protocol=this.makeComponentString();break;case 2:break;case 3:this.internalResult.username=this.makeComponentString();break;case 4:this.internalResult.password=this.makeComponentString();break;case 5:this.internalResult.hostname=this.makeComponentString();break;case 6:this.internalResult.port=this.makeComponentString();break;case 7:this.internalResult.pathname=this.makeComponentString();break;case 8:this.internalResult.search=this.makeComponentString();break;case 9:this.internalResult.hash=this.makeComponentString();break}this.changeStateWithoutSettingComponent(e,t)}changeStateWithoutSettingComponent(e,t){this.state=e,this.componentStart=this.tokenIndex+t,this.tokenIndex+=t,this.tokenIncrement=0}rewind(){this.tokenIndex=this.componentStart,this.tokenIncrement=0}rewindAndSetState(e){this.rewind(),this.state=e}safeToken(e){return e<0&&(e=this.tokenList.length-e),e<this.tokenList.length?this.tokenList[e]:this.tokenList[this.tokenList.length-1]}isNonSpecialPatternChar(e,t){const n=this.safeToken(e);return n.value===t&&(n.type==="CHAR"||n.type==="ESCAPED_CHAR"||n.type==="INVALID_CHAR")}isProtocolSuffix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}nextIsAuthoritySlashes(){return this.isNonSpecialPatternChar(this.tokenIndex+1,"/")&&this.isNonSpecialPatternChar(this.tokenIndex+2,"/")}isIdentityTerminator(){return this.isNonSpecialPatternChar(this.tokenIndex,"@")}isPasswordPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}isPortPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}isPathnameStart(){return this.isNonSpecialPatternChar(this.tokenIndex,"/")}isSearchPrefix(){if(this.isNonSpecialPatternChar(this.tokenIndex,"?"))return!0;if(this.tokenList[this.tokenIndex].value!=="?")return!1;const e=this.safeToken(this.tokenIndex-1);return e.type!=="NAME"&&e.type!=="PATTERN"&&e.type!=="CLOSE"&&e.type!=="ASTERISK"}isHashPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,"#")}isGroupOpen(){return this.tokenList[this.tokenIndex].type=="OPEN"}isGroupClose(){return this.tokenList[this.tokenIndex].type=="CLOSE"}isIPv6Open(){return this.isNonSpecialPatternChar(this.tokenIndex,"[")}isIPv6Close(){return this.isNonSpecialPatternChar(this.tokenIndex,"]")}makeComponentString(){const e=this.tokenList[this.tokenIndex],t=this.safeToken(this.componentStart).index;return this.input.substring(t,e.index)}computeShouldTreatAsStandardURL(){const e={};Object.assign(e,w),e.encodePart=T;const t=D(this.makeComponentString(),void 0,e);this.shouldTreatAsStandardURL=M(t)}},$=["protocol","username","password","hostname","port","pathname","search","hash"],k="*";function v(e,t){if(typeof e!="string")throw new TypeError("parameter 1 is not of type 'string'.");const n=new URL(e,t);return{protocol:n.protocol.substring(0,n.protocol.length-1),username:n.username,password:n.password,hostname:n.hostname,port:n.port,pathname:n.pathname,search:n.search!=""?n.search.substring(1,n.search.length):void 0,hash:n.hash!=""?n.hash.substring(1,n.hash.length):void 0}}function g(e,t){return t?I(e):e}function C(e,t,n){let r;if(typeof t.baseURL=="string")try{r=new URL(t.baseURL),e.protocol=g(r.protocol.substring(0,r.protocol.length-1),n),e.username=g(r.username,n),e.password=g(r.password,n),e.hostname=g(r.hostname,n),e.port=g(r.port,n),e.pathname=g(r.pathname,n),e.search=g(r.search.substring(1,r.search.length),n),e.hash=g(r.hash.substring(1,r.hash.length),n)}catch{throw new TypeError(`invalid baseURL '${t.baseURL}'.`)}if(typeof t.protocol=="string"&&(e.protocol=fe(t.protocol,n)),typeof t.username=="string"&&(e.username=oe(t.username,n)),typeof t.password=="string"&&(e.password=ae(t.password,n)),typeof t.hostname=="string"&&(e.hostname=ie(t.hostname,n)),typeof t.port=="string"&&(e.port=ce(t.port,e.protocol,n)),typeof t.pathname=="string"){if(e.pathname=t.pathname,r&&!te(e.pathname,n)){const o=r.pathname.lastIndexOf("/");o>=0&&(e.pathname=g(r.pathname.substring(0,o+1),n)+e.pathname)}e.pathname=he(e.pathname,e.protocol,n)}return typeof t.search=="string"&&(e.search=se(t.search,n)),typeof t.hash=="string"&&(e.hash=re(t.hash,n)),e}function I(e){return e.replace(/([+*?:{}()\\])/g,"\\$1")}function Se(e){return e.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function ke(e,t){const n=".*",r=`[^${Se(t.delimiter===void 0?"/#?":t.delimiter)}]+?`,o=/[$_\u200C\u200D\p{ID_Continue}]/u;let c="";for(let h=0;h<e.length;++h){const s=e[h],i=h>0?e[h-1]:null,f=h<e.length-1?e[h+1]:null;if(typeof s=="string"){c+=I(s);continue}if(s.pattern===""){if(s.modifier===""){c+=I(s.prefix);continue}c+=`{${I(s.prefix)}}${s.modifier}`;continue}const a=typeof s.name!="number",p=t.prefixes!==void 0?t.prefixes:"./";let u=s.suffix!==""||s.prefix!==""&&(s.prefix.length!==1||!p.includes(s.prefix));if(!u&&a&&s.pattern===r&&s.modifier===""&&f&&!f.prefix&&!f.suffix)if(typeof f=="string"){const x=f.length>0?f[0]:"";u=o.test(x)}else u=typeof f.name=="number";if(!u&&s.prefix===""&&i&&typeof i=="string"&&i.length>0){const x=i[i.length-1];u=p.includes(x)}u&&(c+="{"),c+=I(s.prefix),a&&(c+=`:${s.name}`),s.pattern===n?!a&&(!i||typeof i=="string"||i.modifier||u||s.prefix!=="")?c+="*":c+=`(${n})`:s.pattern===r?a||(c+=`(${r})`):c+=`(${s.pattern})`,s.pattern===r&&a&&s.suffix!==""&&o.test(s.suffix[0])&&(c+="\\"),c+=I(s.suffix),u&&(c+="}"),c+=s.modifier}return c}var we=class{constructor(e={},t,n){this.regexp={},this.keys={},this.component_pattern={};try{let r;if(typeof t=="string"?r=t:n=t,typeof e=="string"){const s=new xe(e);if(s.parse(),e=s.result,r===void 0&&typeof e.protocol!="string")throw new TypeError("A base URL must be provided for a relative constructor string.");e.baseURL=r}else{if(!e||typeof e!="object")throw new TypeError("parameter 1 is not of type 'string' and cannot convert to dictionary.");if(r)throw new TypeError("parameter 1 is not of type 'string'.")}typeof n>"u"&&(n={ignoreCase:!1});const o={ignoreCase:n.ignoreCase===!0},c={pathname:k,protocol:k,username:k,password:k,hostname:k,port:k,search:k,hash:k};this.pattern=C(c,e,!0),F(this.pattern.protocol)===this.pattern.port&&(this.pattern.port="");let h;for(h of $){if(!(h in this.pattern))continue;const s={},i=this.pattern[h];switch(this.keys[h]=[],h){case"protocol":Object.assign(s,w),s.encodePart=T;break;case"username":Object.assign(s,w),s.encodePart=ue;break;case"password":Object.assign(s,w),s.encodePart=le;break;case"hostname":Object.assign(s,Y),H(i)?s.encodePart=W:s.encodePart=z;break;case"port":Object.assign(s,w),s.encodePart=B;break;case"pathname":M(this.regexp.protocol)?(Object.assign(s,ee,o),s.encodePart=pe):(Object.assign(s,w,o),s.encodePart=de);break;case"search":Object.assign(s,w,o),s.encodePart=me;break;case"hash":Object.assign(s,w,o),s.encodePart=ge;break}try{const f=N(i,s);this.regexp[h]=O(f,this.keys[h],s),this.component_pattern[h]=ke(f,s)}catch{throw new TypeError(`invalid ${h} pattern '${this.pattern[h]}'.`)}}}catch(r){throw new TypeError(`Failed to construct 'URLPattern': ${r.message}`)}}test(e={},t){let n={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof e!="string"&&t)throw new TypeError("parameter 1 is not of type 'string'.");if(typeof e>"u")return!1;try{typeof e=="object"?n=C(n,e,!1):n=C(n,v(e,t),!1)}catch{return!1}let r;for(r of $)if(!this.regexp[r].exec(n[r]))return!1;return!0}exec(e={},t){let n={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof e!="string"&&t)throw new TypeError("parameter 1 is not of type 'string'.");if(typeof e>"u")return;try{typeof e=="object"?n=C(n,e,!1):n=C(n,v(e,t),!1)}catch{return null}let r={};t?r.inputs=[e,t]:r.inputs=[e];let o;for(o of $){let c=this.regexp[o].exec(n[o]);if(!c)return null;let h={};for(let[s,i]of this.keys[o].entries())if(typeof i.name=="string"||typeof i.name=="number"){let f=c[s+1];h[i.name]=f}r[o]={input:n[o]||"",groups:h}}return r}get protocol(){return this.component_pattern.protocol}get username(){return this.component_pattern.username}get password(){return this.component_pattern.password}get hostname(){return this.component_pattern.hostname}get port(){return this.component_pattern.port}get pathname(){return this.component_pattern.pathname}get search(){return this.component_pattern.search}get hash(){return this.component_pattern.hash}};globalThis.URLPattern||(globalThis.URLPattern=we);export{we as URLPattern};
