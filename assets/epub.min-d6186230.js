import{a as Lt}from"./_commonjs-dynamic-modules-3f1b5830.js";import{r as Dt}from"./jszip.min-50baae81.js";function jt(_t,kt){for(var Ct=0;Ct<kt.length;Ct++){const V=kt[Ct];if(typeof V!="string"&&!Array.isArray(V)){for(const P in V)if(P!=="default"&&!(P in _t)){const N=Object.getOwnPropertyDescriptor(V,P);N&&Object.defineProperty(_t,P,N.get?N:{enumerable:!0,get:()=>V[P]})}}}return Object.freeze(Object.defineProperty(_t,Symbol.toStringTag,{value:"Module"}))}var It={},Pt={get exports(){return It},set exports(_t){It=_t}};(function(_t,kt){(function(Ct,V){_t.exports=V(Dt())})(window,function(Ct){return function(V){var P={};function N(A){if(P[A])return P[A].exports;var j=P[A]={i:A,l:!1,exports:{}};return V[A].call(j.exports,j,j.exports,N),j.l=!0,j.exports}return N.m=V,N.c=P,N.d=function(A,j,x){N.o(A,j)||Object.defineProperty(A,j,{enumerable:!0,get:x})},N.r=function(A){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(A,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(A,"__esModule",{value:!0})},N.t=function(A,j){if(1&j&&(A=N(A)),8&j||4&j&&typeof A=="object"&&A&&A.__esModule)return A;var x=Object.create(null);if(N.r(x),Object.defineProperty(x,"default",{enumerable:!0,value:A}),2&j&&typeof A!="string")for(var v in A)N.d(x,v,function(h){return A[h]}.bind(null,v));return x},N.n=function(A){var j=A&&A.__esModule?function(){return A.default}:function(){return A};return N.d(j,"a",j),j},N.o=function(A,j){return Object.prototype.hasOwnProperty.call(A,j)},N.p="/dist/",N(N.s=30)}([function(V,P,N){N.r(P),N.d(P,"requestAnimationFrame",function(){return j}),N.d(P,"uuid",function(){return v}),N.d(P,"documentHeight",function(){return h}),N.d(P,"isElement",function(){return p}),N.d(P,"isNumber",function(){return u}),N.d(P,"isFloat",function(){return b}),N.d(P,"prefixed",function(){return T}),N.d(P,"defaults",function(){return m}),N.d(P,"extend",function(){return y}),N.d(P,"insert",function(){return k}),N.d(P,"locationOf",function(){return n}),N.d(P,"indexOfSorted",function(){return e}),N.d(P,"bounds",function(){return s}),N.d(P,"borders",function(){return d}),N.d(P,"nodeBounds",function(){return l}),N.d(P,"windowBounds",function(){return f}),N.d(P,"indexOfNode",function(){return i}),N.d(P,"indexOfTextNode",function(){return w}),N.d(P,"indexOfElementNode",function(){return C}),N.d(P,"isXml",function(){return L}),N.d(P,"createBlob",function(){return F}),N.d(P,"createBlobUrl",function(){return W}),N.d(P,"revokeBlobUrl",function(){return q}),N.d(P,"createBase64Url",function(){return G}),N.d(P,"type",function(){return Y}),N.d(P,"parse",function(){return Q}),N.d(P,"qs",function(){return et}),N.d(P,"qsa",function(){return it}),N.d(P,"qsp",function(){return tt}),N.d(P,"sprint",function(){return ht}),N.d(P,"treeWalker",function(){return ft}),N.d(P,"walk",function(){return nt}),N.d(P,"blob2base64",function(){return ct}),N.d(P,"defer",function(){return yt}),N.d(P,"querySelectorByType",function(){return bt}),N.d(P,"findChildren",function(){return at}),N.d(P,"parents",function(){return dt}),N.d(P,"filterChildren",function(){return mt}),N.d(P,"getParentByTagName",function(){return Et}),N.d(P,"RangeObject",function(){return vt});var A=N(15);const j=typeof window<"u"&&(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame),x=typeof URL<"u"?URL:typeof window<"u"?window.URL||window.webkitURL||window.mozURL:void 0;function v(){var o=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var c=(o+16*Math.random())%16|0;return o=Math.floor(o/16),(t=="x"?c:7&c|8).toString(16)})}function h(){return Math.max(document.documentElement.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight)}function p(o){return!(!o||o.nodeType!=1)}function u(o){return!isNaN(parseFloat(o))&&isFinite(o)}function b(o){let t=parseFloat(o);return u(o)!==!1&&(typeof o=="string"&&o.indexOf(".")>-1||Math.floor(t)!==t)}function T(o){var t=["-webkit-","-webkit-","-moz-","-o-","-ms-"],c=o.toLowerCase(),S=["Webkit","webkit","Moz","O","ms"].length;if(typeof document>"u"||document.body.style[c]!==void 0)return o;for(var R=0;R<S;R++)if(document.body.style[t[R]+c]!==void 0)return t[R]+c;return o}function m(o){for(var t=1,c=arguments.length;t<c;t++){var S=arguments[t];for(var R in S)o[R]===void 0&&(o[R]=S[R])}return o}function y(o){var t=[].slice.call(arguments,1);return t.forEach(function(c){c&&Object.getOwnPropertyNames(c).forEach(function(S){Object.defineProperty(o,S,Object.getOwnPropertyDescriptor(c,S))})}),o}function k(o,t,c){var S=n(o,t,c);return t.splice(S,0,o),S}function n(o,t,c,S,R){var z,U=S||0,X=R||t.length,$=parseInt(U+(X-U)/2);return c||(c=function(J,ot){return J>ot?1:J<ot?-1:J==ot?0:void 0}),X-U<=0?$:(z=c(t[$],o),X-U==1?z>=0?$:$+1:z===0?$:z===-1?n(o,t,c,$,X):n(o,t,c,U,$))}function e(o,t,c,S,R){var z,U=S||0,X=R||t.length,$=parseInt(U+(X-U)/2);return c||(c=function(J,ot){return J>ot?1:J<ot?-1:J==ot?0:void 0}),X-U<=0?-1:(z=c(t[$],o),X-U==1?z===0?$:-1:z===0?$:z===-1?e(o,t,c,$,X):e(o,t,c,U,$))}function s(o){var t=window.getComputedStyle(o),c=0,S=0;return["width","paddingRight","paddingLeft","marginRight","marginLeft","borderRightWidth","borderLeftWidth"].forEach(function(R){c+=parseFloat(t[R])||0}),["height","paddingTop","paddingBottom","marginTop","marginBottom","borderTopWidth","borderBottomWidth"].forEach(function(R){S+=parseFloat(t[R])||0}),{height:S,width:c}}function d(o){var t=window.getComputedStyle(o),c=0,S=0;return["paddingRight","paddingLeft","marginRight","marginLeft","borderRightWidth","borderLeftWidth"].forEach(function(R){c+=parseFloat(t[R])||0}),["paddingTop","paddingBottom","marginTop","marginBottom","borderTopWidth","borderBottomWidth"].forEach(function(R){S+=parseFloat(t[R])||0}),{height:S,width:c}}function l(o){let t,c=o.ownerDocument;if(o.nodeType==Node.TEXT_NODE){let S=c.createRange();S.selectNodeContents(o),t=S.getBoundingClientRect()}else t=o.getBoundingClientRect();return t}function f(){var o=window.innerWidth,t=window.innerHeight;return{top:0,left:0,right:o,bottom:t,width:o,height:t}}function i(o,t){for(var c,S=o.parentNode.childNodes,R=-1,z=0;z<S.length&&((c=S[z]).nodeType===t&&R++,c!=o);z++);return R}function w(o){return i(o,3)}function C(o){return i(o,1)}function L(o){return["xml","opf","ncx"].indexOf(o)>-1}function F(o,t){return new Blob([o],{type:t})}function W(o,t){var c=F(o,t);return x.createObjectURL(c)}function q(o){return x.revokeObjectURL(o)}function G(o,t){if(typeof o=="string")return"data:"+t+";base64,"+btoa(o)}function Y(o){return Object.prototype.toString.call(o).slice(8,-1)}function Q(o,t,c){var S;return S=typeof DOMParser>"u"||c?A.DOMParser:DOMParser,o.charCodeAt(0)===65279&&(o=o.slice(1)),new S().parseFromString(o,t)}function et(o,t){var c;if(!o)throw new Error("No Element Provided");return o.querySelector!==void 0?o.querySelector(t):(c=o.getElementsByTagName(t)).length?c[0]:void 0}function it(o,t){return o.querySelector!==void 0?o.querySelectorAll(t):o.getElementsByTagName(t)}function tt(o,t,c){var S,R;if(o.querySelector!==void 0){for(var z in t+="[",c)t+=z+"~='"+c[z]+"'";return t+="]",o.querySelector(t)}if(S=o.getElementsByTagName(t),R=Array.prototype.slice.call(S,0).filter(function(U){for(var X in c)if(U.getAttribute(X)===c[X])return!0;return!1}))return R[0]}function ht(o,t){(o.ownerDocument||o).createTreeWalker!==void 0?ft(o,t,NodeFilter.SHOW_TEXT):nt(o,function(c){c&&c.nodeType===3&&t(c)})}function ft(o,t,c){var S=document.createTreeWalker(o,c,null,!1);let R;for(;R=S.nextNode();)t(R)}function nt(o,t){if(t(o))return!0;if(o=o.firstChild)do{if(nt(o,t))return!0;o=o.nextSibling}while(o)}function ct(o){return new Promise(function(t,c){var S=new FileReader;S.readAsDataURL(o),S.onloadend=function(){t(S.result)}})}function yt(){this.resolve=null,this.reject=null,this.id=v(),this.promise=new Promise((o,t)=>{this.resolve=o,this.reject=t}),Object.freeze(this)}function bt(o,t,c){var S;if(o.querySelector!==void 0&&(S=o.querySelector(`${t}[*|type="${c}"]`)),S&&S.length!==0)return S;S=it(o,t);for(var R=0;R<S.length;R++)if(S[R].getAttributeNS("http://www.idpf.org/2007/ops","type")===c||S[R].getAttribute("epub:type")===c)return S[R]}function at(o){for(var t=[],c=o.childNodes,S=0;S<c.length;S++){let R=c[S];R.nodeType===1&&t.push(R)}return t}function dt(o){for(var t=[o];o;o=o.parentNode)t.unshift(o);return t}function mt(o,t,c){for(var S=[],R=o.childNodes,z=0;z<R.length;z++){let U=R[z];if(U.nodeType===1&&U.nodeName.toLowerCase()===t){if(c)return U;S.push(U)}}if(!c)return S}function Et(o,t){let c;if(o!==null&&t!=="")for(c=o.parentNode;c.nodeType===1;){if(c.tagName.toLowerCase()===t)return c;c=c.parentNode}}class vt{constructor(){this.collapsed=!1,this.commonAncestorContainer=void 0,this.endContainer=void 0,this.endOffset=void 0,this.startContainer=void 0,this.startOffset=void 0}setStart(t,c){this.startContainer=t,this.startOffset=c,this.endContainer?this.commonAncestorContainer=this._commonAncestorContainer():this.collapse(!0),this._checkCollapsed()}setEnd(t,c){this.endContainer=t,this.endOffset=c,this.startContainer?(this.collapsed=!1,this.commonAncestorContainer=this._commonAncestorContainer()):this.collapse(!1),this._checkCollapsed()}collapse(t){this.collapsed=!0,t?(this.endContainer=this.startContainer,this.endOffset=this.startOffset,this.commonAncestorContainer=this.startContainer.parentNode):(this.startContainer=this.endContainer,this.startOffset=this.endOffset,this.commonAncestorContainer=this.endOffset.parentNode)}selectNode(t){let c=t.parentNode,S=Array.prototype.indexOf.call(c.childNodes,t);this.setStart(c,S),this.setEnd(c,S+1)}selectNodeContents(t){t.childNodes[t.childNodes-1];let c=t.nodeType===3?t.textContent.length:parent.childNodes.length;this.setStart(t,0),this.setEnd(t,c)}_commonAncestorContainer(t,c){var S=dt(t||this.startContainer),R=dt(c||this.endContainer);if(S[0]==R[0]){for(var z=0;z<S.length;z++)if(S[z]!=R[z])return S[z-1]}}_checkCollapsed(){this.startContainer===this.endContainer&&this.startOffset===this.endOffset?this.collapsed=!0:this.collapsed=!1}toString(){}}},function(V,P,N){N.d(P,"b",function(){return A}),N.d(P,"a",function(){return j}),N.d(P,"c",function(){return x});const A="0.3",j=["keydown","keyup","keypressed","mouseup","mousedown","mousemove","click","touchend","touchstart","touchmove"],x={BOOK:{OPEN_FAILED:"openFailed"},CONTENTS:{EXPAND:"expand",RESIZE:"resize",SELECTED:"selected",SELECTED_RANGE:"selectedRange",LINK_CLICKED:"linkClicked"},LOCATIONS:{CHANGED:"changed"},MANAGERS:{RESIZE:"resize",RESIZED:"resized",ORIENTATION_CHANGE:"orientationchange",ADDED:"added",SCROLL:"scroll",SCROLLED:"scrolled",REMOVED:"removed"},VIEWS:{AXIS:"axis",WRITING_MODE:"writingMode",LOAD_ERROR:"loaderror",RENDERED:"rendered",RESIZED:"resized",DISPLAYED:"displayed",SHOWN:"shown",HIDDEN:"hidden",MARK_CLICKED:"markClicked"},RENDITION:{STARTED:"started",ATTACHED:"attached",DISPLAYED:"displayed",DISPLAY_ERROR:"displayerror",RENDERED:"rendered",REMOVED:"removed",RESIZED:"resized",ORIENTATION_CHANGE:"orientationchange",LOCATION_CHANGED:"locationChanged",RELOCATED:"relocated",MARK_CLICKED:"markClicked",SELECTED:"selected",LAYOUT:"layout"},LAYOUT:{UPDATED:"updated"},ANNOTATION:{ATTACH:"attach",DETACH:"detach"}}},function(V,P,N){var A=N(0);class j{constructor(v,h,p){var u;if(this.str="",this.base={},this.spinePos=0,this.range=!1,this.path={},this.start=null,this.end=null,!(this instanceof j))return new j(v,h,p);if(typeof h=="string"?this.base=this.parseComponent(h):typeof h=="object"&&h.steps&&(this.base=h),(u=this.checkType(v))==="string")return this.str=v,Object(A.extend)(this,this.parse(v));if(u==="range")return Object(A.extend)(this,this.fromRange(v,this.base,p));if(u==="node")return Object(A.extend)(this,this.fromNode(v,this.base,p));if(u==="EpubCFI"&&v.path)return v;if(v)throw new TypeError("not a valid argument for EpubCFI");return this}checkType(v){return this.isCfiString(v)?"string":!v||typeof v!="object"||Object(A.type)(v)!=="Range"&&v.startContainer===void 0?v&&typeof v=="object"&&v.nodeType!==void 0?"node":!!(v&&typeof v=="object"&&v instanceof j)&&"EpubCFI":"range"}parse(v){var h,p,u,b={spinePos:-1,range:!1,base:{},path:{},start:null,end:null};return typeof v!="string"?{spinePos:-1}:(v.indexOf("epubcfi(")===0&&v[v.length-1]===")"&&(v=v.slice(8,v.length-1)),(h=this.getChapterComponent(v))?(b.base=this.parseComponent(h),p=this.getPathComponent(v),b.path=this.parseComponent(p),(u=this.getRange(v))&&(b.range=!0,b.start=this.parseComponent(u[0]),b.end=this.parseComponent(u[1])),b.spinePos=b.base.steps[1].index,b):{spinePos:-1})}parseComponent(v){var h,p={steps:[],terminal:{offset:null,assertion:null}},u=v.split(":"),b=u[0].split("/");return u.length>1&&(h=u[1],p.terminal=this.parseTerminal(h)),b[0]===""&&b.shift(),p.steps=b.map(function(T){return this.parseStep(T)}.bind(this)),p}parseStep(v){var h,p,u,b,T;if((b=v.match(/\[(.*)\]/))&&b[1]&&(T=b[1]),p=parseInt(v),!isNaN(p))return p%2==0?(h="element",u=p/2-1):(h="text",u=(p-1)/2),{type:h,index:u,id:T||null}}parseTerminal(v){var h,p,u=v.match(/\[(.*)\]/);return u&&u[1]?(h=parseInt(v.split("[")[0]),p=u[1]):h=parseInt(v),Object(A.isNumber)(h)||(h=null),{offset:h,assertion:p}}getChapterComponent(v){return v.split("!")[0]}getPathComponent(v){var h=v.split("!");if(h[1])return h[1].split(",")[0]}getRange(v){var h=v.split(",");return h.length===3&&[h[1],h[2]]}getCharecterOffsetComponent(v){return v.split(":")[1]||""}joinSteps(v){return v?v.map(function(h){var p="";return h.type==="element"&&(p+=2*(h.index+1)),h.type==="text"&&(p+=1+2*h.index),h.id&&(p+="["+h.id+"]"),p}).join("/"):""}segmentString(v){var h="/";return h+=this.joinSteps(v.steps),v.terminal&&v.terminal.offset!=null&&(h+=":"+v.terminal.offset),v.terminal&&v.terminal.assertion!=null&&(h+="["+v.terminal.assertion+"]"),h}toString(){var v="epubcfi(";return v+=this.segmentString(this.base),v+="!",v+=this.segmentString(this.path),this.range&&this.start&&(v+=",",v+=this.segmentString(this.start)),this.range&&this.end&&(v+=",",v+=this.segmentString(this.end)),v+=")"}compare(v,h){var p,u,b,T;if(typeof v=="string"&&(v=new j(v)),typeof h=="string"&&(h=new j(h)),v.spinePos>h.spinePos)return 1;if(v.spinePos<h.spinePos)return-1;v.range?(p=v.path.steps.concat(v.start.steps),b=v.start.terminal):(p=v.path.steps,b=v.path.terminal),h.range?(u=h.path.steps.concat(h.start.steps),T=h.start.terminal):(u=h.path.steps,T=h.path.terminal);for(var m=0;m<p.length;m++){if(!p[m])return-1;if(!u[m]||p[m].index>u[m].index)return 1;if(p[m].index<u[m].index)return-1}return p.length<u.length?-1:b.offset>T.offset?1:b.offset<T.offset?-1:0}step(v){var h=v.nodeType===3?"text":"element";return{id:v.id,tagName:v.tagName,type:h,index:this.position(v)}}filteredStep(v,h){var p,u=this.filter(v,h);if(u)return p=u.nodeType===3?"text":"element",{id:u.id,tagName:u.tagName,type:p,index:this.filteredPosition(u,h)}}pathTo(v,h,p){for(var u,b={steps:[],terminal:{offset:null,assertion:null}},T=v;T&&T.parentNode&&T.parentNode.nodeType!=9;)(u=p?this.filteredStep(T,p):this.step(T))&&b.steps.unshift(u),T=T.parentNode;return h!=null&&h>=0&&(b.terminal.offset=h,b.steps[b.steps.length-1].type!="text"&&b.steps.push({type:"text",index:0})),b}equalStep(v,h){return!(!v||!h)&&v.index===h.index&&v.id===h.id&&v.type===h.type}fromRange(v,h,p){var u={range:!1,base:{},path:{},start:null,end:null},b=v.startContainer,T=v.endContainer,m=v.startOffset,y=v.endOffset,k=!1;if(p&&(k=b.ownerDocument.querySelector("."+p)!=null),typeof h=="string"?(u.base=this.parseComponent(h),u.spinePos=u.base.steps[1].index):typeof h=="object"&&(u.base=h),v.collapsed)k&&(m=this.patchOffset(b,m,p)),u.path=this.pathTo(b,m,p);else{u.range=!0,k&&(m=this.patchOffset(b,m,p)),u.start=this.pathTo(b,m,p),k&&(y=this.patchOffset(T,y,p)),u.end=this.pathTo(T,y,p),u.path={steps:[],terminal:null};var n,e=u.start.steps.length;for(n=0;n<e&&this.equalStep(u.start.steps[n],u.end.steps[n]);n++)n===e-1?u.start.terminal===u.end.terminal&&(u.path.steps.push(u.start.steps[n]),u.range=!1):u.path.steps.push(u.start.steps[n]);u.start.steps=u.start.steps.slice(u.path.steps.length),u.end.steps=u.end.steps.slice(u.path.steps.length)}return u}fromNode(v,h,p){var u={range:!1,base:{},path:{},start:null,end:null};return typeof h=="string"?(u.base=this.parseComponent(h),u.spinePos=u.base.steps[1].index):typeof h=="object"&&(u.base=h),u.path=this.pathTo(v,null,p),u}filter(v,h){var p,u,b,T,m,y=!1;return v.nodeType===3?(y=!0,b=v.parentNode,p=v.parentNode.classList.contains(h)):(y=!1,p=v.classList.contains(h)),p&&y?(T=b.previousSibling,m=b.nextSibling,T&&T.nodeType===3?u=T:m&&m.nodeType===3&&(u=m),u||v):!(p&&!y)&&v}patchOffset(v,h,p){if(v.nodeType!=3)throw new Error("Anchor must be a text node");var u=v,b=h;for(v.parentNode.classList.contains(p)&&(u=v.parentNode);u.previousSibling;){if(u.previousSibling.nodeType===1){if(!u.previousSibling.classList.contains(p))break;b+=u.previousSibling.textContent.length}else b+=u.previousSibling.textContent.length;u=u.previousSibling}return b}normalizedMap(v,h,p){var u,b,T,m={},y=-1,k=v.length;for(u=0;u<k;u++)(b=v[u].nodeType)===1&&v[u].classList.contains(p)&&(b=3),u>0&&b===3&&T===3?m[u]=y:h===b&&(y+=1,m[u]=y),T=b;return m}position(v){var h,p;return v.nodeType===1?((h=v.parentNode.children)||(h=Object(A.findChildren)(v.parentNode)),p=Array.prototype.indexOf.call(h,v)):p=(h=this.textNodes(v.parentNode)).indexOf(v),p}filteredPosition(v,h){var p,u;return v.nodeType===1?(p=v.parentNode.children,u=this.normalizedMap(p,1,h)):(p=v.parentNode.childNodes,v.parentNode.classList.contains(h)&&(p=(v=v.parentNode).parentNode.childNodes),u=this.normalizedMap(p,3,h)),u[Array.prototype.indexOf.call(p,v)]}stepsToXpath(v){var h=[".","*"];return v.forEach(function(p){var u=p.index+1;p.id?h.push("*[position()="+u+" and @id='"+p.id+"']"):p.type==="text"?h.push("text()["+u+"]"):h.push("*["+u+"]")}),h.join("/")}stepsToQuerySelector(v){var h=["html"];return v.forEach(function(p){var u=p.index+1;p.id?h.push("#"+p.id):p.type==="text"||h.push("*:nth-child("+u+")")}),h.join(">")}textNodes(v,h){return Array.prototype.slice.call(v.childNodes).filter(function(p){return p.nodeType===3||!(!h||!p.classList.contains(h))})}walkToNode(v,h,p){var u,b,T=h||document,m=T.documentElement,y=v.length;for(b=0;b<y&&((u=v[b]).type==="element"?m=u.id?T.getElementById(u.id):(m.children||Object(A.findChildren)(m))[u.index]:u.type==="text"&&(m=this.textNodes(m,p)[u.index]),m);b++);return m}findNode(v,h,p){var u,b,T=h||document;return p||T.evaluate===void 0?u=p?this.walkToNode(v,T,p):this.walkToNode(v,T):(b=this.stepsToXpath(v),u=T.evaluate(b,T,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue),u}fixMiss(v,h,p,u){var b,T,m=this.findNode(v.slice(0,-1),p,u),y=m.childNodes,k=this.normalizedMap(y,3,u),n=v[v.length-1].index;for(let e in k){if(!k.hasOwnProperty(e))return;if(k[e]===n){if(!(h>(T=(b=y[e]).textContent.length))){m=b.nodeType===1?b.childNodes[0]:b;break}h-=T}}return{container:m,offset:h}}toRange(v,h){var p,u,b,T,m,y,k,n,e=v||document,s=!!h&&e.querySelector("."+h)!=null;if(p=e.createRange!==void 0?e.createRange():new A.RangeObject,this.range?(u=this.start,y=this.path.steps.concat(u.steps),T=this.findNode(y,e,s?h:null),b=this.end,k=this.path.steps.concat(b.steps),m=this.findNode(k,e,s?h:null)):(u=this.path,y=this.path.steps,T=this.findNode(this.path.steps,e,s?h:null)),!T)return console.log("No startContainer found for",this.toString()),null;try{u.terminal.offset!=null?p.setStart(T,u.terminal.offset):p.setStart(T,0)}catch{n=this.fixMiss(y,u.terminal.offset,e,s?h:null),p.setStart(n.container,n.offset)}if(m)try{b.terminal.offset!=null?p.setEnd(m,b.terminal.offset):p.setEnd(m,0)}catch{n=this.fixMiss(k,this.end.terminal.offset,e,s?h:null),p.setEnd(n.container,n.offset)}return p}isCfiString(v){return typeof v=="string"&&v.indexOf("epubcfi(")===0&&v[v.length-1]===")"}generateChapterComponent(v,h,p){var u="/"+2*(v+1)+"/";return u+=2*(parseInt(h)+1),p&&(u+="["+p+"]"),u}collapse(v){this.range&&(this.range=!1,v?(this.path.steps=this.path.steps.concat(this.start.steps),this.path.terminal=this.start.terminal):(this.path.steps=this.path.steps.concat(this.end.steps),this.path.terminal=this.end.terminal))}}P.a=j},function(V,P,N){var A,j,x,v,h,p,u,b=N(31),T=N(45),m=Function.prototype.apply,y=Function.prototype.call,k=Object.create,n=Object.defineProperty,e=Object.defineProperties,s=Object.prototype.hasOwnProperty,d={configurable:!0,enumerable:!1,writable:!0};j=function(l,f){var i,w;return T(f),w=this,A.call(this,l,i=function(){x.call(w,l,i),m.call(f,this,arguments)}),i.__eeOnceListener__=f,this},h={on:A=function(l,f){var i;return T(f),s.call(this,"__ee__")?i=this.__ee__:(i=d.value=k(null),n(this,"__ee__",d),d.value=null),i[l]?typeof i[l]=="object"?i[l].push(f):i[l]=[i[l],f]:i[l]=f,this},once:j,off:x=function(l,f){var i,w,C,L;if(T(f),!s.call(this,"__ee__"))return this;if(!(i=this.__ee__)[l])return this;if(typeof(w=i[l])=="object")for(L=0;C=w[L];++L)C!==f&&C.__eeOnceListener__!==f||(w.length===2?i[l]=w[L?0:1]:w.splice(L,1));else w!==f&&w.__eeOnceListener__!==f||delete i[l];return this},emit:v=function(l){var f,i,w,C,L;if(s.call(this,"__ee__")&&(C=this.__ee__[l]))if(typeof C=="object"){for(i=arguments.length,L=new Array(i-1),f=1;f<i;++f)L[f-1]=arguments[f];for(C=C.slice(),f=0;w=C[f];++f)m.call(w,this,L)}else switch(arguments.length){case 1:y.call(C,this);break;case 2:y.call(C,this,arguments[1]);break;case 3:y.call(C,this,arguments[1],arguments[2]);break;default:for(i=arguments.length,L=new Array(i-1),f=1;f<i;++f)L[f-1]=arguments[f];m.call(C,this,L)}}},p={on:b(A),once:b(j),off:b(x),emit:b(v)},u=e({},p),V.exports=P=function(l){return l==null?k(u):e(Object(l),p)},P.methods=h},function(V,P,N){var A=N(7),j=N.n(A);P.a=class{constructor(x){var v;x.indexOf("://")>-1&&(x=new URL(x).pathname),v=this.parse(x),this.path=x,this.isDirectory(x)?this.directory=x:this.directory=v.dir+"/",this.filename=v.base,this.extension=v.ext.slice(1)}parse(x){return j.a.parse(x)}isAbsolute(x){return j.a.isAbsolute(x||this.path)}isDirectory(x){return x.charAt(x.length-1)==="/"}resolve(x){return j.a.resolve(this.directory,x)}relative(x){return x&&x.indexOf("://")>-1?x:j.a.relative(this.directory,x)}splitPath(x){return this.splitPathRe.exec(x).slice(1)}toString(){return this.path}}},function(V,P,N){var A=N(4),j=N(7),x=N.n(j);P.a=class{constructor(v,h){var p=v.indexOf("://")>-1,u=v;if(this.Url=void 0,this.href=v,this.protocol="",this.origin="",this.hash="",this.hash="",this.search="",this.base=h,!p&&h!==!1&&typeof h!="string"&&window&&window.location&&(this.base=window.location.href),p||this.base)try{this.base?this.Url=new URL(v,this.base):this.Url=new URL(v),this.href=this.Url.href,this.protocol=this.Url.protocol,this.origin=this.Url.origin,this.hash=this.Url.hash,this.search=this.Url.search,u=this.Url.pathname+(this.Url.search?this.Url.search:"")}catch{this.Url=void 0,this.base&&(u=new A.a(this.base).resolve(u))}this.Path=new A.a(u),this.directory=this.Path.directory,this.filename=this.Path.filename,this.extension=this.Path.extension}path(){return this.Path}resolve(v){var h;return v.indexOf("://")>-1?v:(h=x.a.resolve(this.directory,v),this.origin+h)}relative(v){return x.a.relative(v,this.directory)}toString(){return this.href}}},function(V,P,N){P.a=class{constructor(A){this.context=A||this,this.hooks=[]}register(){for(var A=0;A<arguments.length;++A)if(typeof arguments[A]=="function")this.hooks.push(arguments[A]);else for(var j=0;j<arguments[A].length;++j)this.hooks.push(arguments[A][j])}deregister(A){let j;for(let x=0;x<this.hooks.length;x++)if(j=this.hooks[x],j===A){this.hooks.splice(x,1);break}}trigger(){var A=arguments,j=this.context,x=[];return this.hooks.forEach(function(v){try{var h=v.apply(j,A)}catch(p){console.log(p)}h&&typeof h.then=="function"&&x.push(h)}),Promise.all(x)}list(){return this.hooks}clear(){return this.hooks=[]}}},function(V,P,N){if(!A)var A={cwd:function(){return"/"}};function j(h){if(typeof h!="string")throw new TypeError("Path must be a string. Received "+h)}function x(h,p){for(var u,b="",T=-1,m=0,y=0;y<=h.length;++y){if(y<h.length)u=h.charCodeAt(y);else{if(u===47)break;u=47}if(u===47){if(!(T===y-1||m===1))if(T!==y-1&&m===2){if(b.length<2||b.charCodeAt(b.length-1)!==46||b.charCodeAt(b.length-2)!==46){if(b.length>2){for(var k=b.length-1,n=k;n>=0&&b.charCodeAt(n)!==47;--n);if(n!==k){b=n===-1?"":b.slice(0,n),T=y,m=0;continue}}else if(b.length===2||b.length===1){b="",T=y,m=0;continue}}p&&(b.length>0?b+="/..":b="..")}else b.length>0?b+="/"+h.slice(T+1,y):b=h.slice(T+1,y);T=y,m=0}else u===46&&m!==-1?++m:m=-1}return b}var v={resolve:function(){for(var h,p="",u=!1,b=arguments.length-1;b>=-1&&!u;b--){var T;b>=0?T=arguments[b]:(h===void 0&&(h=A.cwd()),T=h),j(T),T.length!==0&&(p=T+"/"+p,u=T.charCodeAt(0)===47)}return p=x(p,!u),u?p.length>0?"/"+p:"/":p.length>0?p:"."},normalize:function(h){if(j(h),h.length===0)return".";var p=h.charCodeAt(0)===47,u=h.charCodeAt(h.length-1)===47;return(h=x(h,!p)).length!==0||p||(h="."),h.length>0&&u&&(h+="/"),p?"/"+h:h},isAbsolute:function(h){return j(h),h.length>0&&h.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var h,p=0;p<arguments.length;++p){var u=arguments[p];j(u),u.length>0&&(h===void 0?h=u:h+="/"+u)}return h===void 0?".":v.normalize(h)},relative:function(h,p){if(j(h),j(p),h===p||(h=v.resolve(h))===(p=v.resolve(p)))return"";for(var u=1;u<h.length&&h.charCodeAt(u)===47;++u);for(var b=h.length,T=b-u,m=1;m<p.length&&p.charCodeAt(m)===47;++m);for(var y=p.length-m,k=T<y?T:y,n=-1,e=0;e<=k;++e){if(e===k){if(y>k){if(p.charCodeAt(m+e)===47)return p.slice(m+e+1);if(e===0)return p.slice(m+e)}else T>k&&(h.charCodeAt(u+e)===47?n=e:e===0&&(n=0));break}var s=h.charCodeAt(u+e);if(s!==p.charCodeAt(m+e))break;s===47&&(n=e)}var d="";for(e=u+n+1;e<=b;++e)e!==b&&h.charCodeAt(e)!==47||(d.length===0?d+="..":d+="/..");return d.length>0?d+p.slice(m+n):(m+=n,p.charCodeAt(m)===47&&++m,p.slice(m))},_makeLong:function(h){return h},dirname:function(h){if(j(h),h.length===0)return".";for(var p=h.charCodeAt(0),u=p===47,b=-1,T=!0,m=h.length-1;m>=1;--m)if((p=h.charCodeAt(m))===47){if(!T){b=m;break}}else T=!1;return b===-1?u?"/":".":u&&b===1?"//":h.slice(0,b)},basename:function(h,p){if(p!==void 0&&typeof p!="string")throw new TypeError('"ext" argument must be a string');j(h);var u,b=0,T=-1,m=!0;if(p!==void 0&&p.length>0&&p.length<=h.length){if(p.length===h.length&&p===h)return"";var y=p.length-1,k=-1;for(u=h.length-1;u>=0;--u){var n=h.charCodeAt(u);if(n===47){if(!m){b=u+1;break}}else k===-1&&(m=!1,k=u+1),y>=0&&(n===p.charCodeAt(y)?--y==-1&&(T=u):(y=-1,T=k))}return b===T?T=k:T===-1&&(T=h.length),h.slice(b,T)}for(u=h.length-1;u>=0;--u)if(h.charCodeAt(u)===47){if(!m){b=u+1;break}}else T===-1&&(m=!1,T=u+1);return T===-1?"":h.slice(b,T)},extname:function(h){j(h);for(var p=-1,u=0,b=-1,T=!0,m=0,y=h.length-1;y>=0;--y){var k=h.charCodeAt(y);if(k!==47)b===-1&&(T=!1,b=y+1),k===46?p===-1?p=y:m!==1&&(m=1):p!==-1&&(m=-1);else if(!T){u=y+1;break}}return p===-1||b===-1||m===0||m===1&&p===b-1&&p===u+1?"":h.slice(p,b)},format:function(h){if(h===null||typeof h!="object")throw new TypeError('Parameter "pathObject" must be an object, not '+typeof h);return function(p,u){var b=u.dir||u.root,T=u.base||(u.name||"")+(u.ext||"");return b?b===u.root?b+T:b+p+T:T}("/",h)},parse:function(h){j(h);var p={root:"",dir:"",base:"",ext:"",name:""};if(h.length===0)return p;var u,b=h.charCodeAt(0),T=b===47;T?(p.root="/",u=1):u=0;for(var m=-1,y=0,k=-1,n=!0,e=h.length-1,s=0;e>=u;--e)if((b=h.charCodeAt(e))!==47)k===-1&&(n=!1,k=e+1),b===46?m===-1?m=e:s!==1&&(s=1):m!==-1&&(s=-1);else if(!n){y=e+1;break}return m===-1||k===-1||s===0||s===1&&m===k-1&&m===y+1?k!==-1&&(p.base=p.name=y===0&&T?h.slice(1,k):h.slice(y,k)):(y===0&&T?(p.name=h.slice(1,m),p.base=h.slice(1,k)):(p.name=h.slice(y,m),p.base=h.slice(y,k)),p.ext=h.slice(m,k)),y>0?p.dir=h.slice(0,y-1):T&&(p.dir="/"),p},sep:"/",delimiter:":",posix:null};V.exports=v},function(V,P,N){N.d(P,"a",function(){return x}),N.d(P,"b",function(){return v}),N.d(P,"d",function(){return h}),N.d(P,"c",function(){return p}),N.d(P,"e",function(){return u});var A=N(0),j=N(5);N(4);function x(b,T){var m,y,k=T.url,n=k.indexOf("://")>-1;b&&(y=Object(A.qs)(b,"head"),(m=Object(A.qs)(y,"base"))||(m=b.createElement("base"),y.insertBefore(m,y.firstChild)),!n&&window&&window.location&&(k=window.location.origin+k),m.setAttribute("href",k))}function v(b,T){var m,y,k=T.canonical;b&&(m=Object(A.qs)(b,"head"),(y=Object(A.qs)(m,"link[rel='canonical']"))?y.setAttribute("href",k):((y=b.createElement("link")).setAttribute("rel","canonical"),y.setAttribute("href",k),m.appendChild(y)))}function h(b,T){var m,y,k=T.idref;b&&(m=Object(A.qs)(b,"head"),(y=Object(A.qs)(m,"link[property='dc.identifier']"))?y.setAttribute("content",k):((y=b.createElement("meta")).setAttribute("name","dc.identifier"),y.setAttribute("content",k),m.appendChild(y)))}function p(b,T){var m=b.querySelectorAll("a[href]");if(m.length)for(var y=Object(A.qs)(b.ownerDocument,"base"),k=y?y.getAttribute("href"):void 0,n=function(s){var d=s.getAttribute("href");if(d.indexOf("mailto:")!==0)if(d.indexOf("://")>-1)s.setAttribute("target","_blank");else{var l;try{l=new j.a(d,k)}catch{}s.onclick=function(){return l&&l.hash?T(l.Path.path+l.hash):T(l?l.Path.path:d),!1}}}.bind(this),e=0;e<m.length;e++)n(m[e])}function u(b,T,m){return T.forEach(function(y,k){y&&m[k]&&(y=y.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),b=b.replace(new RegExp(y,"g"),m[k]))}),b}},function(V,P,N){var A=N(0);P.a=class{constructor(j){this._q=[],this.context=j,this.tick=A.requestAnimationFrame,this.running=!1,this.paused=!1}enqueue(){var j,x,v=[].shift.call(arguments),h=arguments;if(!v)throw new Error("No Task Provided");return x=typeof v=="function"?{task:v,args:h,deferred:j=new A.defer,promise:j.promise}:{promise:v},this._q.push(x),this.paused!=0||this.running||this.run(),x.promise}dequeue(){var j,x,v;return!this._q.length||this.paused?((j=new A.defer).deferred.resolve(),j.promise):(x=(j=this._q.shift()).task)?(v=x.apply(this.context,j.args))&&typeof v.then=="function"?v.then(function(){j.deferred.resolve.apply(this.context,arguments)}.bind(this),function(){j.deferred.reject.apply(this.context,arguments)}.bind(this)):(j.deferred.resolve.apply(this.context,v),j.promise):j.promise?j.promise:void 0}dump(){for(;this._q.length;)this.dequeue()}run(){return this.running||(this.running=!0,this.defered=new A.defer),this.tick.call(window,()=>{this._q.length?this.dequeue().then(function(){this.run()}.bind(this)):(this.defered.resolve(),this.running=void 0)}),this.paused==1&&(this.paused=!1),this.defered.promise}flush(){return this.running?this.running:this._q.length?(this.running=this.dequeue().then(function(){return this.running=void 0,this.flush()}.bind(this)),this.running):void 0}clear(){this._q=[]}length(){return this._q.length}pause(){this.paused=!0}stop(){this._q=[],this.running=!1,this.paused=!0}}},function(V,P,N){var A=N(3),j=N.n(A),x=N(0);function v(){var n="reverse",e=function(){var s=document.createElement("div");s.dir="rtl",s.style.position="fixed",s.style.width="1px",s.style.height="1px",s.style.top="0px",s.style.left="0px",s.style.overflow="hidden";var d=document.createElement("div");d.style.width="2px";var l=document.createElement("span");l.style.width="1px",l.style.display="inline-block";var f=document.createElement("span");return f.style.width="1px",f.style.display="inline-block",d.appendChild(l),d.appendChild(f),s.appendChild(d),s}();return document.body.appendChild(e),e.scrollLeft>0?n="default":typeof Element<"u"&&Element.prototype.scrollIntoView?(e.children[0].children[1].scrollIntoView(),e.scrollLeft<0&&(n="negative")):(e.scrollLeft=1,e.scrollLeft===0&&(n="negative")),document.body.removeChild(e),n}var h=N(11),p=N(9),u=N(28),b=N.n(u),T=class{constructor(n){this.settings=n||{},this.id="epubjs-container-"+Object(x.uuid)(),this.container=this.create(this.settings),this.settings.hidden&&(this.wrapper=this.wrap(this.container))}create(n){let e=n.height,s=n.width,d=n.overflow||!1,l=n.axis||"vertical",f=n.direction;Object(x.extend)(this.settings,n),n.height&&Object(x.isNumber)(n.height)&&(e=n.height+"px"),n.width&&Object(x.isNumber)(n.width)&&(s=n.width+"px");let i=document.createElement("div");return i.id=this.id,i.classList.add("epub-container"),i.style.wordSpacing="0",i.style.lineHeight="0",i.style.verticalAlign="top",i.style.position="relative",l==="horizontal"&&(i.style.display="flex",i.style.flexDirection="row",i.style.flexWrap="nowrap"),s&&(i.style.width=s),e&&(i.style.height=e),d&&(d==="scroll"&&l==="vertical"?(i.style["overflow-y"]=d,i.style["overflow-x"]="hidden"):d==="scroll"&&l==="horizontal"?(i.style["overflow-y"]="hidden",i.style["overflow-x"]=d):i.style.overflow=d),f&&(i.dir=f,i.style.direction=f),f&&this.settings.fullsize&&(document.body.style.direction=f),i}wrap(n){var e=document.createElement("div");return e.style.visibility="hidden",e.style.overflow="hidden",e.style.width="0",e.style.height="0",e.appendChild(n),e}getElement(n){var e;if(Object(x.isElement)(n)?e=n:typeof n=="string"&&(e=document.getElementById(n)),!e)throw new Error("Not an Element");return e}attachTo(n){var e,s=this.getElement(n);if(s)return e=this.settings.hidden?this.wrapper:this.container,s.appendChild(e),this.element=s,s}getContainer(){return this.container}onResize(n){Object(x.isNumber)(this.settings.width)&&Object(x.isNumber)(this.settings.height)||(this.resizeFunc=b()(n,50),window.addEventListener("resize",this.resizeFunc,!1))}onOrientationChange(n){this.orientationChangeFunc=n,window.addEventListener("orientationchange",this.orientationChangeFunc,!1)}size(n,e){var s;let d=n||this.settings.width,l=e||this.settings.height;n===null?(s=this.element.getBoundingClientRect()).width&&(n=Math.floor(s.width),this.container.style.width=n+"px"):Object(x.isNumber)(n)?this.container.style.width=n+"px":this.container.style.width=n,e===null?(s=s||this.element.getBoundingClientRect()).height&&(e=s.height,this.container.style.height=e+"px"):Object(x.isNumber)(e)?this.container.style.height=e+"px":this.container.style.height=e,Object(x.isNumber)(n)||(n=this.container.clientWidth),Object(x.isNumber)(e)||(e=this.container.clientHeight),this.containerStyles=window.getComputedStyle(this.container),this.containerPadding={left:parseFloat(this.containerStyles["padding-left"])||0,right:parseFloat(this.containerStyles["padding-right"])||0,top:parseFloat(this.containerStyles["padding-top"])||0,bottom:parseFloat(this.containerStyles["padding-bottom"])||0};let f=Object(x.windowBounds)(),i=window.getComputedStyle(document.body),w=parseFloat(i["padding-left"])||0,C=parseFloat(i["padding-right"])||0,L=parseFloat(i["padding-top"])||0,F=parseFloat(i["padding-bottom"])||0;return d||(n=f.width-w-C),(this.settings.fullsize&&!l||!l)&&(e=f.height-L-F),{width:n-this.containerPadding.left-this.containerPadding.right,height:e-this.containerPadding.top-this.containerPadding.bottom}}bounds(){let n;return this.container.style.overflow!=="visible"&&(n=this.container&&this.container.getBoundingClientRect()),n&&n.width&&n.height?n:Object(x.windowBounds)()}getSheet(){var n=document.createElement("style");return n.appendChild(document.createTextNode("")),document.head.appendChild(n),n.sheet}addStyleRules(n,e){var s="#"+this.id+" ",d="";this.sheet||(this.sheet=this.getSheet()),e.forEach(function(l){for(var f in l)l.hasOwnProperty(f)&&(d+=f+":"+l[f]+";")}),this.sheet.insertRule(s+n+" {"+d+"}",0)}axis(n){n==="horizontal"?(this.container.style.display="flex",this.container.style.flexDirection="row",this.container.style.flexWrap="nowrap"):this.container.style.display="block",this.settings.axis=n}direction(n){this.container&&(this.container.dir=n,this.container.style.direction=n),this.settings.fullsize&&(document.body.style.direction=n),this.settings.dir=n}overflow(n){this.container&&(n==="scroll"&&this.settings.axis==="vertical"?(this.container.style["overflow-y"]=n,this.container.style["overflow-x"]="hidden"):n==="scroll"&&this.settings.axis==="horizontal"?(this.container.style["overflow-y"]="hidden",this.container.style["overflow-x"]=n):this.container.style.overflow=n),this.settings.overflow=n}destroy(){this.element&&(this.settings.hidden?this.wrapper:this.container,this.element.contains(this.container)&&this.element.removeChild(this.container),window.removeEventListener("resize",this.resizeFunc),window.removeEventListener("orientationChange",this.orientationChangeFunc))}},m=class{constructor(n){this.container=n,this._views=[],this.length=0,this.hidden=!1}all(){return this._views}first(){return this._views[0]}last(){return this._views[this._views.length-1]}indexOf(n){return this._views.indexOf(n)}slice(){return this._views.slice.apply(this._views,arguments)}get(n){return this._views[n]}append(n){return this._views.push(n),this.container&&this.container.appendChild(n.element),this.length++,n}prepend(n){return this._views.unshift(n),this.container&&this.container.insertBefore(n.element,this.container.firstChild),this.length++,n}insert(n,e){return this._views.splice(e,0,n),this.container&&(e<this.container.children.length?this.container.insertBefore(n.element,this.container.children[e]):this.container.appendChild(n.element)),this.length++,n}remove(n){var e=this._views.indexOf(n);e>-1&&this._views.splice(e,1),this.destroy(n),this.length--}destroy(n){n.displayed&&n.destroy(),this.container&&this.container.removeChild(n.element),n=null}forEach(){return this._views.forEach.apply(this._views,arguments)}clear(){var n,e=this.length;if(this.length){for(var s=0;s<e;s++)n=this._views[s],this.destroy(n);this._views=[],this.length=0}}find(n){for(var e,s=this.length,d=0;d<s;d++)if((e=this._views[d]).displayed&&e.section.index==n.index)return e}displayed(){for(var n,e=[],s=this.length,d=0;d<s;d++)(n=this._views[d]).displayed&&e.push(n);return e}show(){for(var n,e=this.length,s=0;s<e;s++)(n=this._views[s]).displayed&&n.show();this.hidden=!1}hide(){for(var n,e=this.length,s=0;s<e;s++)(n=this._views[s]).displayed&&n.hide();this.hidden=!0}},y=N(1);class k{constructor(e){this.name="default",this.optsSettings=e.settings,this.View=e.view,this.request=e.request,this.renditionQueue=e.queue,this.q=new p.a(this),this.settings=Object(x.extend)(this.settings||{},{infinite:!0,hidden:!1,width:void 0,height:void 0,axis:void 0,writingMode:void 0,flow:"scrolled",ignoreClass:"",fullsize:void 0,allowScriptedContent:!1,allowPopups:!1}),Object(x.extend)(this.settings,e.settings||{}),this.viewSettings={ignoreClass:this.settings.ignoreClass,axis:this.settings.axis,flow:this.settings.flow,layout:this.layout,method:this.settings.method,width:0,height:0,forceEvenPages:!0,allowScriptedContent:this.settings.allowScriptedContent,allowPopups:this.settings.allowPopups},this.rendered=!1}render(e,s){let d=e.tagName;this.settings.fullsize!==void 0||!d||d.toLowerCase()!="body"&&d.toLowerCase()!="html"||(this.settings.fullsize=!0),this.settings.fullsize&&(this.settings.overflow="visible",this.overflow=this.settings.overflow),this.settings.size=s,this.settings.rtlScrollType=v(),this.stage=new T({width:s.width,height:s.height,overflow:this.overflow,hidden:this.settings.hidden,axis:this.settings.axis,fullsize:this.settings.fullsize,direction:this.settings.direction}),this.stage.attachTo(e),this.container=this.stage.getContainer(),this.views=new m(this.container),this._bounds=this.bounds(),this._stageSize=this.stage.size(),this.viewSettings.width=this._stageSize.width,this.viewSettings.height=this._stageSize.height,this.stage.onResize(this.onResized.bind(this)),this.stage.onOrientationChange(this.onOrientationChange.bind(this)),this.addEventListeners(),this.layout&&this.updateLayout(),this.rendered=!0}addEventListeners(){var e;window.addEventListener("unload",function(s){this.destroy()}.bind(this)),e=this.settings.fullsize?window:this.container,this._onScroll=this.onScroll.bind(this),e.addEventListener("scroll",this._onScroll)}removeEventListeners(){(this.settings.fullsize?window:this.container).removeEventListener("scroll",this._onScroll),this._onScroll=void 0}destroy(){clearTimeout(this.orientationTimeout),clearTimeout(this.resizeTimeout),clearTimeout(this.afterScrolled),this.clear(),this.removeEventListeners(),this.stage.destroy(),this.rendered=!1}onOrientationChange(e){let{orientation:s}=window;this.optsSettings.resizeOnOrientationChange&&this.resize(),clearTimeout(this.orientationTimeout),this.orientationTimeout=setTimeout(function(){this.orientationTimeout=void 0,this.optsSettings.resizeOnOrientationChange&&this.resize(),this.emit(y.c.MANAGERS.ORIENTATION_CHANGE,s)}.bind(this),500)}onResized(e){this.resize()}resize(e,s,d){let l=this.stage.size(e,s);this.winBounds=Object(x.windowBounds)(),this.orientationTimeout&&this.winBounds.width===this.winBounds.height?this._stageSize=void 0:this._stageSize&&this._stageSize.width===l.width&&this._stageSize.height===l.height||(this._stageSize=l,this._bounds=this.bounds(),this.clear(),this.viewSettings.width=this._stageSize.width,this.viewSettings.height=this._stageSize.height,this.updateLayout(),this.emit(y.c.MANAGERS.RESIZED,{width:this._stageSize.width,height:this._stageSize.height},d))}createView(e,s){return new this.View(e,Object(x.extend)(this.viewSettings,{forceRight:s}))}handleNextPrePaginated(e,s,d){let l;if(this.layout.name==="pre-paginated"&&this.layout.divisor>1){if(e||s.index===0)return;if(l=s.next(),l&&!l.properties.includes("page-spread-left"))return d.call(this,l)}}display(e,s){var d=new x.defer,l=d.promise;(s===e.href||Object(x.isNumber)(s))&&(s=void 0);var f=this.views.find(e);if(f&&e&&this.layout.name!=="pre-paginated"){let w=f.offset();if(this.settings.direction==="ltr")this.scrollTo(w.left,w.top,!0);else{let C=f.width();this.scrollTo(w.left+C,w.top,!0)}if(s){let C=f.locationOf(s),L=f.width();this.moveTo(C,L)}return d.resolve(),l}this.clear();let i=!1;return this.layout.name==="pre-paginated"&&this.layout.divisor===2&&e.properties.includes("page-spread-right")&&(i=!0),this.add(e,i).then(function(w){if(s){let C=w.locationOf(s),L=w.width();this.moveTo(C,L)}}.bind(this),w=>{d.reject(w)}).then(function(){return this.handleNextPrePaginated(i,e,this.add)}.bind(this)).then(function(){this.views.show(),d.resolve()}.bind(this)),l}afterDisplayed(e){this.emit(y.c.MANAGERS.ADDED,e)}afterResized(e){this.emit(y.c.MANAGERS.RESIZE,e.section)}moveTo(e,s){var d=0,l=0;this.isPaginated?((d=Math.floor(e.left/this.layout.delta)*this.layout.delta)+this.layout.delta>this.container.scrollWidth&&(d=this.container.scrollWidth-this.layout.delta),(l=Math.floor(e.top/this.layout.delta)*this.layout.delta)+this.layout.delta>this.container.scrollHeight&&(l=this.container.scrollHeight-this.layout.delta)):l=e.top,this.settings.direction==="rtl"&&(d+=this.layout.delta,d-=s),this.scrollTo(d,l,!0)}add(e,s){var d=this.createView(e,s);return this.views.append(d),d.onDisplayed=this.afterDisplayed.bind(this),d.onResize=this.afterResized.bind(this),d.on(y.c.VIEWS.AXIS,l=>{this.updateAxis(l)}),d.on(y.c.VIEWS.WRITING_MODE,l=>{this.updateWritingMode(l)}),d.display(this.request)}append(e,s){var d=this.createView(e,s);return this.views.append(d),d.onDisplayed=this.afterDisplayed.bind(this),d.onResize=this.afterResized.bind(this),d.on(y.c.VIEWS.AXIS,l=>{this.updateAxis(l)}),d.on(y.c.VIEWS.WRITING_MODE,l=>{this.updateWritingMode(l)}),d.display(this.request)}prepend(e,s){var d=this.createView(e,s);return d.on(y.c.VIEWS.RESIZED,l=>{this.counter(l)}),this.views.prepend(d),d.onDisplayed=this.afterDisplayed.bind(this),d.onResize=this.afterResized.bind(this),d.on(y.c.VIEWS.AXIS,l=>{this.updateAxis(l)}),d.on(y.c.VIEWS.WRITING_MODE,l=>{this.updateWritingMode(l)}),d.display(this.request)}counter(e){this.settings.axis==="vertical"?this.scrollBy(0,e.heightDelta,!0):this.scrollBy(e.widthDelta,0,!0)}next(){var e;let s=this.settings.direction;if(this.views.length&&(!this.isPaginated||this.settings.axis!=="horizontal"||s&&s!=="ltr"?this.isPaginated&&this.settings.axis==="horizontal"&&s==="rtl"?(this.scrollLeft=this.container.scrollLeft,this.settings.rtlScrollType==="default"?this.container.scrollLeft>0?this.scrollBy(this.layout.delta,0,!0):e=this.views.last().section.next():this.container.scrollLeft+-1*this.layout.delta>-1*this.container.scrollWidth?this.scrollBy(this.layout.delta,0,!0):e=this.views.last().section.next()):this.isPaginated&&this.settings.axis==="vertical"?(this.scrollTop=this.container.scrollTop,this.container.scrollTop+this.container.offsetHeight<this.container.scrollHeight?this.scrollBy(0,this.layout.height,!0):e=this.views.last().section.next()):e=this.views.last().section.next():(this.scrollLeft=this.container.scrollLeft,this.container.scrollLeft+this.container.offsetWidth+this.layout.delta<=this.container.scrollWidth?this.scrollBy(this.layout.delta,0,!0):e=this.views.last().section.next()),e)){this.clear(),this.updateLayout();let d=!1;return this.layout.name==="pre-paginated"&&this.layout.divisor===2&&e.properties.includes("page-spread-right")&&(d=!0),this.append(e,d).then(function(){return this.handleNextPrePaginated(d,e,this.append)}.bind(this),l=>l).then(function(){this.isPaginated||this.settings.axis!=="horizontal"||this.settings.direction!=="rtl"||this.settings.rtlScrollType!=="default"||this.scrollTo(this.container.scrollWidth,0,!0),this.views.show()}.bind(this))}}prev(){var e;let s=this.settings.direction;if(this.views.length&&(!this.isPaginated||this.settings.axis!=="horizontal"||s&&s!=="ltr"?this.isPaginated&&this.settings.axis==="horizontal"&&s==="rtl"?(this.scrollLeft=this.container.scrollLeft,this.settings.rtlScrollType==="default"?this.container.scrollLeft+this.container.offsetWidth<this.container.scrollWidth?this.scrollBy(-this.layout.delta,0,!0):e=this.views.first().section.prev():this.container.scrollLeft<0?this.scrollBy(-this.layout.delta,0,!0):e=this.views.first().section.prev()):this.isPaginated&&this.settings.axis==="vertical"?(this.scrollTop=this.container.scrollTop,this.container.scrollTop>0?this.scrollBy(0,-this.layout.height,!0):e=this.views.first().section.prev()):e=this.views.first().section.prev():(this.scrollLeft=this.container.scrollLeft,this.container.scrollLeft>0?this.scrollBy(-this.layout.delta,0,!0):e=this.views.first().section.prev()),e)){this.clear(),this.updateLayout();let d=!1;return this.layout.name==="pre-paginated"&&this.layout.divisor===2&&typeof e.prev()!="object"&&(d=!0),this.prepend(e,d).then(function(){var l;if(this.layout.name==="pre-paginated"&&this.layout.divisor>1&&(l=e.prev()))return this.prepend(l)}.bind(this),l=>l).then(function(){this.isPaginated&&this.settings.axis==="horizontal"&&(this.settings.direction==="rtl"?this.settings.rtlScrollType==="default"?this.scrollTo(0,0,!0):this.scrollTo(-1*this.container.scrollWidth+this.layout.delta,0,!0):this.scrollTo(this.container.scrollWidth-this.layout.delta,0,!0)),this.views.show()}.bind(this))}}current(){var e=this.visible();return e.length?e[e.length-1]:null}clear(){this.views&&(this.views.hide(),this.scrollTo(0,0,!0),this.views.clear())}currentLocation(){return this.updateLayout(),this.isPaginated&&this.settings.axis==="horizontal"?this.location=this.paginatedLocation():this.location=this.scrolledLocation(),this.location}scrolledLocation(){let e=this.visible(),s=this.container.getBoundingClientRect(),d=s.height<window.innerHeight?s.height:window.innerHeight,l=s.width<window.innerWidth?s.width:window.innerWidth,f=this.settings.axis==="vertical",i=(this.settings.direction,0);return this.settings.fullsize&&(i=f?window.scrollY:window.scrollX),e.map(w=>{let C,L,F,W,{index:q,href:G}=w.section,Y=w.position(),Q=w.width(),et=w.height();f?(C=i+s.top-Y.top+0,L=C+d-0,W=this.layout.count(et,d).pages,F=d):(C=i+s.left-Y.left+0,L=C+l-0,W=this.layout.count(Q,l).pages,F=l);let it=Math.ceil(C/F),tt=[],ht=Math.ceil(L/F);if(this.settings.direction==="rtl"&&!f){let nt=it;it=W-ht,ht=W-nt}tt=[];for(var ft=it;ft<=ht;ft++){let nt=ft+1;tt.push(nt)}return{index:q,href:G,pages:tt,totalPages:W,mapping:this.mapping.page(w.contents,w.section.cfiBase,C,L)}})}paginatedLocation(){let e=this.visible(),s=this.container.getBoundingClientRect(),d=0,l=0;return this.settings.fullsize&&(d=window.scrollX),e.map(f=>{let i,w,C,L,{index:F,href:W}=f.section,q=f.position(),G=f.width();this.settings.direction==="rtl"?(i=s.right-d,L=Math.min(Math.abs(i-q.left),this.layout.width)-l,C=q.width-(q.right-i)-l,w=C-L):(i=s.left+d,L=Math.min(q.right-i,this.layout.width)-l,w=i-q.left+l,C=w+L),l+=L;let Y=this.mapping.page(f.contents,f.section.cfiBase,w,C),Q=this.layout.count(G).pages,et=Math.floor(w/this.layout.pageWidth),it=[],tt=Math.floor(C/this.layout.pageWidth);if(et<0&&(et=0,tt+=1),this.settings.direction==="rtl"){let ft=et;et=Q-tt,tt=Q-ft}for(var ht=et+1;ht<=tt;ht++){let ft=ht;it.push(ft)}return{index:F,href:W,pages:it,totalPages:Q,mapping:Y}})}isVisible(e,s,d,l){var f=e.position(),i=l||this.bounds();return this.settings.axis==="horizontal"&&f.right>i.left-s&&f.left<i.right+d||this.settings.axis==="vertical"&&f.bottom>i.top-s&&f.top<i.bottom+d}visible(){for(var e,s=this.bounds(),d=this.views.displayed(),l=d.length,f=[],i=0;i<l;i++)e=d[i],this.isVisible(e,0,0,s)===!0&&f.push(e);return f}scrollBy(e,s,d){let l=this.settings.direction==="rtl"?-1:1;d&&(this.ignore=!0),this.settings.fullsize?window.scrollBy(e*l,s*l):(e&&(this.container.scrollLeft+=e*l),s&&(this.container.scrollTop+=s)),this.scrolled=!0}scrollTo(e,s,d){d&&(this.ignore=!0),this.settings.fullsize?window.scrollTo(e,s):(this.container.scrollLeft=e,this.container.scrollTop=s),this.scrolled=!0}onScroll(){let e,s;this.settings.fullsize?(e=window.scrollY,s=window.scrollX):(e=this.container.scrollTop,s=this.container.scrollLeft),this.scrollTop=e,this.scrollLeft=s,this.ignore?this.ignore=!1:(this.emit(y.c.MANAGERS.SCROLL,{top:e,left:s}),clearTimeout(this.afterScrolled),this.afterScrolled=setTimeout(function(){this.emit(y.c.MANAGERS.SCROLLED,{top:this.scrollTop,left:this.scrollLeft})}.bind(this),20))}bounds(){return this.stage.bounds()}applyLayout(e){this.layout=e,this.updateLayout(),this.views&&this.views.length>0&&this.layout.name==="pre-paginated"&&this.display(this.views.first().section)}updateLayout(){this.stage&&(this._stageSize=this.stage.size(),this.isPaginated?(this.layout.calculate(this._stageSize.width,this._stageSize.height,this.settings.gap),this.settings.offset=this.layout.delta/this.layout.divisor):this.layout.calculate(this._stageSize.width,this._stageSize.height),this.viewSettings.width=this.layout.width,this.viewSettings.height=this.layout.height,this.setLayout(this.layout))}setLayout(e){this.viewSettings.layout=e,this.mapping=new h.a(e.props,this.settings.direction,this.settings.axis),this.views&&this.views.forEach(function(s){s&&s.setLayout(e)})}updateWritingMode(e){this.writingMode=e}updateAxis(e,s){(s||e!==this.settings.axis)&&(this.settings.axis=e,this.stage&&this.stage.axis(e),this.viewSettings.axis=e,this.mapping&&(this.mapping=new h.a(this.layout.props,this.settings.direction,this.settings.axis)),this.layout&&(e==="vertical"?this.layout.spread("none"):this.layout.spread(this.layout.settings.spread)))}updateFlow(e,s="auto"){let d=e==="paginated"||e==="auto";this.isPaginated=d,e==="scrolled-doc"||e==="scrolled-continuous"||e==="scrolled"?this.updateAxis("vertical"):this.updateAxis("horizontal"),this.viewSettings.flow=e,this.settings.overflow?this.overflow=this.settings.overflow:this.overflow=d?"hidden":s,this.stage&&this.stage.overflow(this.overflow),this.updateLayout()}getContents(){var e=[];return this.views&&this.views.forEach(function(s){const d=s&&s.contents;d&&e.push(d)}),e}direction(e="ltr"){this.settings.direction=e,this.stage&&this.stage.direction(e),this.viewSettings.direction=e,this.updateLayout()}isRendered(){return this.rendered}}j()(k.prototype),P.a=k},function(V,P,N){var A=N(2),j=N(0);P.a=class{constructor(x,v,h,p=!1){this.layout=x,this.horizontal=h==="horizontal",this.direction=v||"ltr",this._dev=p}section(x){var v=this.findRanges(x);return this.rangeListToCfiList(x.section.cfiBase,v)}page(x,v,h,p){var u,b=!(!x||!x.document)&&x.document.body;if(b){if(u=this.rangePairToCfiPair(v,{start:this.findStart(b,h,p),end:this.findEnd(b,h,p)}),this._dev===!0){let T=x.document,m=new A.a(u.start).toRange(T),y=new A.a(u.end).toRange(T),k=T.defaultView.getSelection(),n=T.createRange();k.removeAllRanges(),n.setStart(m.startContainer,m.startOffset),n.setEnd(y.endContainer,y.endOffset),k.addRange(n)}return u}}walk(x,v){if(!x||x.nodeType!==Node.TEXT_NODE){var h=function(m){return m.data.trim().length>0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT},p=h;p.acceptNode=h;for(var u,b,T=document.createTreeWalker(x,NodeFilter.SHOW_TEXT,p,!1);(u=T.nextNode())&&!(b=v(u)););return b}}findRanges(x){for(var v,h,p=[],u=x.contents.scrollWidth(),b=Math.ceil(u/this.layout.spreadWidth)*this.layout.divisor,T=this.layout.columnWidth,m=this.layout.gap,y=0;y<b.pages;y++)v=(T+m)*y,h=T*(y+1)+m*y,p.push({start:this.findStart(x.document.body,v,h),end:this.findEnd(x.document.body,v,h)});return p}findStart(x,v,h){for(var p,u,b=[x],T=x;b.length;)if(p=b.shift(),u=this.walk(p,m=>{var y,k,n,e,s;if(s=Object(j.nodeBounds)(m),this.horizontal&&this.direction==="ltr"){if(y=this.horizontal?s.left:s.top,k=this.horizontal?s.right:s.bottom,y>=v&&y<=h||k>v)return m;T=m,b.push(m)}else if(this.horizontal&&this.direction==="rtl"){if(y=s.left,(k=s.right)<=h&&k>=v||y<h)return m;T=m,b.push(m)}else{if(n=s.top,e=s.bottom,n>=v&&n<=h||e>v)return m;T=m,b.push(m)}}))return this.findTextStartRange(u,v,h);return this.findTextStartRange(T,v,h)}findEnd(x,v,h){for(var p,u,b=[x],T=x;b.length;)if(p=b.shift(),u=this.walk(p,m=>{var y,k,n,e,s;if(s=Object(j.nodeBounds)(m),this.horizontal&&this.direction==="ltr"){if(y=Math.round(s.left),k=Math.round(s.right),y>h&&T)return T;if(k>h)return m;T=m,b.push(m)}else if(this.horizontal&&this.direction==="rtl"){if(y=Math.round(this.horizontal?s.left:s.top),(k=Math.round(this.horizontal?s.right:s.bottom))<v&&T)return T;if(y<v)return m;T=m,b.push(m)}else{if(n=Math.round(s.top),e=Math.round(s.bottom),n>h&&T)return T;if(e>h)return m;T=m,b.push(m)}}))return this.findTextEndRange(u,v,h);return this.findTextEndRange(T,v,h)}findTextStartRange(x,v,h){for(var p,u,b=this.splitTextNodeIntoRanges(x),T=0;T<b.length;T++)if(u=(p=b[T]).getBoundingClientRect(),this.horizontal&&this.direction==="ltr"){if(u.left>=v)return p}else if(this.horizontal&&this.direction==="rtl"){if(u.right<=h)return p}else if(u.top>=v)return p;return b[0]}findTextEndRange(x,v,h){for(var p,u,b,T,m,y,k,n=this.splitTextNodeIntoRanges(x),e=0;e<n.length;e++){if(b=(u=n[e]).getBoundingClientRect(),this.horizontal&&this.direction==="ltr"){if(T=b.left,m=b.right,T>h&&p)return p;if(m>h)return u}else if(this.horizontal&&this.direction==="rtl"){if(T=b.left,(m=b.right)<v&&p)return p;if(T<v)return u}else{if(y=b.top,k=b.bottom,y>h&&p)return p;if(k>h)return u}p=u}return n[n.length-1]}splitTextNodeIntoRanges(x,v){var h,p=[],u=(x.textContent||"").trim(),b=x.ownerDocument,T=v||" ",m=u.indexOf(T);if(m===-1||x.nodeType!=Node.TEXT_NODE)return(h=b.createRange()).selectNodeContents(x),[h];for((h=b.createRange()).setStart(x,0),h.setEnd(x,m),p.push(h),h=!1;m!=-1;)(m=u.indexOf(T,m+1))>0&&(h&&(h.setEnd(x,m),p.push(h)),(h=b.createRange()).setStart(x,m+1));return h&&(h.setEnd(x,u.length),p.push(h)),p}rangePairToCfiPair(x,v){var h=v.start,p=v.end;return h.collapse(!0),p.collapse(!1),{start:new A.a(h,x).toString(),end:new A.a(p,x).toString()}}rangeListToCfiList(x,v){for(var h,p=[],u=0;u<v.length;u++)h=this.rangePairToCfiPair(x,v[u]),p.push(h);return p}axis(x){return x&&(this.horizontal=x==="horizontal"),this.horizontal}}},function(V,P,N){var A=N(3),j=N.n(A),x=N(0),v=N(2),h=N(11),p=N(8),u=N(1);const b=typeof navigator<"u",T=b&&/Chrome/.test(navigator.userAgent),m=b&&!T&&/AppleWebKit/.test(navigator.userAgent);class y{constructor(n,e,s,d){this.epubcfi=new v.a,this.document=n,this.documentElement=this.document.documentElement,this.content=e||this.document.body,this.window=this.document.defaultView,this._size={width:0,height:0},this.sectionIndex=d||0,this.cfiBase=s||"",this.epubReadingSystem("epub.js",u.b),this.called=0,this.active=!0,this.listeners()}static get listenedEvents(){return u.a}width(n){var e=this.content;return n&&Object(x.isNumber)(n)&&(n+="px"),n&&(e.style.width=n),parseInt(this.window.getComputedStyle(e).width)}height(n){var e=this.content;return n&&Object(x.isNumber)(n)&&(n+="px"),n&&(e.style.height=n),parseInt(this.window.getComputedStyle(e).height)}contentWidth(n){var e=this.content||this.document.body;return n&&Object(x.isNumber)(n)&&(n+="px"),n&&(e.style.width=n),parseInt(this.window.getComputedStyle(e).width)}contentHeight(n){var e=this.content||this.document.body;return n&&Object(x.isNumber)(n)&&(n+="px"),n&&(e.style.height=n),parseInt(this.window.getComputedStyle(e).height)}textWidth(){let n,e,s=this.document.createRange(),d=this.content||this.document.body,l=Object(x.borders)(d);return s.selectNodeContents(d),n=s.getBoundingClientRect(),e=n.width,l&&l.width&&(e+=l.width),Math.round(e)}textHeight(){let n,e,s=this.document.createRange(),d=this.content||this.document.body;return s.selectNodeContents(d),n=s.getBoundingClientRect(),e=n.bottom,Math.round(e)}scrollWidth(){return this.documentElement.scrollWidth}scrollHeight(){return this.documentElement.scrollHeight}overflow(n){return n&&(this.documentElement.style.overflow=n),this.window.getComputedStyle(this.documentElement).overflow}overflowX(n){return n&&(this.documentElement.style.overflowX=n),this.window.getComputedStyle(this.documentElement).overflowX}overflowY(n){return n&&(this.documentElement.style.overflowY=n),this.window.getComputedStyle(this.documentElement).overflowY}css(n,e,s){var d=this.content||this.document.body;return e?d.style.setProperty(n,e,s?"important":""):d.style.removeProperty(n),this.window.getComputedStyle(d)[n]}viewport(n){var e,s=this.document.querySelector("meta[name='viewport']"),d={width:void 0,height:void 0,scale:void 0,minimum:void 0,maximum:void 0,scalable:void 0},l=[];if(s&&s.hasAttribute("content")){let f=s.getAttribute("content"),i=f.match(/width\s*=\s*([^,]*)/),w=f.match(/height\s*=\s*([^,]*)/),C=f.match(/initial-scale\s*=\s*([^,]*)/),L=f.match(/minimum-scale\s*=\s*([^,]*)/),F=f.match(/maximum-scale\s*=\s*([^,]*)/),W=f.match(/user-scalable\s*=\s*([^,]*)/);i&&i.length&&i[1]!==void 0&&(d.width=i[1]),w&&w.length&&w[1]!==void 0&&(d.height=w[1]),C&&C.length&&C[1]!==void 0&&(d.scale=C[1]),L&&L.length&&L[1]!==void 0&&(d.minimum=L[1]),F&&F.length&&F[1]!==void 0&&(d.maximum=F[1]),W&&W.length&&W[1]!==void 0&&(d.scalable=W[1])}return e=Object(x.defaults)(n||{},d),n&&(e.width&&l.push("width="+e.width),e.height&&l.push("height="+e.height),e.scale&&l.push("initial-scale="+e.scale),e.scalable==="no"?(l.push("minimum-scale="+e.scale),l.push("maximum-scale="+e.scale),l.push("user-scalable="+e.scalable)):(e.scalable&&l.push("user-scalable="+e.scalable),e.minimum&&l.push("minimum-scale="+e.minimum),e.maximum&&l.push("minimum-scale="+e.maximum)),s||((s=this.document.createElement("meta")).setAttribute("name","viewport"),this.document.querySelector("head").appendChild(s)),s.setAttribute("content",l.join(", ")),this.window.scrollTo(0,0)),e}expand(){this.emit(u.c.CONTENTS.EXPAND)}listeners(){this.imageLoadListeners(),this.mediaQueryListeners(),this.addEventListeners(),this.addSelectionListeners(),typeof ResizeObserver>"u"?(this.resizeListeners(),this.visibilityListeners()):this.resizeObservers(),this.linksHandler()}removeListeners(){this.removeEventListeners(),this.removeSelectionListeners(),this.observer&&this.observer.disconnect(),clearTimeout(this.expanding)}resizeCheck(){let n=this.textWidth(),e=this.textHeight();n==this._size.width&&e==this._size.height||(this._size={width:n,height:e},this.onResize&&this.onResize(this._size),this.emit(u.c.CONTENTS.RESIZE,this._size))}resizeListeners(){clearTimeout(this.expanding),requestAnimationFrame(this.resizeCheck.bind(this)),this.expanding=setTimeout(this.resizeListeners.bind(this),350)}visibilityListeners(){document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&this.active===!1?(this.active=!0,this.resizeListeners()):(this.active=!1,clearTimeout(this.expanding))})}transitionListeners(){let n=this.content;n.style.transitionProperty="font, font-size, font-size-adjust, font-stretch, font-variation-settings, font-weight, width, height",n.style.transitionDuration="0.001ms",n.style.transitionTimingFunction="linear",n.style.transitionDelay="0",this._resizeCheck=this.resizeCheck.bind(this),this.document.addEventListener("transitionend",this._resizeCheck)}mediaQueryListeners(){for(var n=this.document.styleSheets,e=function(f){f.matches&&!this._expanding&&setTimeout(this.expand.bind(this),1)}.bind(this),s=0;s<n.length;s+=1){var d;try{d=n[s].cssRules}catch{return}if(!d)return;for(var l=0;l<d.length;l+=1)d[l].media&&this.window.matchMedia(d[l].media.mediaText).addListener(e)}}resizeObservers(){this.observer=new ResizeObserver(n=>{requestAnimationFrame(this.resizeCheck.bind(this))}),this.observer.observe(this.document.documentElement)}mutationObservers(){this.observer=new MutationObserver(n=>{this.resizeCheck()}),this.observer.observe(this.document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})}imageLoadListeners(){for(var n,e=this.document.querySelectorAll("img"),s=0;s<e.length;s++)(n=e[s]).naturalWidth!==void 0&&n.naturalWidth===0&&(n.onload=this.expand.bind(this))}fontLoadListeners(){this.document&&this.document.fonts&&this.document.fonts.ready.then(function(){this.resizeCheck()}.bind(this))}root(){return this.document?this.document.documentElement:null}locationOf(n,e){var s,d={left:0,top:0};if(!this.document)return d;if(this.epubcfi.isCfiString(n)){let l=new v.a(n).toRange(this.document,e);if(l){try{if(!l.endContainer||l.startContainer==l.endContainer&&l.startOffset==l.endOffset){let f=l.startContainer.textContent.indexOf(" ",l.startOffset);f==-1&&(f=l.startContainer.textContent.length),l.setEnd(l.startContainer,f)}}catch(f){console.error("setting end offset to start container length failed",f)}if(l.startContainer.nodeType===Node.ELEMENT_NODE)s=l.startContainer.getBoundingClientRect(),d.left=s.left,d.top=s.top;else if(m){let f=l.startContainer,i=new Range;try{f.nodeType===1?s=f.getBoundingClientRect():l.startOffset+2<f.length?(i.setStart(f,l.startOffset),i.setEnd(f,l.startOffset+2),s=i.getBoundingClientRect()):l.startOffset-2>0?(i.setStart(f,l.startOffset-2),i.setEnd(f,l.startOffset),s=i.getBoundingClientRect()):s=f.parentNode.getBoundingClientRect()}catch(w){console.error(w,w.stack)}}else s=l.getBoundingClientRect()}}else if(typeof n=="string"&&n.indexOf("#")>-1){let l=n.substring(n.indexOf("#")+1),f=this.document.getElementById(l);if(f)if(m){let i=new Range;i.selectNode(f),s=i.getBoundingClientRect()}else s=f.getBoundingClientRect()}return s&&(d.left=s.left,d.top=s.top),d}addStylesheet(n){return new Promise(function(e,s){var d,l=!1;this.document?(d=this.document.querySelector("link[href='"+n+"']"))?e(!0):((d=this.document.createElement("link")).type="text/css",d.rel="stylesheet",d.href=n,d.onload=d.onreadystatechange=function(){l||this.readyState&&this.readyState!="complete"||(l=!0,setTimeout(()=>{e(!0)},1))},this.document.head.appendChild(d)):e(!1)}.bind(this))}_getStylesheetNode(n){var e;return n="epubjs-inserted-css-"+(n||""),!!this.document&&((e=this.document.getElementById(n))||((e=this.document.createElement("style")).id=n,this.document.head.appendChild(e)),e)}addStylesheetCss(n,e){return!(!this.document||!n)&&(this._getStylesheetNode(e).innerHTML=n,!0)}addStylesheetRules(n,e){var s;if(this.document&&n&&n.length!==0)if(s=this._getStylesheetNode(e).sheet,Object.prototype.toString.call(n)==="[object Array]")for(var d=0,l=n.length;d<l;d++){var f=1,i=n[d],w=n[d][0],C="";Object.prototype.toString.call(i[1][0])==="[object Array]"&&(i=i[1],f=0);for(var L=i.length;f<L;f++){var F=i[f];C+=F[0]+":"+F[1]+(F[2]?" !important":"")+`;
`}s.insertRule(w+"{"+C+"}",s.cssRules.length)}else Object.keys(n).forEach(W=>{const q=n[W];if(Array.isArray(q))q.forEach(G=>{const Y=Object.keys(G).map(Q=>`${Q}:${G[Q]}`).join(";");s.insertRule(`${W}{${Y}}`,s.cssRules.length)});else{const G=Object.keys(q).map(Y=>`${Y}:${q[Y]}`).join(";");s.insertRule(`${W}{${G}}`,s.cssRules.length)}})}addScript(n){return new Promise(function(e,s){var d,l=!1;this.document?((d=this.document.createElement("script")).type="text/javascript",d.async=!0,d.src=n,d.onload=d.onreadystatechange=function(){l||this.readyState&&this.readyState!="complete"||(l=!0,setTimeout(function(){e(!0)},1))},this.document.head.appendChild(d)):e(!1)}.bind(this))}addClass(n){var e;this.document&&(e=this.content||this.document.body)&&e.classList.add(n)}removeClass(n){var e;this.document&&(e=this.content||this.document.body)&&e.classList.remove(n)}addEventListeners(){this.document&&(this._triggerEvent=this.triggerEvent.bind(this),u.a.forEach(function(n){this.document.addEventListener(n,this._triggerEvent,{passive:!0})},this))}removeEventListeners(){this.document&&(u.a.forEach(function(n){this.document.removeEventListener(n,this._triggerEvent,{passive:!0})},this),this._triggerEvent=void 0)}triggerEvent(n){this.emit(n.type,n)}addSelectionListeners(){this.document&&(this._onSelectionChange=this.onSelectionChange.bind(this),this.document.addEventListener("selectionchange",this._onSelectionChange,{passive:!0}))}removeSelectionListeners(){this.document&&(this.document.removeEventListener("selectionchange",this._onSelectionChange,{passive:!0}),this._onSelectionChange=void 0)}onSelectionChange(n){this.selectionEndTimeout&&clearTimeout(this.selectionEndTimeout),this.selectionEndTimeout=setTimeout(function(){var e=this.window.getSelection();this.triggerSelectedEvent(e)}.bind(this),250)}triggerSelectedEvent(n){var e,s;n&&n.rangeCount>0&&((e=n.getRangeAt(0)).collapsed||(s=new v.a(e,this.cfiBase).toString(),this.emit(u.c.CONTENTS.SELECTED,s),this.emit(u.c.CONTENTS.SELECTED_RANGE,e)))}range(n,e){return new v.a(n).toRange(this.document,e)}cfiFromRange(n,e){return new v.a(n,this.cfiBase,e).toString()}cfiFromNode(n,e){return new v.a(n,this.cfiBase,e).toString()}map(n){return new h.a(n).section()}size(n,e){var s={scale:1,scalable:"no"};this.layoutStyle("scrolling"),n>=0&&(this.width(n),s.width=n,this.css("padding","0 "+n/12+"px")),e>=0&&(this.height(e),s.height=e),this.css("margin","0"),this.css("box-sizing","border-box"),this.viewport(s)}columns(n,e,s,d,l){let f=Object(x.prefixed)("column-axis"),i=Object(x.prefixed)("column-gap"),w=Object(x.prefixed)("column-width"),C=Object(x.prefixed)("column-fill"),L=this.writingMode().indexOf("vertical")===0?"vertical":"horizontal";this.layoutStyle("paginated"),l==="rtl"&&L==="horizontal"&&this.direction(l),this.width(n),this.height(e),this.viewport({width:n,height:e,scale:1,scalable:"no"}),this.css("overflow-y","hidden"),this.css("margin","0",!0),L==="vertical"?(this.css("padding-top",d/2+"px",!0),this.css("padding-bottom",d/2+"px",!0),this.css("padding-left","20px"),this.css("padding-right","20px"),this.css(f,"vertical")):(this.css("padding-top","20px"),this.css("padding-bottom","20px"),this.css("padding-left",d/2+"px",!0),this.css("padding-right",d/2+"px",!0),this.css(f,"horizontal")),this.css("box-sizing","border-box"),this.css("max-width","inherit"),this.css(C,"auto"),this.css(i,d+"px"),this.css(w,s+"px"),this.css("-webkit-line-box-contain","block glyphs replaced")}scaler(n,e,s){var d="scale("+n+")",l="";this.css("transform-origin","top left"),(e>=0||s>=0)&&(l=" translate("+(e||0)+"px, "+(s||0)+"px )"),this.css("transform",d+l)}fit(n,e,s){var d=this.viewport(),l=parseInt(d.width),f=parseInt(d.height),i=n/l,w=e/f,C=i<w?i:w;if(this.layoutStyle("paginated"),this.width(l),this.height(f),this.overflow("hidden"),this.scaler(C,0,0),this.css("background-size",l*C+"px "+f*C+"px"),this.css("background-color","transparent"),s&&s.properties.includes("page-spread-left")){var L=n-l*C;this.css("margin-left",L+"px")}}direction(n){this.documentElement&&(this.documentElement.style.direction=n)}mapPage(n,e,s,d,l){return new h.a(e,l).page(this,n,s,d)}linksHandler(){Object(p.c)(this.content,n=>{this.emit(u.c.CONTENTS.LINK_CLICKED,n)})}writingMode(n){let e=Object(x.prefixed)("writing-mode");return n&&this.documentElement&&(this.documentElement.style[e]=n),this.window.getComputedStyle(this.documentElement)[e]||""}layoutStyle(n){return n&&(this._layoutStyle=n,navigator.epubReadingSystem.layoutStyle=this._layoutStyle),this._layoutStyle||"paginated"}epubReadingSystem(n,e){return navigator.epubReadingSystem={name:n,version:e,layoutStyle:this.layoutStyle(),hasFeature:function(s){switch(s){case"dom-manipulation":case"layout-changes":case"touch-events":case"mouse-events":case"keyboard-events":return!0;case"spine-scripting":default:return!1}}},navigator.epubReadingSystem}destroy(){this.removeListeners()}}j()(y.prototype),P.a=y},function(V,P,N){Object.defineProperty(P,"__esModule",{value:!0}),P.Underline=P.Highlight=P.Mark=P.Pane=void 0;var A=function(){function m(y,k){for(var n=0;n<k.length;n++){var e=k[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(y,e.key,e)}}return function(y,k,n){return k&&m(y.prototype,k),n&&m(y,n),y}}(),j=v(N(49)),x=v(N(50));function v(m){return m&&m.__esModule?m:{default:m}}function h(m,y){if(!m)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!y||typeof y!="object"&&typeof y!="function"?m:y}function p(m,y){if(typeof y!="function"&&y!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof y);m.prototype=Object.create(y&&y.prototype,{constructor:{value:m,enumerable:!1,writable:!0,configurable:!0}}),y&&(Object.setPrototypeOf?Object.setPrototypeOf(m,y):m.__proto__=y)}function u(m,y){if(!(m instanceof y))throw new TypeError("Cannot call a class as a function")}P.Pane=function(){function m(y){var k=arguments.length>1&&arguments[1]!==void 0?arguments[1]:document.body;u(this,m),this.target=y,this.element=j.default.createElement("svg"),this.marks=[],this.element.style.position="absolute",this.element.setAttribute("pointer-events","none"),x.default.proxyMouse(this.target,this.marks),this.container=k,this.container.appendChild(this.element),this.render()}return A(m,[{key:"addMark",value:function(y){var k=j.default.createElement("g");return this.element.appendChild(k),y.bind(k,this.container),this.marks.push(y),y.render(),y}},{key:"removeMark",value:function(y){var k=this.marks.indexOf(y);if(k!==-1){var n=y.unbind();this.element.removeChild(n),this.marks.splice(k,1)}}},{key:"render",value:function(){var y,k,n,e;(function(w,C){w.style.setProperty("top",C.top+"px","important"),w.style.setProperty("left",C.left+"px","important"),w.style.setProperty("height",C.height+"px","important"),w.style.setProperty("width",C.width+"px","important")})(this.element,(y=this.target,k=this.container,n=k.getBoundingClientRect(),e=y.getBoundingClientRect(),{top:e.top-n.top,left:e.left-n.left,height:y.scrollHeight,width:y.scrollWidth}));var s=!0,d=!1,l=void 0;try{for(var f,i=this.marks[Symbol.iterator]();!(s=(f=i.next()).done);s=!0)f.value.render()}catch(w){d=!0,l=w}finally{try{!s&&i.return&&i.return()}finally{if(d)throw l}}}}]),m}();var b=P.Mark=function(){function m(){u(this,m),this.element=null}return A(m,[{key:"bind",value:function(y,k){this.element=y,this.container=k}},{key:"unbind",value:function(){var y=this.element;return this.element=null,y}},{key:"render",value:function(){}},{key:"dispatchEvent",value:function(y){this.element&&this.element.dispatchEvent(y)}},{key:"getBoundingClientRect",value:function(){return this.element.getBoundingClientRect()}},{key:"getClientRects",value:function(){for(var y=[],k=this.element.firstChild;k;)y.push(k.getBoundingClientRect()),k=k.nextSibling;return y}},{key:"filteredRanges",value:function(){var y=Array.from(this.range.getClientRects());return y.filter(function(k){for(var n=0;n<y.length;n++){if(y[n]===k)return!0;if(e=y[n],(s=k).right<=e.right&&s.left>=e.left&&s.top>=e.top&&s.bottom<=e.bottom)return!1}var e,s;return!0})}}]),m}(),T=P.Highlight=function(m){function y(k,n,e,s){u(this,y);var d=h(this,(y.__proto__||Object.getPrototypeOf(y)).call(this));return d.range=k,d.className=n,d.data=e||{},d.attributes=s||{},d}return p(y,m),A(y,[{key:"bind",value:function(k,n){for(var e in function s(d,l,f){d===null&&(d=Function.prototype);var i=Object.getOwnPropertyDescriptor(d,l);if(i===void 0){var w=Object.getPrototypeOf(d);return w===null?void 0:s(w,l,f)}if("value"in i)return i.value;var C=i.get;return C!==void 0?C.call(f):void 0}(y.prototype.__proto__||Object.getPrototypeOf(y.prototype),"bind",this).call(this,k,n),this.data)this.data.hasOwnProperty(e)&&(this.element.dataset[e]=this.data[e]);for(var e in this.attributes)this.attributes.hasOwnProperty(e)&&this.element.setAttribute(e,this.attributes[e]);this.className&&this.element.classList.add(this.className)}},{key:"render",value:function(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);for(var k=this.element.ownerDocument.createDocumentFragment(),n=this.filteredRanges(),e=this.element.getBoundingClientRect(),s=this.container.getBoundingClientRect(),d=0,l=n.length;d<l;d++){var f=n[d],i=j.default.createElement("rect");i.setAttribute("x",f.left-e.left+s.left),i.setAttribute("y",f.top-e.top+s.top),i.setAttribute("height",f.height),i.setAttribute("width",f.width),k.appendChild(i)}this.element.appendChild(k)}}]),y}(b);P.Underline=function(m){function y(k,n,e,s){return u(this,y),h(this,(y.__proto__||Object.getPrototypeOf(y)).call(this,k,n,e,s))}return p(y,m),A(y,[{key:"render",value:function(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);for(var k=this.element.ownerDocument.createDocumentFragment(),n=this.filteredRanges(),e=this.element.getBoundingClientRect(),s=this.container.getBoundingClientRect(),d=0,l=n.length;d<l;d++){var f=n[d],i=j.default.createElement("rect");i.setAttribute("x",f.left-e.left+s.left),i.setAttribute("y",f.top-e.top+s.top),i.setAttribute("height",f.height),i.setAttribute("width",f.width),i.setAttribute("fill","none");var w=j.default.createElement("line");w.setAttribute("x1",f.left-e.left+s.left),w.setAttribute("x2",f.left-e.left+s.left+f.width),w.setAttribute("y1",f.top-e.top+s.top+f.height-1),w.setAttribute("y2",f.top-e.top+s.top+f.height-1),w.setAttribute("stroke-width",1),w.setAttribute("stroke","black"),w.setAttribute("stroke-linecap","square"),k.appendChild(i),k.appendChild(w)}this.element.appendChild(k)}}]),y}(T)},function(V,P,N){function A(v,h){return h===void 0&&(h=Object),h&&typeof h.freeze=="function"?h.freeze(v):v}var j=A({HTML:"text/html",isHTML:function(v){return v===j.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),x=A({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(v){return v===x.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});P.freeze=A,P.MIME_TYPE=j,P.NAMESPACE=x},function(V,P,N){var A=N(25);P.DOMImplementation=A.DOMImplementation,P.XMLSerializer=A.XMLSerializer,P.DOMParser=N(46).DOMParser},function(V,P,N){var A=N(3),j=N.n(A),x=N(0),v=N(6),h=N(2),p=N(9),u=N(1);class b{constructor(i){this.settings=i,this.name=i.layout||"reflowable",this._spread=i.spread!=="none",this._minSpreadWidth=i.minSpreadWidth||800,this._evenSpreads=i.evenSpreads||!1,i.flow==="scrolled"||i.flow==="scrolled-continuous"||i.flow==="scrolled-doc"?this._flow="scrolled":this._flow="paginated",this.width=0,this.height=0,this.spreadWidth=0,this.delta=0,this.columnWidth=0,this.gap=0,this.divisor=1,this.props={name:this.name,spread:this._spread,flow:this._flow,width:0,height:0,spreadWidth:0,delta:0,columnWidth:0,gap:0,divisor:1}}flow(i){return i!==void 0&&(this._flow=i==="scrolled"||i==="scrolled-continuous"||i==="scrolled-doc"?"scrolled":"paginated",this.update({flow:this._flow})),this._flow}spread(i,w){return i&&(this._spread=i!=="none",this.update({spread:this._spread})),w>=0&&(this._minSpreadWidth=w),this._spread}calculate(i,w,C){var L,F,W,q,G=1,Y=C||0,Q=i,et=w,it=Math.floor(Q/12);G=this._spread&&Q>=this._minSpreadWidth?2:1,this.name!=="reflowable"||this._flow!=="paginated"||C>=0||(Y=it%2==0?it:it-1),this.name==="pre-paginated"&&(Y=0),G>1?W=(L=Q/G-Y)+Y:(L=Q,W=Q),this.name==="pre-paginated"&&G>1&&(Q=L),F=L*G+Y,q=Q,this.width=Q,this.height=et,this.spreadWidth=F,this.pageWidth=W,this.delta=q,this.columnWidth=L,this.gap=Y,this.divisor=G,this.update({width:Q,height:et,spreadWidth:F,pageWidth:W,delta:q,columnWidth:L,gap:Y,divisor:G})}format(i,w,C){return this.name==="pre-paginated"?i.fit(this.columnWidth,this.height,w):this._flow==="paginated"?i.columns(this.width,this.height,this.columnWidth,this.gap,this.settings.direction):C&&C==="horizontal"?i.size(null,this.height):i.size(this.width,null)}count(i,w){let C,L;return this.name==="pre-paginated"?(C=1,L=1):this._flow==="paginated"?(w=w||this.delta,C=Math.ceil(i/w),L=C*this.divisor):(w=w||this.height,C=Math.ceil(i/w),L=C),{spreads:C,pages:L}}update(i){if(Object.keys(i).forEach(w=>{this.props[w]===i[w]&&delete i[w]}),Object.keys(i).length>0){let w=Object(x.extend)(this.props,i);this.emit(u.c.LAYOUT.UPDATED,w,i)}}}j()(b.prototype);var T=b,m=N(5),y=class{constructor(f){this.rendition=f,this._themes={default:{rules:{},url:"",serialized:""}},this._overrides={},this._current="default",this._injected=[],this.rendition.hooks.content.register(this.inject.bind(this)),this.rendition.hooks.content.register(this.overrides.bind(this))}register(){if(arguments.length!==0)return arguments.length===1&&typeof arguments[0]=="object"?this.registerThemes(arguments[0]):arguments.length===1&&typeof arguments[0]=="string"?this.default(arguments[0]):arguments.length===2&&typeof arguments[1]=="string"?this.registerUrl(arguments[0],arguments[1]):arguments.length===2&&typeof arguments[1]=="object"?this.registerRules(arguments[0],arguments[1]):void 0}default(f){if(f)return typeof f=="string"?this.registerUrl("default",f):typeof f=="object"?this.registerRules("default",f):void 0}registerThemes(f){for(var i in f)f.hasOwnProperty(i)&&(typeof f[i]=="string"?this.registerUrl(i,f[i]):this.registerRules(i,f[i]))}registerCss(f,i){this._themes[f]={serialized:i},(this._injected[f]||f=="default")&&this.update(f)}registerUrl(f,i){var w=new m.a(i);this._themes[f]={url:w.toString()},(this._injected[f]||f=="default")&&this.update(f)}registerRules(f,i){this._themes[f]={rules:i},(this._injected[f]||f=="default")&&this.update(f)}select(f){var i=this._current;this._current=f,this.update(f),this.rendition.getContents().forEach(w=>{w.removeClass(i),w.addClass(f)})}update(f){this.rendition.getContents().forEach(i=>{this.add(f,i)})}inject(f){var i,w=[],C=this._themes;for(var L in C)!C.hasOwnProperty(L)||L!==this._current&&L!=="default"||(((i=C[L]).rules&&Object.keys(i.rules).length>0||i.url&&w.indexOf(i.url)===-1)&&this.add(L,f),this._injected.push(L));this._current!="default"&&f.addClass(this._current)}add(f,i){var w=this._themes[f];w&&i&&(w.url?i.addStylesheet(w.url):w.serialized?(i.addStylesheetCss(w.serialized,f),w.injected=!0):w.rules&&(i.addStylesheetRules(w.rules,f),w.injected=!0))}override(f,i,w){var C=this.rendition.getContents();this._overrides[f]={value:i,priority:w===!0},C.forEach(L=>{L.css(f,this._overrides[f].value,this._overrides[f].priority)})}removeOverride(f){var i=this.rendition.getContents();delete this._overrides[f],i.forEach(w=>{w.css(f)})}overrides(f){var i=this._overrides;for(var w in i)i.hasOwnProperty(w)&&f.css(w,i[w].value,i[w].priority)}fontSize(f){this.override("font-size",f)}font(f){this.override("font-family",f,!0)}destroy(){this.rendition=void 0,this._themes=void 0,this._overrides=void 0,this._current=void 0,this._injected=void 0}};N(12);class k{constructor({type:i,cfiRange:w,data:C,sectionIndex:L,cb:F,className:W,styles:q}){this.type=i,this.cfiRange=w,this.data=C,this.sectionIndex=L,this.mark=void 0,this.cb=F,this.className=W,this.styles=q}update(i){this.data=i}attach(i){let w,{cfiRange:C,data:L,type:F,mark:W,cb:q,className:G,styles:Y}=this;return F==="highlight"?w=i.highlight(C,L,q,G,Y):F==="underline"?w=i.underline(C,L,q,G,Y):F==="mark"&&(w=i.mark(C,L,q)),this.mark=w,this.emit(u.c.ANNOTATION.ATTACH,w),w}detach(i){let w,{cfiRange:C,type:L}=this;return i&&(L==="highlight"?w=i.unhighlight(C):L==="underline"?w=i.ununderline(C):L==="mark"&&(w=i.unmark(C))),this.mark=void 0,this.emit(u.c.ANNOTATION.DETACH,w),w}text(){}}j()(k.prototype);var n=class{constructor(f){this.rendition=f,this.highlights=[],this.underlines=[],this.marks=[],this._annotations={},this._annotationsBySectionIndex={},this.rendition.hooks.render.register(this.inject.bind(this)),this.rendition.hooks.unloaded.register(this.clear.bind(this))}add(f,i,w,C,L,F){let W=encodeURI(i+f),q=new h.a(i).spinePos,G=new k({type:f,cfiRange:i,data:w,sectionIndex:q,cb:C,className:L,styles:F});return this._annotations[W]=G,q in this._annotationsBySectionIndex?this._annotationsBySectionIndex[q].push(W):this._annotationsBySectionIndex[q]=[W],this.rendition.views().forEach(Y=>{G.sectionIndex===Y.index&&G.attach(Y)}),G}remove(f,i){let w=encodeURI(f+i);if(w in this._annotations){let C=this._annotations[w];if(i&&C.type!==i)return;this.rendition.views().forEach(L=>{this._removeFromAnnotationBySectionIndex(C.sectionIndex,w),C.sectionIndex===L.index&&C.detach(L)}),delete this._annotations[w]}}_removeFromAnnotationBySectionIndex(f,i){this._annotationsBySectionIndex[f]=this._annotationsAt(f).filter(w=>w!==i)}_annotationsAt(f){return this._annotationsBySectionIndex[f]}highlight(f,i,w,C,L){return this.add("highlight",f,i,w,C,L)}underline(f,i,w,C,L){return this.add("underline",f,i,w,C,L)}mark(f,i,w){return this.add("mark",f,i,w)}each(){return this._annotations.forEach.apply(this._annotations,arguments)}inject(f){let i=f.index;i in this._annotationsBySectionIndex&&this._annotationsBySectionIndex[i].forEach(w=>{this._annotations[w].attach(f)})}clear(f){let i=f.index;i in this._annotationsBySectionIndex&&this._annotationsBySectionIndex[i].forEach(w=>{this._annotations[w].detach(f)})}show(){}hide(){}},e=N(20),s=N(10),d=N(22);class l{constructor(i,w){this.settings=Object(x.extend)(this.settings||{},{width:null,height:null,ignoreClass:"",manager:"default",view:"iframe",flow:null,layout:null,spread:null,minSpreadWidth:800,stylesheet:null,resizeOnOrientationChange:!0,script:null,snap:!1,defaultDirection:"ltr",allowScriptedContent:!1,allowPopups:!1}),Object(x.extend)(this.settings,w),typeof this.settings.manager=="object"&&(this.manager=this.settings.manager),this.book=i,this.hooks={},this.hooks.display=new v.a(this),this.hooks.serialize=new v.a(this),this.hooks.content=new v.a(this),this.hooks.unloaded=new v.a(this),this.hooks.layout=new v.a(this),this.hooks.render=new v.a(this),this.hooks.show=new v.a(this),this.hooks.content.register(this.handleLinks.bind(this)),this.hooks.content.register(this.passEvents.bind(this)),this.hooks.content.register(this.adjustImages.bind(this)),this.book.spine.hooks.content.register(this.injectIdentifier.bind(this)),this.settings.stylesheet&&this.book.spine.hooks.content.register(this.injectStylesheet.bind(this)),this.settings.script&&this.book.spine.hooks.content.register(this.injectScript.bind(this)),this.themes=new y(this),this.annotations=new n(this),this.epubcfi=new h.a,this.q=new p.a(this),this.location=void 0,this.q.enqueue(this.book.opened),this.starting=new x.defer,this.started=this.starting.promise,this.q.enqueue(this.start)}setManager(i){this.manager=i}requireManager(i){return typeof i=="string"&&i==="default"?s.a:typeof i=="string"&&i==="continuous"?d.a:i}requireView(i){return typeof i=="string"&&i==="iframe"?e.a:i}start(){switch(this.settings.layout||this.book.package.metadata.layout!=="pre-paginated"&&this.book.displayOptions.fixedLayout!=="true"||(this.settings.layout="pre-paginated"),this.book.package.metadata.spread){case"none":this.settings.spread="none";break;case"both":this.settings.spread=!0}this.manager||(this.ViewManager=this.requireManager(this.settings.manager),this.View=this.requireView(this.settings.view),this.manager=new this.ViewManager({view:this.View,queue:this.q,request:this.book.load.bind(this.book),settings:this.settings})),this.direction(this.book.package.metadata.direction||this.settings.defaultDirection),this.settings.globalLayoutProperties=this.determineLayoutProperties(this.book.package.metadata),this.flow(this.settings.globalLayoutProperties.flow),this.layout(this.settings.globalLayoutProperties),this.manager.on(u.c.MANAGERS.ADDED,this.afterDisplayed.bind(this)),this.manager.on(u.c.MANAGERS.REMOVED,this.afterRemoved.bind(this)),this.manager.on(u.c.MANAGERS.RESIZED,this.onResized.bind(this)),this.manager.on(u.c.MANAGERS.ORIENTATION_CHANGE,this.onOrientationChange.bind(this)),this.manager.on(u.c.MANAGERS.SCROLLED,this.reportLocation.bind(this)),this.emit(u.c.RENDITION.STARTED),this.starting.resolve()}attachTo(i){return this.q.enqueue(function(){this.manager.render(i,{width:this.settings.width,height:this.settings.height}),this.emit(u.c.RENDITION.ATTACHED)}.bind(this))}display(i){return this.displaying&&this.displaying.resolve(),this.q.enqueue(this._display,i)}_display(i){if(this.book){this.epubcfi.isCfiString(i);var w,C=new x.defer,L=C.promise;return this.displaying=C,this.book.locations.length()&&Object(x.isFloat)(i)&&(i=this.book.locations.cfiFromPercentage(parseFloat(i))),(w=this.book.spine.get(i))?(this.manager.display(w,i).then(()=>{C.resolve(w),this.displaying=void 0,this.emit(u.c.RENDITION.DISPLAYED,w),this.reportLocation()},F=>{this.emit(u.c.RENDITION.DISPLAY_ERROR,F)}),L):(C.reject(new Error("No Section Found")),L)}}afterDisplayed(i){i.on(u.c.VIEWS.MARK_CLICKED,(w,C)=>this.triggerMarkEvent(w,C,i.contents)),this.hooks.render.trigger(i,this).then(()=>{i.contents?this.hooks.content.trigger(i.contents,this).then(()=>{this.emit(u.c.RENDITION.RENDERED,i.section,i)}):this.emit(u.c.RENDITION.RENDERED,i.section,i)})}afterRemoved(i){this.hooks.unloaded.trigger(i,this).then(()=>{this.emit(u.c.RENDITION.REMOVED,i.section,i)})}onResized(i,w){this.emit(u.c.RENDITION.RESIZED,{width:i.width,height:i.height},w),this.location&&this.location.start&&this.display(w||this.location.start.cfi)}onOrientationChange(i){this.emit(u.c.RENDITION.ORIENTATION_CHANGE,i)}moveTo(i){this.manager.moveTo(i)}resize(i,w,C){i&&(this.settings.width=i),w&&(this.settings.height=w),this.manager.resize(i,w,C)}clear(){this.manager.clear()}next(){return this.q.enqueue(this.manager.next.bind(this.manager)).then(this.reportLocation.bind(this))}prev(){return this.q.enqueue(this.manager.prev.bind(this.manager)).then(this.reportLocation.bind(this))}determineLayoutProperties(i){var w=this.settings.layout||i.layout||"reflowable",C=this.settings.spread||i.spread||"auto",L=this.settings.orientation||i.orientation||"auto",F=this.settings.flow||i.flow||"auto",W=i.viewport||"",q=this.settings.minSpreadWidth||i.minSpreadWidth||800,G=this.settings.direction||i.direction||"ltr";return(this.settings.width===0||this.settings.width>0)&&(this.settings.height===0||this.settings.height),{layout:w,spread:C,orientation:L,flow:F,viewport:W,minSpreadWidth:q,direction:G}}flow(i){var w=i;i!=="scrolled"&&i!=="scrolled-doc"&&i!=="scrolled-continuous"||(w="scrolled"),i!=="auto"&&i!=="paginated"||(w="paginated"),this.settings.flow=i,this._layout&&this._layout.flow(w),this.manager&&this._layout&&this.manager.applyLayout(this._layout),this.manager&&this.manager.updateFlow(w),this.manager&&this.manager.isRendered()&&this.location&&(this.manager.clear(),this.display(this.location.start.cfi))}layout(i){return i&&(this._layout=new T(i),this._layout.spread(i.spread,this.settings.minSpreadWidth),this._layout.on(u.c.LAYOUT.UPDATED,(w,C)=>{this.emit(u.c.RENDITION.LAYOUT,w,C)})),this.manager&&this._layout&&this.manager.applyLayout(this._layout),this._layout}spread(i,w){this.settings.spread=i,w&&(this.settings.minSpreadWidth=w),this._layout&&this._layout.spread(i,w),this.manager&&this.manager.isRendered()&&this.manager.updateLayout()}direction(i){this.settings.direction=i||"ltr",this.manager&&this.manager.direction(this.settings.direction),this.manager&&this.manager.isRendered()&&this.location&&(this.manager.clear(),this.display(this.location.start.cfi))}reportLocation(){return this.q.enqueue(function(){requestAnimationFrame(function(){var i=this.manager.currentLocation();if(i&&i.then&&typeof i.then=="function")i.then(function(w){let C=this.located(w);C&&C.start&&C.end&&(this.location=C,this.emit(u.c.RENDITION.LOCATION_CHANGED,{index:this.location.start.index,href:this.location.start.href,start:this.location.start.cfi,end:this.location.end.cfi,percentage:this.location.start.percentage}),this.emit(u.c.RENDITION.RELOCATED,this.location))}.bind(this));else if(i){let w=this.located(i);if(!w||!w.start||!w.end)return;this.location=w,this.emit(u.c.RENDITION.LOCATION_CHANGED,{index:this.location.start.index,href:this.location.start.href,start:this.location.start.cfi,end:this.location.end.cfi,percentage:this.location.start.percentage}),this.emit(u.c.RENDITION.RELOCATED,this.location)}}.bind(this))}.bind(this))}currentLocation(){var i=this.manager.currentLocation();if(i&&i.then&&typeof i.then=="function")i.then(function(w){return this.located(w)}.bind(this));else if(i)return this.located(i)}located(i){if(!i.length)return{};let w=i[0],C=i[i.length-1],L={start:{index:w.index,href:w.href,cfi:w.mapping.start,displayed:{page:w.pages[0]||1,total:w.totalPages}},end:{index:C.index,href:C.href,cfi:C.mapping.end,displayed:{page:C.pages[C.pages.length-1]||1,total:C.totalPages}}},F=this.book.locations.locationFromCfi(w.mapping.start),W=this.book.locations.locationFromCfi(C.mapping.end);F!=null&&(L.start.location=F,L.start.percentage=this.book.locations.percentageFromLocation(F)),W!=null&&(L.end.location=W,L.end.percentage=this.book.locations.percentageFromLocation(W));let q=this.book.pageList.pageFromCfi(w.mapping.start),G=this.book.pageList.pageFromCfi(C.mapping.end);return q!=-1&&(L.start.page=q),G!=-1&&(L.end.page=G),C.index===this.book.spine.last().index&&L.end.displayed.page>=L.end.displayed.total&&(L.atEnd=!0),w.index===this.book.spine.first().index&&L.start.displayed.page===1&&(L.atStart=!0),L}destroy(){this.manager&&this.manager.destroy(),this.book=void 0}passEvents(i){u.a.forEach(w=>{i.on(w,C=>this.triggerViewEvent(C,i))}),i.on(u.c.CONTENTS.SELECTED,w=>this.triggerSelectedEvent(w,i))}triggerViewEvent(i,w){this.emit(i.type,i,w)}triggerSelectedEvent(i,w){this.emit(u.c.RENDITION.SELECTED,i,w)}triggerMarkEvent(i,w,C){this.emit(u.c.RENDITION.MARK_CLICKED,i,w,C)}getRange(i,w){var C=new h.a(i),L=this.manager.visible().filter(function(F){if(C.spinePos===F.index)return!0});if(L.length)return L[0].contents.range(C,w)}adjustImages(i){if(this._layout.name==="pre-paginated")return new Promise(function(F){F()});let w=i.window.getComputedStyle(i.content,null),C=.95*(i.content.offsetHeight-(parseFloat(w.paddingTop)+parseFloat(w.paddingBottom))),L=parseFloat(w.paddingLeft)+parseFloat(w.paddingRight);return i.addStylesheetRules({img:{"max-width":(this._layout.columnWidth?this._layout.columnWidth-L+"px":"100%")+"!important","max-height":C+"px!important","object-fit":"contain","page-break-inside":"avoid","break-inside":"avoid","box-sizing":"border-box"},svg:{"max-width":(this._layout.columnWidth?this._layout.columnWidth-L+"px":"100%")+"!important","max-height":C+"px!important","page-break-inside":"avoid","break-inside":"avoid"}}),new Promise(function(F,W){setTimeout(function(){F()},1)})}getContents(){return this.manager?this.manager.getContents():[]}views(){return(this.manager?this.manager.views:void 0)||[]}handleLinks(i){i&&i.on(u.c.CONTENTS.LINK_CLICKED,w=>{let C=this.book.path.relative(w);this.display(C)})}injectStylesheet(i,w){let C=i.createElement("link");C.setAttribute("type","text/css"),C.setAttribute("rel","stylesheet"),C.setAttribute("href",this.settings.stylesheet),i.getElementsByTagName("head")[0].appendChild(C)}injectScript(i,w){let C=i.createElement("script");C.setAttribute("type","text/javascript"),C.setAttribute("src",this.settings.script),C.textContent=" ",i.getElementsByTagName("head")[0].appendChild(C)}injectIdentifier(i,w){let C=this.book.packaging.metadata.identifier,L=i.createElement("meta");L.setAttribute("name","dc.relation.ispartof"),C&&L.setAttribute("content",C),i.getElementsByTagName("head")[0].appendChild(L)}}j()(l.prototype),P.a=l},function(V,P){var N;N=function(){return this}();try{N=N||new Function("return this")()}catch{typeof window=="object"&&(N=window)}V.exports=N},function(V,P,N){var A=N(38)();V.exports=function(j){return j!==A&&j!==null}},function(V,P){V.exports=function(N){var A=typeof N;return N!=null&&(A=="object"||A=="function")}},function(V,P,N){var A=N(3),j=N.n(A),x=N(0),v=N(2),h=N(12),p=N(1),u=N(13);class b{constructor(m,y){this.settings=Object(x.extend)({ignoreClass:"",axis:void 0,direction:void 0,width:0,height:0,layout:void 0,globalLayoutProperties:{},method:void 0,forceRight:!1,allowScriptedContent:!1,allowPopups:!1},y||{}),this.id="epubjs-view-"+Object(x.uuid)(),this.section=m,this.index=m.index,this.element=this.container(this.settings.axis),this.added=!1,this.displayed=!1,this.rendered=!1,this.fixedWidth=0,this.fixedHeight=0,this.epubcfi=new v.a,this.layout=this.settings.layout,this.pane=void 0,this.highlights={},this.underlines={},this.marks={}}container(m){var y=document.createElement("div");return y.classList.add("epub-view"),y.style.height="0px",y.style.width="0px",y.style.overflow="hidden",y.style.position="relative",y.style.display="block",y.style.flex=m&&m=="horizontal"?"none":"initial",y}create(){return this.iframe||(this.element||(this.element=this.createContainer()),this.iframe=document.createElement("iframe"),this.iframe.id=this.id,this.iframe.scrolling="no",this.iframe.style.overflow="hidden",this.iframe.seamless="seamless",this.iframe.style.border="none",this.iframe.sandbox="allow-same-origin",this.settings.allowScriptedContent&&(this.iframe.sandbox+=" allow-scripts"),this.settings.allowPopups&&(this.iframe.sandbox+=" allow-popups"),this.iframe.setAttribute("enable-annotation","true"),this.resizing=!0,this.element.style.visibility="hidden",this.iframe.style.visibility="hidden",this.iframe.style.width="0",this.iframe.style.height="0",this._width=0,this._height=0,this.element.setAttribute("ref",this.index),this.added=!0,this.elementBounds=Object(x.bounds)(this.element),"srcdoc"in this.iframe?this.supportsSrcdoc=!0:this.supportsSrcdoc=!1,this.settings.method||(this.settings.method=this.supportsSrcdoc?"srcdoc":"write")),this.iframe}render(m,y){return this.create(),this.size(),this.sectionRender||(this.sectionRender=this.section.render(m)),this.sectionRender.then(function(k){return this.load(k)}.bind(this)).then(function(){let k,n=this.contents.writingMode();return k=this.settings.flow==="scrolled"?n.indexOf("vertical")===0?"horizontal":"vertical":n.indexOf("vertical")===0?"vertical":"horizontal",n.indexOf("vertical")===0&&this.settings.flow==="paginated"&&(this.layout.delta=this.layout.height),this.setAxis(k),this.emit(p.c.VIEWS.AXIS,k),this.setWritingMode(n),this.emit(p.c.VIEWS.WRITING_MODE,n),this.layout.format(this.contents,this.section,this.axis),this.addListeners(),new Promise((e,s)=>{this.expand(),this.settings.forceRight&&(this.element.style.marginLeft=this.width()+"px"),e()})}.bind(this),function(k){return this.emit(p.c.VIEWS.LOAD_ERROR,k),new Promise((n,e)=>{e(k)})}.bind(this)).then(function(){this.emit(p.c.VIEWS.RENDERED,this.section)}.bind(this))}reset(){this.iframe&&(this.iframe.style.width="0",this.iframe.style.height="0",this._width=0,this._height=0,this._textWidth=void 0,this._contentWidth=void 0,this._textHeight=void 0,this._contentHeight=void 0),this._needsReframe=!0}size(m,y){var k=m||this.settings.width,n=y||this.settings.height;this.layout.name==="pre-paginated"?this.lock("both",k,n):this.settings.axis==="horizontal"?this.lock("height",k,n):this.lock("width",k,n),this.settings.width=k,this.settings.height=n}lock(m,y,k){var n,e=Object(x.borders)(this.element);n=this.iframe?Object(x.borders)(this.iframe):{width:0,height:0},m=="width"&&Object(x.isNumber)(y)&&(this.lockedWidth=y-e.width-n.width),m=="height"&&Object(x.isNumber)(k)&&(this.lockedHeight=k-e.height-n.height),m==="both"&&Object(x.isNumber)(y)&&Object(x.isNumber)(k)&&(this.lockedWidth=y-e.width-n.width,this.lockedHeight=k-e.height-n.height),this.displayed&&this.iframe&&this.expand()}expand(m){var y,k=this.lockedWidth,n=this.lockedHeight;this.iframe&&!this._expanding&&(this._expanding=!0,this.layout.name==="pre-paginated"?(k=this.layout.columnWidth,n=this.layout.height):this.settings.axis==="horizontal"?((k=this.contents.textWidth())%this.layout.pageWidth>0&&(k=Math.ceil(k/this.layout.pageWidth)*this.layout.pageWidth),this.settings.forceEvenPages&&(y=k/this.layout.pageWidth,this.layout.divisor>1&&this.layout.name==="reflowable"&&y%2>0&&(k+=this.layout.pageWidth))):this.settings.axis==="vertical"&&(n=this.contents.textHeight(),this.settings.flow==="paginated"&&n%this.layout.height>0&&(n=Math.ceil(n/this.layout.height)*this.layout.height)),(this._needsReframe||k!=this._width||n!=this._height)&&this.reframe(k,n),this._expanding=!1)}reframe(m,y){var k;Object(x.isNumber)(m)&&(this.element.style.width=m+"px",this.iframe.style.width=m+"px",this._width=m),Object(x.isNumber)(y)&&(this.element.style.height=y+"px",this.iframe.style.height=y+"px",this._height=y),k={width:m,height:y,widthDelta:this.prevBounds?m-this.prevBounds.width:m,heightDelta:this.prevBounds?y-this.prevBounds.height:y},this.pane&&this.pane.render(),requestAnimationFrame(()=>{let n;for(let e in this.marks)this.marks.hasOwnProperty(e)&&(n=this.marks[e],this.placeMark(n.element,n.range))}),this.onResize(this,k),this.emit(p.c.VIEWS.RESIZED,k),this.prevBounds=k,this.elementBounds=Object(x.bounds)(this.element)}load(m){var y=new x.defer,k=y.promise;if(!this.iframe)return y.reject(new Error("No Iframe Available")),k;if(this.iframe.onload=function(e){this.onLoad(e,y)}.bind(this),this.settings.method==="blobUrl")this.blobUrl=Object(x.createBlobUrl)(m,"application/xhtml+xml"),this.iframe.src=this.blobUrl,this.element.appendChild(this.iframe);else if(this.settings.method==="srcdoc")this.iframe.srcdoc=m,this.element.appendChild(this.iframe);else{if(this.element.appendChild(this.iframe),this.document=this.iframe.contentDocument,!this.document)return y.reject(new Error("No Document Available")),k;if(this.iframe.contentDocument.open(),window.MSApp&&MSApp.execUnsafeLocalFunction){var n=this;MSApp.execUnsafeLocalFunction(function(){n.iframe.contentDocument.write(m)})}else this.iframe.contentDocument.write(m);this.iframe.contentDocument.close()}return k}onLoad(m,y){this.window=this.iframe.contentWindow,this.document=this.iframe.contentDocument,this.contents=new h.a(this.document,this.document.body,this.section.cfiBase,this.section.index),this.rendering=!1;var k=this.document.querySelector("link[rel='canonical']");k?k.setAttribute("href",this.section.canonical):((k=this.document.createElement("link")).setAttribute("rel","canonical"),k.setAttribute("href",this.section.canonical),this.document.querySelector("head").appendChild(k)),this.contents.on(p.c.CONTENTS.EXPAND,()=>{this.displayed&&this.iframe&&(this.expand(),this.contents&&this.layout.format(this.contents))}),this.contents.on(p.c.CONTENTS.RESIZE,n=>{this.displayed&&this.iframe&&(this.expand(),this.contents&&this.layout.format(this.contents))}),y.resolve(this.contents)}setLayout(m){this.layout=m,this.contents&&(this.layout.format(this.contents),this.expand())}setAxis(m){this.settings.axis=m,this.element.style.flex=m=="horizontal"?"none":"initial",this.size()}setWritingMode(m){this.writingMode=m}addListeners(){}removeListeners(m){}display(m){var y=new x.defer;return this.displayed?y.resolve(this):this.render(m).then(function(){this.emit(p.c.VIEWS.DISPLAYED,this),this.onDisplayed(this),this.displayed=!0,y.resolve(this)}.bind(this),function(k){y.reject(k,this)}),y.promise}show(){this.element.style.visibility="visible",this.iframe&&(this.iframe.style.visibility="visible",this.iframe.style.transform="translateZ(0)",this.iframe.offsetWidth,this.iframe.style.transform=null),this.emit(p.c.VIEWS.SHOWN,this)}hide(){this.element.style.visibility="hidden",this.iframe.style.visibility="hidden",this.stopExpanding=!0,this.emit(p.c.VIEWS.HIDDEN,this)}offset(){return{top:this.element.offsetTop,left:this.element.offsetLeft}}width(){return this._width}height(){return this._height}position(){return this.element.getBoundingClientRect()}locationOf(m){this.iframe.getBoundingClientRect();var y=this.contents.locationOf(m,this.settings.ignoreClass);return{left:y.left,top:y.top}}onDisplayed(m){}onResize(m,y){}bounds(m){return!m&&this.elementBounds||(this.elementBounds=Object(x.bounds)(this.element)),this.elementBounds}highlight(m,y={},k,n="epubjs-hl",e={}){if(!this.contents)return;const s=Object.assign({fill:"yellow","fill-opacity":"0.3","mix-blend-mode":"multiply"},e);let d=this.contents.range(m),l=()=>{this.emit(p.c.VIEWS.MARK_CLICKED,m,y)};y.epubcfi=m,this.pane||(this.pane=new u.Pane(this.iframe,this.element));let f=new u.Highlight(d,n,y,s),i=this.pane.addMark(f);return this.highlights[m]={mark:i,element:i.element,listeners:[l,k]},i.element.setAttribute("ref",n),i.element.addEventListener("click",l),i.element.addEventListener("touchstart",l),k&&(i.element.addEventListener("click",k),i.element.addEventListener("touchstart",k)),i}underline(m,y={},k,n="epubjs-ul",e={}){if(!this.contents)return;const s=Object.assign({stroke:"black","stroke-opacity":"0.3","mix-blend-mode":"multiply"},e);let d=this.contents.range(m),l=()=>{this.emit(p.c.VIEWS.MARK_CLICKED,m,y)};y.epubcfi=m,this.pane||(this.pane=new u.Pane(this.iframe,this.element));let f=new u.Underline(d,n,y,s),i=this.pane.addMark(f);return this.underlines[m]={mark:i,element:i.element,listeners:[l,k]},i.element.setAttribute("ref",n),i.element.addEventListener("click",l),i.element.addEventListener("touchstart",l),k&&(i.element.addEventListener("click",k),i.element.addEventListener("touchstart",k)),i}mark(m,y={},k){if(!this.contents)return;if(m in this.marks)return this.marks[m];let n=this.contents.range(m);if(!n)return;let e=n.commonAncestorContainer,s=e.nodeType===1?e:e.parentNode,d=f=>{this.emit(p.c.VIEWS.MARK_CLICKED,m,y)};n.collapsed&&e.nodeType===1?(n=new Range,n.selectNodeContents(e)):n.collapsed&&(n=new Range,n.selectNodeContents(s));let l=this.document.createElement("a");return l.setAttribute("ref","epubjs-mk"),l.style.position="absolute",l.dataset.epubcfi=m,y&&Object.keys(y).forEach(f=>{l.dataset[f]=y[f]}),k&&(l.addEventListener("click",k),l.addEventListener("touchstart",k)),l.addEventListener("click",d),l.addEventListener("touchstart",d),this.placeMark(l,n),this.element.appendChild(l),this.marks[m]={element:l,range:n,listeners:[d,k]},s}placeMark(m,y){let k,n,e;if(this.layout.name==="pre-paginated"||this.settings.axis!=="horizontal"){let d=y.getBoundingClientRect();k=d.top,n=d.right}else{let d,l=y.getClientRects();for(var s=0;s!=l.length;s++)d=l[s],(!e||d.left<e)&&(e=d.left,n=Math.ceil(e/this.layout.props.pageWidth)*this.layout.props.pageWidth-this.layout.gap/2,k=d.top)}m.style.top=k+"px",m.style.left=n+"px"}unhighlight(m){let y;m in this.highlights&&(y=this.highlights[m],this.pane.removeMark(y.mark),y.listeners.forEach(k=>{k&&(y.element.removeEventListener("click",k),y.element.removeEventListener("touchstart",k))}),delete this.highlights[m])}ununderline(m){let y;m in this.underlines&&(y=this.underlines[m],this.pane.removeMark(y.mark),y.listeners.forEach(k=>{k&&(y.element.removeEventListener("click",k),y.element.removeEventListener("touchstart",k))}),delete this.underlines[m])}unmark(m){let y;m in this.marks&&(y=this.marks[m],this.element.removeChild(y.element),y.listeners.forEach(k=>{k&&(y.element.removeEventListener("click",k),y.element.removeEventListener("touchstart",k))}),delete this.marks[m])}destroy(){for(let m in this.highlights)this.unhighlight(m);for(let m in this.underlines)this.ununderline(m);for(let m in this.marks)this.unmark(m);this.blobUrl&&Object(x.revokeBlobUrl)(this.blobUrl),this.displayed&&(this.displayed=!1,this.removeListeners(),this.contents.destroy(),this.stopExpanding=!0,this.element.removeChild(this.iframe),this.pane&&(this.pane.element.remove(),this.pane=void 0),this.iframe=void 0,this.contents=void 0,this._textWidth=null,this._textHeight=null,this._width=null,this._height=null)}}j()(b.prototype),P.a=b},function(V,P,N){var A=N(19),j=N(51),x=N(53),v=Math.max,h=Math.min;V.exports=function(p,u,b){var T,m,y,k,n,e,s=0,d=!1,l=!1,f=!0;if(typeof p!="function")throw new TypeError("Expected a function");function i(q){var G=T,Y=m;return T=m=void 0,s=q,k=p.apply(Y,G)}function w(q){return s=q,n=setTimeout(L,u),d?i(q):k}function C(q){var G=q-e;return e===void 0||G>=u||G<0||l&&q-s>=y}function L(){var q=j();if(C(q))return F(q);n=setTimeout(L,function(G){var Y=u-(G-e);return l?h(Y,y-(G-s)):Y}(q))}function F(q){return n=void 0,f&&T?i(q):(T=m=void 0,k)}function W(){var q=j(),G=C(q);if(T=arguments,m=this,e=q,G){if(n===void 0)return w(e);if(l)return clearTimeout(n),n=setTimeout(L,u),i(e)}return n===void 0&&(n=setTimeout(L,u)),k}return u=x(u)||0,A(b)&&(d=!!b.leading,y=(l="maxWait"in b)?v(x(b.maxWait)||0,u):y,f="trailing"in b?!!b.trailing:f),W.cancel=function(){n!==void 0&&clearTimeout(n),s=0,T=e=m=n=void 0},W.flush=function(){return n===void 0?k:F(j())},W}},function(V,P,N){var A=N(0),j=N(10),x=N(1),v=N(3),h=N.n(v);const p=Math.PI/2,u={easeOutSine:function(n){return Math.sin(n*p)},easeInOutSine:function(n){return-.5*(Math.cos(Math.PI*n)-1)},easeInOutQuint:function(n){return(n/=.5)<1?.5*Math.pow(n,5):.5*(Math.pow(n-2,5)+2)},easeInCubic:function(n){return Math.pow(n,3)}};class b{constructor(e,s){this.settings=Object(A.extend)({duration:80,minVelocity:.2,minDistance:10,easing:u.easeInCubic},s||{}),this.supportsTouch=this.supportsTouch(),this.supportsTouch&&this.setup(e)}setup(e){this.manager=e,this.layout=this.manager.layout,this.fullsize=this.manager.settings.fullsize,this.fullsize?(this.element=this.manager.stage.element,this.scroller=window,this.disableScroll()):(this.element=this.manager.stage.container,this.scroller=this.element,this.element.style.WebkitOverflowScrolling="touch"),this.manager.settings.offset=this.layout.width,this.manager.settings.afterScrolledTimeout=2*this.settings.duration,this.isVertical=this.manager.settings.axis==="vertical",this.manager.isPaginated&&!this.isVertical&&(this.touchCanceler=!1,this.resizeCanceler=!1,this.snapping=!1,this.scrollLeft,this.scrollTop,this.startTouchX=void 0,this.startTouchY=void 0,this.startTime=void 0,this.endTouchX=void 0,this.endTouchY=void 0,this.endTime=void 0,this.addListeners())}supportsTouch(){return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)}disableScroll(){this.element.style.overflow="hidden"}enableScroll(){this.element.style.overflow=""}addListeners(){this._onResize=this.onResize.bind(this),window.addEventListener("resize",this._onResize),this._onScroll=this.onScroll.bind(this),this.scroller.addEventListener("scroll",this._onScroll),this._onTouchStart=this.onTouchStart.bind(this),this.scroller.addEventListener("touchstart",this._onTouchStart,{passive:!0}),this.on("touchstart",this._onTouchStart),this._onTouchMove=this.onTouchMove.bind(this),this.scroller.addEventListener("touchmove",this._onTouchMove,{passive:!0}),this.on("touchmove",this._onTouchMove),this._onTouchEnd=this.onTouchEnd.bind(this),this.scroller.addEventListener("touchend",this._onTouchEnd,{passive:!0}),this.on("touchend",this._onTouchEnd),this._afterDisplayed=this.afterDisplayed.bind(this),this.manager.on(x.c.MANAGERS.ADDED,this._afterDisplayed)}removeListeners(){window.removeEventListener("resize",this._onResize),this._onResize=void 0,this.scroller.removeEventListener("scroll",this._onScroll),this._onScroll=void 0,this.scroller.removeEventListener("touchstart",this._onTouchStart,{passive:!0}),this.off("touchstart",this._onTouchStart),this._onTouchStart=void 0,this.scroller.removeEventListener("touchmove",this._onTouchMove,{passive:!0}),this.off("touchmove",this._onTouchMove),this._onTouchMove=void 0,this.scroller.removeEventListener("touchend",this._onTouchEnd,{passive:!0}),this.off("touchend",this._onTouchEnd),this._onTouchEnd=void 0,this.manager.off(x.c.MANAGERS.ADDED,this._afterDisplayed),this._afterDisplayed=void 0}afterDisplayed(e){let s=e.contents;["touchstart","touchmove","touchend"].forEach(d=>{s.on(d,l=>this.triggerViewEvent(l,s))})}triggerViewEvent(e,s){this.emit(e.type,e,s)}onScroll(e){this.scrollLeft=this.fullsize?window.scrollX:this.scroller.scrollLeft,this.scrollTop=this.fullsize?window.scrollY:this.scroller.scrollTop}onResize(e){this.resizeCanceler=!0}onTouchStart(e){let{screenX:s,screenY:d}=e.touches[0];this.fullsize&&this.enableScroll(),this.touchCanceler=!0,this.startTouchX||(this.startTouchX=s,this.startTouchY=d,this.startTime=this.now()),this.endTouchX=s,this.endTouchY=d,this.endTime=this.now()}onTouchMove(e){let{screenX:s,screenY:d}=e.touches[0],l=Math.abs(d-this.endTouchY);this.touchCanceler=!0,!this.fullsize&&l<10&&(this.element.scrollLeft-=s-this.endTouchX),this.endTouchX=s,this.endTouchY=d,this.endTime=this.now()}onTouchEnd(e){this.fullsize&&this.disableScroll(),this.touchCanceler=!1;let s=this.wasSwiped();s!==0?this.snap(s):this.snap(),this.startTouchX=void 0,this.startTouchY=void 0,this.startTime=void 0,this.endTouchX=void 0,this.endTouchY=void 0,this.endTime=void 0}wasSwiped(){let e=this.layout.pageWidth*this.layout.divisor,s=this.endTouchX-this.startTouchX,d=Math.abs(s),l=s/(this.endTime-this.startTime),f=this.settings.minVelocity;return d<=this.settings.minDistance||d>=e?0:l>f?-1:l<-f?1:void 0}needsSnap(){return this.scrollLeft%(this.layout.pageWidth*this.layout.divisor)!=0}snap(e=0){let s=this.scrollLeft,d=this.layout.pageWidth*this.layout.divisor,l=Math.round(s/d)*d;return e&&(l+=e*d),this.smoothScrollTo(l)}smoothScrollTo(e){const s=new A.defer,d=this.scrollLeft,l=this.now(),f=this.settings.duration,i=this.settings.easing;return this.snapping=!0,function w(){const C=this.now(),L=Math.min(1,(C-l)/f);if(i(L),this.touchCanceler||this.resizeCanceler)return this.resizeCanceler=!1,this.snapping=!1,void s.resolve();L<1?(window.requestAnimationFrame(w.bind(this)),this.scrollTo(d+(e-d)*L,0)):(this.scrollTo(e,0),this.snapping=!1,s.resolve())}.call(this),s.promise}scrollTo(e=0,s=0){this.fullsize?window.scroll(e,s):(this.scroller.scrollLeft=e,this.scroller.scrollTop=s)}now(){return"now"in window.performance?performance.now():new Date().getTime()}destroy(){this.scroller&&(this.fullsize&&this.enableScroll(),this.removeListeners(),this.scroller=void 0)}}h()(b.prototype);var T=b,m=N(21),y=N.n(m);class k extends j.a{constructor(e){super(e),this.name="continuous",this.settings=Object(A.extend)(this.settings||{},{infinite:!0,overflow:void 0,axis:void 0,writingMode:void 0,flow:"scrolled",offset:500,offsetDelta:250,width:void 0,height:void 0,snap:!1,afterScrolledTimeout:10,allowScriptedContent:!1,allowPopups:!1}),Object(A.extend)(this.settings,e.settings||{}),e.settings.gap!="undefined"&&e.settings.gap===0&&(this.settings.gap=e.settings.gap),this.viewSettings={ignoreClass:this.settings.ignoreClass,axis:this.settings.axis,flow:this.settings.flow,layout:this.layout,width:0,height:0,forceEvenPages:!1,allowScriptedContent:this.settings.allowScriptedContent,allowPopups:this.settings.allowPopups},this.scrollTop=0,this.scrollLeft=0}display(e,s){return j.a.prototype.display.call(this,e,s).then(function(){return this.fill()}.bind(this))}fill(e){var s=e||new A.defer;return this.q.enqueue(()=>this.check()).then(d=>{d?this.fill(s):s.resolve()}),s.promise}moveTo(e){var s=0,d=0;this.isPaginated?(s=Math.floor(e.left/this.layout.delta)*this.layout.delta,this.settings.offsetDelta):(d=e.top,e.top,this.settings.offsetDelta),(s>0||d>0)&&this.scrollBy(s,d,!0)}afterResized(e){this.emit(x.c.MANAGERS.RESIZE,e.section)}removeShownListeners(e){e.onDisplayed=function(){}}add(e){var s=this.createView(e);return this.views.append(s),s.on(x.c.VIEWS.RESIZED,d=>{s.expanded=!0}),s.on(x.c.VIEWS.AXIS,d=>{this.updateAxis(d)}),s.on(x.c.VIEWS.WRITING_MODE,d=>{this.updateWritingMode(d)}),s.onDisplayed=this.afterDisplayed.bind(this),s.onResize=this.afterResized.bind(this),s.display(this.request)}append(e){var s=this.createView(e);return s.on(x.c.VIEWS.RESIZED,d=>{s.expanded=!0}),s.on(x.c.VIEWS.AXIS,d=>{this.updateAxis(d)}),s.on(x.c.VIEWS.WRITING_MODE,d=>{this.updateWritingMode(d)}),this.views.append(s),s.onDisplayed=this.afterDisplayed.bind(this),s}prepend(e){var s=this.createView(e);return s.on(x.c.VIEWS.RESIZED,d=>{this.counter(d),s.expanded=!0}),s.on(x.c.VIEWS.AXIS,d=>{this.updateAxis(d)}),s.on(x.c.VIEWS.WRITING_MODE,d=>{this.updateWritingMode(d)}),this.views.prepend(s),s.onDisplayed=this.afterDisplayed.bind(this),s}counter(e){this.settings.axis==="vertical"?this.scrollBy(0,e.heightDelta,!0):this.scrollBy(e.widthDelta,0,!0)}update(e){for(var s,d=this.bounds(),l=this.views.all(),f=l.length,i=[],w=e!==void 0?e:this.settings.offset||0,C=new A.defer,L=[],F=0;F<f;F++)if(s=l[F],this.isVisible(s,w,w,d)===!0){if(s.displayed)s.show();else{let W=s.display(this.request).then(function(q){q.show()},q=>{s.hide()});L.push(W)}i.push(s)}else this.q.enqueue(s.destroy.bind(s)),clearTimeout(this.trimTimeout),this.trimTimeout=setTimeout(function(){this.q.enqueue(this.trim.bind(this))}.bind(this),250);return L.length?Promise.all(L).catch(W=>{C.reject(W)}):(C.resolve(),C.promise)}check(e,s){var d=new A.defer,l=[],f=this.settings.axis==="horizontal",i=this.settings.offset||0;e&&f&&(i=e),s&&!f&&(i=s);var w=this._bounds;let C=f?this.scrollLeft:this.scrollTop,L=f?Math.floor(w.width):w.height,F=f?this.container.scrollWidth:this.container.scrollHeight,W=this.writingMode&&this.writingMode.indexOf("vertical")===0?"vertical":"horizontal",q=this.settings.rtlScrollType,G=this.settings.direction==="rtl";this.settings.fullsize?(f&&G&&q==="negative"||!f&&G&&q==="default")&&(C*=-1):(G&&q==="default"&&W==="horizontal"&&(C=F-L-C),G&&q==="negative"&&W==="horizontal"&&(C*=-1));let Y=()=>{let it=this.views.first(),tt=it&&it.section.prev();tt&&l.push(this.prepend(tt))},Q=C-i;C+L+i>=F&&(()=>{let it=this.views.last(),tt=it&&it.section.next();tt&&l.push(this.append(tt))})(),Q<0&&Y();let et=l.map(it=>it.display(this.request));return l.length?Promise.all(et).then(()=>this.check()).then(()=>this.update(i),it=>it):(this.q.enqueue(function(){this.update()}.bind(this)),d.resolve(!1),d.promise)}trim(){for(var e=new A.defer,s=this.views.displayed(),d=s[0],l=s[s.length-1],f=this.views.indexOf(d),i=this.views.indexOf(l),w=this.views.slice(0,f),C=this.views.slice(i+1),L=0;L<w.length-1;L++)this.erase(w[L],w);for(var F=1;F<C.length;F++)this.erase(C[F]);return e.resolve(),e.promise}erase(e,s){var d,l;this.settings.fullsize?(d=window.scrollY,l=window.scrollX):(d=this.container.scrollTop,l=this.container.scrollLeft);var f=e.bounds();this.views.remove(e),s&&(this.settings.axis==="vertical"?this.scrollTo(0,d-f.height,!0):this.settings.direction==="rtl"?this.settings.fullsize?this.scrollTo(l+Math.floor(f.width),0,!0):this.scrollTo(l,0,!0):this.scrollTo(l-Math.floor(f.width),0,!0))}addEventListeners(e){window.addEventListener("unload",function(s){this.ignore=!0,this.destroy()}.bind(this)),this.addScrollListeners(),this.isPaginated&&this.settings.snap&&(this.snapper=new T(this,this.settings.snap&&typeof this.settings.snap=="object"&&this.settings.snap))}addScrollListeners(){var e;this.tick=A.requestAnimationFrame;let s=this.settings.direction==="rtl"&&this.settings.rtlScrollType==="default"?-1:1;this.scrollDeltaVert=0,this.scrollDeltaHorz=0,this.settings.fullsize?(e=window,this.scrollTop=window.scrollY*s,this.scrollLeft=window.scrollX*s):(e=this.container,this.scrollTop=this.container.scrollTop,this.scrollLeft=this.container.scrollLeft),this._onScroll=this.onScroll.bind(this),e.addEventListener("scroll",this._onScroll),this._scrolled=y()(this.scrolled.bind(this),30),this.didScroll=!1}removeEventListeners(){(this.settings.fullsize?window:this.container).removeEventListener("scroll",this._onScroll),this._onScroll=void 0}onScroll(){let e,s,d=this.settings.direction==="rtl"&&this.settings.rtlScrollType==="default"?-1:1;this.settings.fullsize?(e=window.scrollY*d,s=window.scrollX*d):(e=this.container.scrollTop,s=this.container.scrollLeft),this.scrollTop=e,this.scrollLeft=s,this.ignore?this.ignore=!1:this._scrolled(),this.scrollDeltaVert+=Math.abs(e-this.prevScrollTop),this.scrollDeltaHorz+=Math.abs(s-this.prevScrollLeft),this.prevScrollTop=e,this.prevScrollLeft=s,clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout(function(){this.scrollDeltaVert=0,this.scrollDeltaHorz=0}.bind(this),150),clearTimeout(this.afterScrolled),this.didScroll=!1}scrolled(){this.q.enqueue(function(){return this.check()}.bind(this)),this.emit(x.c.MANAGERS.SCROLL,{top:this.scrollTop,left:this.scrollLeft}),clearTimeout(this.afterScrolled),this.afterScrolled=setTimeout(function(){this.snapper&&this.snapper.supportsTouch&&this.snapper.needsSnap()||this.emit(x.c.MANAGERS.SCROLLED,{top:this.scrollTop,left:this.scrollLeft})}.bind(this),this.settings.afterScrolledTimeout)}next(){let e=this.layout.props.name==="pre-paginated"&&this.layout.props.spread?2*this.layout.props.delta:this.layout.props.delta;this.views.length&&(this.isPaginated&&this.settings.axis==="horizontal"?this.scrollBy(e,0,!0):this.scrollBy(0,this.layout.height,!0),this.q.enqueue(function(){return this.check()}.bind(this)))}prev(){let e=this.layout.props.name==="pre-paginated"&&this.layout.props.spread?2*this.layout.props.delta:this.layout.props.delta;this.views.length&&(this.isPaginated&&this.settings.axis==="horizontal"?this.scrollBy(-e,0,!0):this.scrollBy(0,-this.layout.height,!0),this.q.enqueue(function(){return this.check()}.bind(this)))}updateFlow(e){this.rendered&&this.snapper&&(this.snapper.destroy(),this.snapper=void 0),super.updateFlow(e,"scroll"),this.rendered&&this.isPaginated&&this.settings.snap&&(this.snapper=new T(this,this.settings.snap&&typeof this.settings.snap=="object"&&this.settings.snap))}destroy(){super.destroy(),this.snapper&&this.snapper.destroy()}}P.a=k},function(V,P,N){(function(A){V.exports=function j(x,v,h){function p(T,m){if(!v[T]){if(!x[T]){if(u)return u(T,!0);var y=new Error("Cannot find module '"+T+"'");throw y.code="MODULE_NOT_FOUND",y}var k=v[T]={exports:{}};x[T][0].call(k.exports,function(n){var e=x[T][1][n];return p(e||n)},k,k.exports,j,x,v,h)}return v[T].exports}for(var u=!1,b=0;b<h.length;b++)p(h[b]);return p}({1:[function(j,x,v){(function(h){var p,u,b=h.MutationObserver||h.WebKitMutationObserver;if(b){var T=0,m=new b(e),y=h.document.createTextNode("");m.observe(y,{characterData:!0}),p=function(){y.data=T=++T%2}}else if(h.setImmediate||h.MessageChannel===void 0)p="document"in h&&"onreadystatechange"in h.document.createElement("script")?function(){var s=h.document.createElement("script");s.onreadystatechange=function(){e(),s.onreadystatechange=null,s.parentNode.removeChild(s),s=null},h.document.documentElement.appendChild(s)}:function(){setTimeout(e,0)};else{var k=new h.MessageChannel;k.port1.onmessage=e,p=function(){k.port2.postMessage(0)}}var n=[];function e(){var s,d;u=!0;for(var l=n.length;l;){for(d=n,n=[],s=-1;++s<l;)d[s]();l=n.length}u=!1}x.exports=function(s){n.push(s)!==1||u||p()}}).call(this,A!==void 0?A:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(j,x,v){var h=j(1);function p(){}var u={},b=["REJECTED"],T=["FULFILLED"],m=["PENDING"];function y(l){if(typeof l!="function")throw new TypeError("resolver must be a function");this.state=m,this.queue=[],this.outcome=void 0,l!==p&&s(this,l)}function k(l,f,i){this.promise=l,typeof f=="function"&&(this.onFulfilled=f,this.callFulfilled=this.otherCallFulfilled),typeof i=="function"&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}function n(l,f,i){h(function(){var w;try{w=f(i)}catch(C){return u.reject(l,C)}w===l?u.reject(l,new TypeError("Cannot resolve promise with itself")):u.resolve(l,w)})}function e(l){var f=l&&l.then;if(l&&(typeof l=="object"||typeof l=="function")&&typeof f=="function")return function(){f.apply(l,arguments)}}function s(l,f){var i=!1;function w(F){i||(i=!0,u.reject(l,F))}function C(F){i||(i=!0,u.resolve(l,F))}var L=d(function(){f(C,w)});L.status==="error"&&w(L.value)}function d(l,f){var i={};try{i.value=l(f),i.status="success"}catch(w){i.status="error",i.value=w}return i}x.exports=y,y.prototype.catch=function(l){return this.then(null,l)},y.prototype.then=function(l,f){if(typeof l!="function"&&this.state===T||typeof f!="function"&&this.state===b)return this;var i=new this.constructor(p);return this.state!==m?n(i,this.state===T?l:f,this.outcome):this.queue.push(new k(i,l,f)),i},k.prototype.callFulfilled=function(l){u.resolve(this.promise,l)},k.prototype.otherCallFulfilled=function(l){n(this.promise,this.onFulfilled,l)},k.prototype.callRejected=function(l){u.reject(this.promise,l)},k.prototype.otherCallRejected=function(l){n(this.promise,this.onRejected,l)},u.resolve=function(l,f){var i=d(e,f);if(i.status==="error")return u.reject(l,i.value);var w=i.value;if(w)s(l,w);else{l.state=T,l.outcome=f;for(var C=-1,L=l.queue.length;++C<L;)l.queue[C].callFulfilled(f)}return l},u.reject=function(l,f){l.state=b,l.outcome=f;for(var i=-1,w=l.queue.length;++i<w;)l.queue[i].callRejected(f);return l},y.resolve=function(l){return l instanceof this?l:u.resolve(new this(p),l)},y.reject=function(l){var f=new this(p);return u.reject(f,l)},y.all=function(l){var f=this;if(Object.prototype.toString.call(l)!=="[object Array]")return this.reject(new TypeError("must be an array"));var i=l.length,w=!1;if(!i)return this.resolve([]);for(var C=new Array(i),L=0,F=-1,W=new this(p);++F<i;)q(l[F],F);return W;function q(G,Y){f.resolve(G).then(function(Q){C[Y]=Q,++L!==i||w||(w=!0,u.resolve(W,C))},function(Q){w||(w=!0,u.reject(W,Q))})}},y.race=function(l){var f=this;if(Object.prototype.toString.call(l)!=="[object Array]")return this.reject(new TypeError("must be an array"));var i=l.length,w=!1;if(!i)return this.resolve([]);for(var C,L=-1,F=new this(p);++L<i;)C=l[L],f.resolve(C).then(function(W){w||(w=!0,u.resolve(F,W))},function(W){w||(w=!0,u.reject(F,W))});return F}},{1:1}],3:[function(j,x,v){(function(h){typeof h.Promise!="function"&&(h.Promise=j(2))}).call(this,A!==void 0?A:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(j,x,v){var h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},p=function(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}();function u(E,_){E=E||[],_=_||{};try{return new Blob(E,_)}catch(a){if(a.name!=="TypeError")throw a;for(var O=new(typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder),r=0;r<E.length;r+=1)O.append(E[r]);return O.getBlob(_.type)}}typeof Promise>"u"&&j(3);var b=Promise;function T(E,_){_&&E.then(function(O){_(null,O)},function(O){_(O)})}function m(E,_,O){typeof _=="function"&&E.then(_),typeof O=="function"&&E.catch(O)}function y(E){return typeof E!="string"&&(console.warn(E+" used as a key, but it is not a string."),E=String(E)),E}function k(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var n=void 0,e={},s=Object.prototype.toString;function d(E){return typeof n=="boolean"?b.resolve(n):function(_){return new b(function(O){var r=_.transaction("local-forage-detect-blob-support","readwrite"),a=u([""]);r.objectStore("local-forage-detect-blob-support").put(a,"key"),r.onabort=function(g){g.preventDefault(),g.stopPropagation(),O(!1)},r.oncomplete=function(){var g=navigator.userAgent.match(/Chrome\/(\d+)/),I=navigator.userAgent.match(/Edge\//);O(I||!g||parseInt(g[1],10)>=43)}}).catch(function(){return!1})}(E).then(function(_){return n=_})}function l(E){var _=e[E.name],O={};O.promise=new b(function(r,a){O.resolve=r,O.reject=a}),_.deferredOperations.push(O),_.dbReady?_.dbReady=_.dbReady.then(function(){return O.promise}):_.dbReady=O.promise}function f(E){var _=e[E.name].deferredOperations.pop();if(_)return _.resolve(),_.promise}function i(E,_){var O=e[E.name].deferredOperations.pop();if(O)return O.reject(_),O.promise}function w(E,_){return new b(function(O,r){if(e[E.name]=e[E.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},E.db){if(!_)return O(E.db);l(E),E.db.close()}var a=[E.name];_&&a.push(E.version);var g=p.open.apply(p,a);_&&(g.onupgradeneeded=function(I){var D=g.result;try{D.createObjectStore(E.storeName),I.oldVersion<=1&&D.createObjectStore("local-forage-detect-blob-support")}catch(M){if(M.name!=="ConstraintError")throw M;console.warn('The database "'+E.name+'" has been upgraded from version '+I.oldVersion+" to version "+I.newVersion+', but the storage "'+E.storeName+'" already exists.')}}),g.onerror=function(I){I.preventDefault(),r(g.error)},g.onsuccess=function(){var I=g.result;I.onversionchange=function(D){D.target.close()},O(I),f(E)}})}function C(E){return w(E,!1)}function L(E){return w(E,!0)}function F(E,_){if(!E.db)return!0;var O=!E.db.objectStoreNames.contains(E.storeName),r=E.version<E.db.version,a=E.version>E.db.version;if(r&&(E.version!==_&&console.warn('The database "'+E.name+`" can't be downgraded from version `+E.db.version+" to version "+E.version+"."),E.version=E.db.version),a||O){if(O){var g=E.db.version+1;g>E.version&&(E.version=g)}return!0}return!1}function W(E){return u([function(_){for(var O=_.length,r=new ArrayBuffer(O),a=new Uint8Array(r),g=0;g<O;g++)a[g]=_.charCodeAt(g);return r}(atob(E.data))],{type:E.type})}function q(E){return E&&E.__local_forage_encoded_blob}function G(E){var _=this,O=_._initReady().then(function(){var r=e[_._dbInfo.name];if(r&&r.dbReady)return r.dbReady});return m(O,E,E),O}function Y(E,_,O,r){r===void 0&&(r=1);try{var a=E.db.transaction(E.storeName,_);O(null,a)}catch(g){if(r>0&&(!E.db||g.name==="InvalidStateError"||g.name==="NotFoundError"))return b.resolve().then(function(){if(!E.db||g.name==="NotFoundError"&&!E.db.objectStoreNames.contains(E.storeName)&&E.version<=E.db.version)return E.db&&(E.version=E.db.version+1),L(E)}).then(function(){return function(I){l(I);for(var D=e[I.name],M=D.forages,B=0;B<M.length;B++){var H=M[B];H._dbInfo.db&&(H._dbInfo.db.close(),H._dbInfo.db=null)}return I.db=null,C(I).then(function(K){return I.db=K,F(I)?L(I):K}).then(function(K){I.db=D.db=K;for(var Z=0;Z<M.length;Z++)M[Z]._dbInfo.db=K}).catch(function(K){throw i(I,K),K})}(E).then(function(){Y(E,_,O,r-1)})}).catch(O);O(g)}}var Q={_driver:"asyncStorage",_initStorage:function(E){var _=this,O={db:null};if(E)for(var r in E)O[r]=E[r];var a=e[O.name];a||(a={forages:[],db:null,dbReady:null,deferredOperations:[]},e[O.name]=a),a.forages.push(_),_._initReady||(_._initReady=_.ready,_.ready=G);var g=[];function I(){return b.resolve()}for(var D=0;D<a.forages.length;D++){var M=a.forages[D];M!==_&&g.push(M._initReady().catch(I))}var B=a.forages.slice(0);return b.all(g).then(function(){return O.db=a.db,C(O)}).then(function(H){return O.db=H,F(O,_._defaultConfig.version)?L(O):H}).then(function(H){O.db=a.db=H,_._dbInfo=O;for(var K=0;K<B.length;K++){var Z=B[K];Z!==_&&(Z._dbInfo.db=O.db,Z._dbInfo.version=O.version)}})},_support:function(){try{if(!p||!p.open)return!1;var E=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),_=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!E||_)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}(),iterate:function(E,_){var O=this,r=new b(function(a,g){O.ready().then(function(){Y(O._dbInfo,"readonly",function(I,D){if(I)return g(I);try{var M=D.objectStore(O._dbInfo.storeName).openCursor(),B=1;M.onsuccess=function(){var H=M.result;if(H){var K=H.value;q(K)&&(K=W(K));var Z=E(K,H.key,B++);Z!==void 0?a(Z):H.continue()}else a()},M.onerror=function(){g(M.error)}}catch(H){g(H)}})}).catch(g)});return T(r,_),r},getItem:function(E,_){var O=this;E=y(E);var r=new b(function(a,g){O.ready().then(function(){Y(O._dbInfo,"readonly",function(I,D){if(I)return g(I);try{var M=D.objectStore(O._dbInfo.storeName).get(E);M.onsuccess=function(){var B=M.result;B===void 0&&(B=null),q(B)&&(B=W(B)),a(B)},M.onerror=function(){g(M.error)}}catch(B){g(B)}})}).catch(g)});return T(r,_),r},setItem:function(E,_,O){var r=this;E=y(E);var a=new b(function(g,I){var D;r.ready().then(function(){return D=r._dbInfo,s.call(_)==="[object Blob]"?d(D.db).then(function(M){return M?_:(B=_,new b(function(H,K){var Z=new FileReader;Z.onerror=K,Z.onloadend=function(rt){var st=btoa(rt.target.result||"");H({__local_forage_encoded_blob:!0,data:st,type:B.type})},Z.readAsBinaryString(B)}));var B}):_}).then(function(M){Y(r._dbInfo,"readwrite",function(B,H){if(B)return I(B);try{var K=H.objectStore(r._dbInfo.storeName);M===null&&(M=void 0);var Z=K.put(M,E);H.oncomplete=function(){M===void 0&&(M=null),g(M)},H.onabort=H.onerror=function(){var rt=Z.error?Z.error:Z.transaction.error;I(rt)}}catch(rt){I(rt)}})}).catch(I)});return T(a,O),a},removeItem:function(E,_){var O=this;E=y(E);var r=new b(function(a,g){O.ready().then(function(){Y(O._dbInfo,"readwrite",function(I,D){if(I)return g(I);try{var M=D.objectStore(O._dbInfo.storeName).delete(E);D.oncomplete=function(){a()},D.onerror=function(){g(M.error)},D.onabort=function(){var B=M.error?M.error:M.transaction.error;g(B)}}catch(B){g(B)}})}).catch(g)});return T(r,_),r},clear:function(E){var _=this,O=new b(function(r,a){_.ready().then(function(){Y(_._dbInfo,"readwrite",function(g,I){if(g)return a(g);try{var D=I.objectStore(_._dbInfo.storeName).clear();I.oncomplete=function(){r()},I.onabort=I.onerror=function(){var M=D.error?D.error:D.transaction.error;a(M)}}catch(M){a(M)}})}).catch(a)});return T(O,E),O},length:function(E){var _=this,O=new b(function(r,a){_.ready().then(function(){Y(_._dbInfo,"readonly",function(g,I){if(g)return a(g);try{var D=I.objectStore(_._dbInfo.storeName).count();D.onsuccess=function(){r(D.result)},D.onerror=function(){a(D.error)}}catch(M){a(M)}})}).catch(a)});return T(O,E),O},key:function(E,_){var O=this,r=new b(function(a,g){E<0?a(null):O.ready().then(function(){Y(O._dbInfo,"readonly",function(I,D){if(I)return g(I);try{var M=D.objectStore(O._dbInfo.storeName),B=!1,H=M.openKeyCursor();H.onsuccess=function(){var K=H.result;K?E===0||B?a(K.key):(B=!0,K.advance(E)):a(null)},H.onerror=function(){g(H.error)}}catch(K){g(K)}})}).catch(g)});return T(r,_),r},keys:function(E){var _=this,O=new b(function(r,a){_.ready().then(function(){Y(_._dbInfo,"readonly",function(g,I){if(g)return a(g);try{var D=I.objectStore(_._dbInfo.storeName).openKeyCursor(),M=[];D.onsuccess=function(){var B=D.result;B?(M.push(B.key),B.continue()):r(M)},D.onerror=function(){a(D.error)}}catch(B){a(B)}})}).catch(a)});return T(O,E),O},dropInstance:function(E,_){_=k.apply(this,arguments);var O=this.config();(E=typeof E!="function"&&E||{}).name||(E.name=E.name||O.name,E.storeName=E.storeName||O.storeName);var r,a=this;if(E.name){var g=E.name===O.name&&a._dbInfo.db,I=g?b.resolve(a._dbInfo.db):C(E).then(function(D){var M=e[E.name],B=M.forages;M.db=D;for(var H=0;H<B.length;H++)B[H]._dbInfo.db=D;return D});r=E.storeName?I.then(function(D){if(D.objectStoreNames.contains(E.storeName)){var M=D.version+1;l(E);var B=e[E.name],H=B.forages;D.close();for(var K=0;K<H.length;K++){var Z=H[K];Z._dbInfo.db=null,Z._dbInfo.version=M}return new b(function(rt,st){var lt=p.open(E.name,M);lt.onerror=function(wt){lt.result.close(),st(wt)},lt.onupgradeneeded=function(){lt.result.deleteObjectStore(E.storeName)},lt.onsuccess=function(){var wt=lt.result;wt.close(),rt(wt)}}).then(function(rt){B.db=rt;for(var st=0;st<H.length;st++){var lt=H[st];lt._dbInfo.db=rt,f(lt._dbInfo)}}).catch(function(rt){throw(i(E,rt)||b.resolve()).catch(function(){}),rt})}}):I.then(function(D){l(E);var M=e[E.name],B=M.forages;D.close();for(var H=0;H<B.length;H++)B[H]._dbInfo.db=null;return new b(function(K,Z){var rt=p.deleteDatabase(E.name);rt.onerror=function(){var st=rt.result;st&&st.close(),Z(rt.error)},rt.onblocked=function(){console.warn('dropInstance blocked for database "'+E.name+'" until all open connections are closed')},rt.onsuccess=function(){var st=rt.result;st&&st.close(),K(st)}}).then(function(K){M.db=K;for(var Z=0;Z<B.length;Z++)f(B[Z]._dbInfo)}).catch(function(K){throw(i(E,K)||b.resolve()).catch(function(){}),K})})}else r=b.reject("Invalid arguments");return T(r,_),r}},et="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",it=/^~~local_forage_type~([^~]+)~/,tt=9,ht=tt+4,ft=Object.prototype.toString;function nt(E){var _,O,r,a,g,I=.75*E.length,D=E.length,M=0;E[E.length-1]==="="&&(I--,E[E.length-2]==="="&&I--);var B=new ArrayBuffer(I),H=new Uint8Array(B);for(_=0;_<D;_+=4)O=et.indexOf(E[_]),r=et.indexOf(E[_+1]),a=et.indexOf(E[_+2]),g=et.indexOf(E[_+3]),H[M++]=O<<2|r>>4,H[M++]=(15&r)<<4|a>>2,H[M++]=(3&a)<<6|63&g;return B}function ct(E){var _,O=new Uint8Array(E),r="";for(_=0;_<O.length;_+=3)r+=et[O[_]>>2],r+=et[(3&O[_])<<4|O[_+1]>>4],r+=et[(15&O[_+1])<<2|O[_+2]>>6],r+=et[63&O[_+2]];return O.length%3==2?r=r.substring(0,r.length-1)+"=":O.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}var yt={serialize:function(E,_){var O="";if(E&&(O=ft.call(E)),E&&(O==="[object ArrayBuffer]"||E.buffer&&ft.call(E.buffer)==="[object ArrayBuffer]")){var r,a="__lfsc__:";E instanceof ArrayBuffer?(r=E,a+="arbf"):(r=E.buffer,O==="[object Int8Array]"?a+="si08":O==="[object Uint8Array]"?a+="ui08":O==="[object Uint8ClampedArray]"?a+="uic8":O==="[object Int16Array]"?a+="si16":O==="[object Uint16Array]"?a+="ur16":O==="[object Int32Array]"?a+="si32":O==="[object Uint32Array]"?a+="ui32":O==="[object Float32Array]"?a+="fl32":O==="[object Float64Array]"?a+="fl64":_(new Error("Failed to get type for BinaryArray"))),_(a+ct(r))}else if(O==="[object Blob]"){var g=new FileReader;g.onload=function(){var I="~~local_forage_type~"+E.type+"~"+ct(this.result);_("__lfsc__:blob"+I)},g.readAsArrayBuffer(E)}else try{_(JSON.stringify(E))}catch(I){console.error("Couldn't convert value into a JSON string: ",E),_(null,I)}},deserialize:function(E){if(E.substring(0,tt)!=="__lfsc__:")return JSON.parse(E);var _,O=E.substring(ht),r=E.substring(tt,ht);if(r==="blob"&&it.test(O)){var a=O.match(it);_=a[1],O=O.substring(a[0].length)}var g=nt(O);switch(r){case"arbf":return g;case"blob":return u([g],{type:_});case"si08":return new Int8Array(g);case"ui08":return new Uint8Array(g);case"uic8":return new Uint8ClampedArray(g);case"si16":return new Int16Array(g);case"ur16":return new Uint16Array(g);case"si32":return new Int32Array(g);case"ui32":return new Uint32Array(g);case"fl32":return new Float32Array(g);case"fl64":return new Float64Array(g);default:throw new Error("Unkown type: "+r)}},stringToBuffer:nt,bufferToString:ct};function bt(E,_,O,r){E.executeSql("CREATE TABLE IF NOT EXISTS "+_.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],O,r)}function at(E,_,O,r,a,g){E.executeSql(O,r,a,function(I,D){D.code===D.SYNTAX_ERR?I.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[_.storeName],function(M,B){B.rows.length?g(M,D):bt(M,_,function(){M.executeSql(O,r,a,g)},g)},g):g(I,D)},g)}function dt(E,_,O,r){var a=this;E=y(E);var g=new b(function(I,D){a.ready().then(function(){_===void 0&&(_=null);var M=_,B=a._dbInfo;B.serializer.serialize(_,function(H,K){K?D(K):B.db.transaction(function(Z){at(Z,B,"INSERT OR REPLACE INTO "+B.storeName+" (key, value) VALUES (?, ?)",[E,H],function(){I(M)},function(rt,st){D(st)})},function(Z){if(Z.code===Z.QUOTA_ERR){if(r>0)return void I(dt.apply(a,[E,M,O,r-1]));D(Z)}})})}).catch(D)});return T(g,O),g}function mt(E){return new b(function(_,O){E.transaction(function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(a,g){for(var I=[],D=0;D<g.rows.length;D++)I.push(g.rows.item(D).name);_({db:E,storeNames:I})},function(a,g){O(g)})},function(r){O(r)})})}var Et={_driver:"webSQLStorage",_initStorage:function(E){var _=this,O={db:null};if(E)for(var r in E)O[r]=typeof E[r]!="string"?E[r].toString():E[r];var a=new b(function(g,I){try{O.db=openDatabase(O.name,String(O.version),O.description,O.size)}catch(D){return I(D)}O.db.transaction(function(D){bt(D,O,function(){_._dbInfo=O,g()},function(M,B){I(B)})},I)});return O.serializer=yt,a},_support:typeof openDatabase=="function",iterate:function(E,_){var O=this,r=new b(function(a,g){O.ready().then(function(){var I=O._dbInfo;I.db.transaction(function(D){at(D,I,"SELECT * FROM "+I.storeName,[],function(M,B){for(var H=B.rows,K=H.length,Z=0;Z<K;Z++){var rt=H.item(Z),st=rt.value;if(st&&(st=I.serializer.deserialize(st)),(st=E(st,rt.key,Z+1))!==void 0)return void a(st)}a()},function(M,B){g(B)})})}).catch(g)});return T(r,_),r},getItem:function(E,_){var O=this;E=y(E);var r=new b(function(a,g){O.ready().then(function(){var I=O._dbInfo;I.db.transaction(function(D){at(D,I,"SELECT * FROM "+I.storeName+" WHERE key = ? LIMIT 1",[E],function(M,B){var H=B.rows.length?B.rows.item(0).value:null;H&&(H=I.serializer.deserialize(H)),a(H)},function(M,B){g(B)})})}).catch(g)});return T(r,_),r},setItem:function(E,_,O){return dt.apply(this,[E,_,O,1])},removeItem:function(E,_){var O=this;E=y(E);var r=new b(function(a,g){O.ready().then(function(){var I=O._dbInfo;I.db.transaction(function(D){at(D,I,"DELETE FROM "+I.storeName+" WHERE key = ?",[E],function(){a()},function(M,B){g(B)})})}).catch(g)});return T(r,_),r},clear:function(E){var _=this,O=new b(function(r,a){_.ready().then(function(){var g=_._dbInfo;g.db.transaction(function(I){at(I,g,"DELETE FROM "+g.storeName,[],function(){r()},function(D,M){a(M)})})}).catch(a)});return T(O,E),O},length:function(E){var _=this,O=new b(function(r,a){_.ready().then(function(){var g=_._dbInfo;g.db.transaction(function(I){at(I,g,"SELECT COUNT(key) as c FROM "+g.storeName,[],function(D,M){var B=M.rows.item(0).c;r(B)},function(D,M){a(M)})})}).catch(a)});return T(O,E),O},key:function(E,_){var O=this,r=new b(function(a,g){O.ready().then(function(){var I=O._dbInfo;I.db.transaction(function(D){at(D,I,"SELECT key FROM "+I.storeName+" WHERE id = ? LIMIT 1",[E+1],function(M,B){var H=B.rows.length?B.rows.item(0).key:null;a(H)},function(M,B){g(B)})})}).catch(g)});return T(r,_),r},keys:function(E){var _=this,O=new b(function(r,a){_.ready().then(function(){var g=_._dbInfo;g.db.transaction(function(I){at(I,g,"SELECT key FROM "+g.storeName,[],function(D,M){for(var B=[],H=0;H<M.rows.length;H++)B.push(M.rows.item(H).key);r(B)},function(D,M){a(M)})})}).catch(a)});return T(O,E),O},dropInstance:function(E,_){_=k.apply(this,arguments);var O=this.config();(E=typeof E!="function"&&E||{}).name||(E.name=E.name||O.name,E.storeName=E.storeName||O.storeName);var r,a=this;return T(r=E.name?new b(function(g){var I;I=E.name===O.name?a._dbInfo.db:openDatabase(E.name,"","",0),E.storeName?g({db:I,storeNames:[E.storeName]}):g(mt(I))}).then(function(g){return new b(function(I,D){g.db.transaction(function(M){function B(rt){return new b(function(st,lt){M.executeSql("DROP TABLE IF EXISTS "+rt,[],function(){st()},function(wt,xt){lt(xt)})})}for(var H=[],K=0,Z=g.storeNames.length;K<Z;K++)H.push(B(g.storeNames[K]));b.all(H).then(function(){I()}).catch(function(rt){D(rt)})},function(M){D(M)})})}):b.reject("Invalid arguments"),_),r}};function vt(E,_){var O=E.name+"/";return E.storeName!==_.storeName&&(O+=E.storeName+"/"),O}function o(){return!function(){try{return localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),!1}catch{return!0}}()||localStorage.length>0}var t={_driver:"localStorageWrapper",_initStorage:function(E){var _={};if(E)for(var O in E)_[O]=E[O];return _.keyPrefix=vt(E,this._defaultConfig),o()?(this._dbInfo=_,_.serializer=yt,b.resolve()):b.reject()},_support:function(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}(),iterate:function(E,_){var O=this,r=O.ready().then(function(){for(var a=O._dbInfo,g=a.keyPrefix,I=g.length,D=localStorage.length,M=1,B=0;B<D;B++){var H=localStorage.key(B);if(H.indexOf(g)===0){var K=localStorage.getItem(H);if(K&&(K=a.serializer.deserialize(K)),(K=E(K,H.substring(I),M++))!==void 0)return K}}});return T(r,_),r},getItem:function(E,_){var O=this;E=y(E);var r=O.ready().then(function(){var a=O._dbInfo,g=localStorage.getItem(a.keyPrefix+E);return g&&(g=a.serializer.deserialize(g)),g});return T(r,_),r},setItem:function(E,_,O){var r=this;E=y(E);var a=r.ready().then(function(){_===void 0&&(_=null);var g=_;return new b(function(I,D){var M=r._dbInfo;M.serializer.serialize(_,function(B,H){if(H)D(H);else try{localStorage.setItem(M.keyPrefix+E,B),I(g)}catch(K){K.name!=="QuotaExceededError"&&K.name!=="NS_ERROR_DOM_QUOTA_REACHED"||D(K),D(K)}})})});return T(a,O),a},removeItem:function(E,_){var O=this;E=y(E);var r=O.ready().then(function(){var a=O._dbInfo;localStorage.removeItem(a.keyPrefix+E)});return T(r,_),r},clear:function(E){var _=this,O=_.ready().then(function(){for(var r=_._dbInfo.keyPrefix,a=localStorage.length-1;a>=0;a--){var g=localStorage.key(a);g.indexOf(r)===0&&localStorage.removeItem(g)}});return T(O,E),O},length:function(E){var _=this.keys().then(function(O){return O.length});return T(_,E),_},key:function(E,_){var O=this,r=O.ready().then(function(){var a,g=O._dbInfo;try{a=localStorage.key(E)}catch{a=null}return a&&(a=a.substring(g.keyPrefix.length)),a});return T(r,_),r},keys:function(E){var _=this,O=_.ready().then(function(){for(var r=_._dbInfo,a=localStorage.length,g=[],I=0;I<a;I++){var D=localStorage.key(I);D.indexOf(r.keyPrefix)===0&&g.push(D.substring(r.keyPrefix.length))}return g});return T(O,E),O},dropInstance:function(E,_){if(_=k.apply(this,arguments),!(E=typeof E!="function"&&E||{}).name){var O=this.config();E.name=E.name||O.name,E.storeName=E.storeName||O.storeName}var r,a=this;return T(r=E.name?new b(function(g){E.storeName?g(vt(E,a._defaultConfig)):g(E.name+"/")}).then(function(g){for(var I=localStorage.length-1;I>=0;I--){var D=localStorage.key(I);D.indexOf(g)===0&&localStorage.removeItem(D)}}):b.reject("Invalid arguments"),_),r}},c=function(E,_){for(var O,r,a=E.length,g=0;g<a;){if((O=E[g])===(r=_)||typeof O=="number"&&typeof r=="number"&&isNaN(O)&&isNaN(r))return!0;g++}return!1},S=Array.isArray||function(E){return Object.prototype.toString.call(E)==="[object Array]"},R={},z={},U={INDEXEDDB:Q,WEBSQL:Et,LOCALSTORAGE:t},X=[U.INDEXEDDB._driver,U.WEBSQL._driver,U.LOCALSTORAGE._driver],$=["dropInstance"],J=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat($),ot={description:"",driver:X.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function ut(E,_){E[_]=function(){var O=arguments;return E.ready().then(function(){return E[_].apply(E,O)})}}function pt(){for(var E=1;E<arguments.length;E++){var _=arguments[E];if(_)for(var O in _)_.hasOwnProperty(O)&&(S(_[O])?arguments[0][O]=_[O].slice():arguments[0][O]=_[O])}return arguments[0]}var gt=new(function(){function E(_){for(var O in function(g,I){if(!(g instanceof I))throw new TypeError("Cannot call a class as a function")}(this,E),U)if(U.hasOwnProperty(O)){var r=U[O],a=r._driver;this[O]=a,R[a]||this.defineDriver(r)}this._defaultConfig=pt({},ot),this._config=pt({},this._defaultConfig,_),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return E.prototype.config=function(_){if((_===void 0?"undefined":h(_))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var O in _){if(O==="storeName"&&(_[O]=_[O].replace(/\W/g,"_")),O==="version"&&typeof _[O]!="number")return new Error("Database version must be a number.");this._config[O]=_[O]}return!("driver"in _)||!_.driver||this.setDriver(this._config.driver)}return typeof _=="string"?this._config[_]:this._config},E.prototype.defineDriver=function(_,O,r){var a=new b(function(g,I){try{var D=_._driver,M=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!_._driver)return void I(M);for(var B=J.concat("_initStorage"),H=0,K=B.length;H<K;H++){var Z=B[H];if((!c($,Z)||_[Z])&&typeof _[Z]!="function")return void I(M)}(function(){for(var st=function(St){return function(){var Nt=new Error("Method "+St+" is not implemented by the current driver"),Tt=b.reject(Nt);return T(Tt,arguments[arguments.length-1]),Tt}},lt=0,wt=$.length;lt<wt;lt++){var xt=$[lt];_[xt]||(_[xt]=st(xt))}})();var rt=function(st){R[D]&&console.info("Redefining LocalForage driver: "+D),R[D]=_,z[D]=st,g()};"_support"in _?_._support&&typeof _._support=="function"?_._support().then(rt,I):rt(!!_._support):rt(!0)}catch(st){I(st)}});return m(a,O,r),a},E.prototype.driver=function(){return this._driver||null},E.prototype.getDriver=function(_,O,r){var a=R[_]?b.resolve(R[_]):b.reject(new Error("Driver not found."));return m(a,O,r),a},E.prototype.getSerializer=function(_){var O=b.resolve(yt);return m(O,_),O},E.prototype.ready=function(_){var O=this,r=O._driverSet.then(function(){return O._ready===null&&(O._ready=O._initDriver()),O._ready});return m(r,_,_),r},E.prototype.setDriver=function(_,O,r){var a=this;S(_)||(_=[_]);var g=this._getSupportedDrivers(_);function I(){a._config.driver=a.driver()}function D(B){return a._extend(B),I(),a._ready=a._initStorage(a._config),a._ready}var M=this._driverSet!==null?this._driverSet.catch(function(){return b.resolve()}):b.resolve();return this._driverSet=M.then(function(){var B=g[0];return a._dbInfo=null,a._ready=null,a.getDriver(B).then(function(H){a._driver=H._driver,I(),a._wrapLibraryMethodsWithReady(),a._initDriver=function(K){return function(){var Z=0;return function rt(){for(;Z<K.length;){var st=K[Z];return Z++,a._dbInfo=null,a._ready=null,a.getDriver(st).then(D).catch(rt)}I();var lt=new Error("No available storage method found.");return a._driverSet=b.reject(lt),a._driverSet}()}}(g)})}).catch(function(){I();var B=new Error("No available storage method found.");return a._driverSet=b.reject(B),a._driverSet}),m(this._driverSet,O,r),this._driverSet},E.prototype.supports=function(_){return!!z[_]},E.prototype._extend=function(_){pt(this,_)},E.prototype._getSupportedDrivers=function(_){for(var O=[],r=0,a=_.length;r<a;r++){var g=_[r];this.supports(g)&&O.push(g)}return O},E.prototype._wrapLibraryMethodsWithReady=function(){for(var _=0,O=J.length;_<O;_++)ut(this,J[_])},E.prototype.createInstance=function(_){return new E(_)},E}());x.exports=gt},{3:3}]},{},[4])(4)}).call(this,N(17))},function(V,P,N){var A=N(3),j=N.n(A),x=N(0),v=N(5),h=N(4),p=N(2),u=N(6),b=N(8),T=function(o,t,c,S){var R,z=typeof window<"u"&&window.URL,U=z?"blob":"arraybuffer",X=new x.defer,$=new XMLHttpRequest,J=XMLHttpRequest.prototype;for(R in"overrideMimeType"in J||Object.defineProperty(J,"overrideMimeType",{value:function(){}}),c&&($.withCredentials=!0),$.onreadystatechange=function(){if(this.readyState===XMLHttpRequest.DONE){var ot=!1;if(this.responseType!==""&&this.responseType!=="document"||(ot=this.responseXML),this.status===200||this.status===0||ot){var ut;if(!this.response&&!ot)return X.reject({status:this.status,message:"Empty Response",stack:new Error().stack}),X.promise;if(this.status===403)return X.reject({status:this.status,response:this.response,message:"Forbidden",stack:new Error().stack}),X.promise;ut=ot?this.responseXML:Object(x.isXml)(t)?Object(x.parse)(this.response,"text/xml"):t=="xhtml"?Object(x.parse)(this.response,"application/xhtml+xml"):t=="html"||t=="htm"?Object(x.parse)(this.response,"text/html"):t=="json"?JSON.parse(this.response):t=="blob"?z?this.response:new Blob([this.response]):this.response,X.resolve(ut)}else X.reject({status:this.status,message:this.response,stack:new Error().stack})}},$.onerror=function(ot){X.reject(ot)},$.open("GET",o,!0),S)$.setRequestHeader(R,S[R]);return t=="json"&&$.setRequestHeader("Accept","application/json"),t||(t=new h.a(o).extension),t=="blob"&&($.responseType=U),Object(x.isXml)(t)&&$.overrideMimeType("text/xml"),t=="binary"&&($.responseType="arraybuffer"),$.send(),X.promise},m=N(15),y=class{constructor(o,t){this.idref=o.idref,this.linear=o.linear==="yes",this.properties=o.properties,this.index=o.index,this.href=o.href,this.url=o.url,this.canonical=o.canonical,this.next=o.next,this.prev=o.prev,this.cfiBase=o.cfiBase,t?this.hooks=t:(this.hooks={},this.hooks.serialize=new u.a(this),this.hooks.content=new u.a(this)),this.document=void 0,this.contents=void 0,this.output=void 0}load(o){var t=o||this.request||T,c=new x.defer,S=c.promise;return this.contents?c.resolve(this.contents):t(this.url).then(function(R){return this.document=R,this.contents=R.documentElement,this.hooks.content.trigger(this.document,this)}.bind(this)).then(function(){c.resolve(this.contents)}.bind(this)).catch(function(R){c.reject(R)}),S}base(){return Object(b.a)(this.document,this)}render(o){var t=new x.defer,c=t.promise;return this.output,this.load(o).then(function(S){var R=(typeof navigator<"u"&&navigator.userAgent||"").indexOf("Trident")>=0,z=new(typeof XMLSerializer>"u"||R?m.DOMParser:XMLSerializer);return this.output=z.serializeToString(S),this.output}.bind(this)).then(function(){return this.hooks.serialize.trigger(this.output,this)}.bind(this)).then(function(){t.resolve(this.output)}.bind(this)).catch(function(S){t.reject(S)}),c}find(o){var t=this,c=[],S=o.toLowerCase();return Object(x.sprint)(t.document,function(R){(function(z){for(var U,X,$,J=z.textContent.toLowerCase(),ot=t.document.createRange(),ut=-1;X!=-1;)(X=J.indexOf(S,ut+1))!=-1&&((ot=t.document.createRange()).setStart(z,X),ot.setEnd(z,X+S.length),U=t.cfiFromRange(ot),$=z.textContent.length<150?z.textContent:"..."+($=z.textContent.substring(X-75,X+75))+"...",c.push({cfi:U,excerpt:$})),ut=X})(R)}),c}search(o,t=5){if(document.createTreeWalker===void 0)return this.find(o);let c=[];const S=this,R=o.toLowerCase(),z=function(J){const ot=J.reduce((ut,pt)=>ut+pt.textContent,"").toLowerCase().indexOf(R);if(ot!=-1){const pt=ot+R.length;let gt=0,E=0;if(ot<J[0].length){let _;for(;gt<J.length-1&&(E+=J[gt].length,!(pt<=E));)gt+=1;let O=J[0],r=J[gt],a=S.document.createRange();a.setStart(O,ot);let g=J.slice(0,gt).reduce((D,M)=>D+M.textContent.length,0);a.setEnd(r,g>pt?pt:pt-g),_=S.cfiFromRange(a);let I=J.slice(0,gt+1).reduce((D,M)=>D+M.textContent,"");I.length>150&&(I=I.substring(ot-75,ot+75),I="..."+I+"..."),c.push({cfi:_,excerpt:I})}}},U=document.createTreeWalker(S.document,NodeFilter.SHOW_TEXT,null,!1);let X,$=[];for(;X=U.nextNode();)$.push(X),$.length==t&&(z($.slice(0,t)),$=$.slice(1,t));return $.length>0&&z($),c}reconcileLayoutSettings(o){var t={layout:o.layout,spread:o.spread,orientation:o.orientation};return this.properties.forEach(function(c){var S,R,z=c.replace("rendition:",""),U=z.indexOf("-");U!=-1&&(S=z.slice(0,U),R=z.slice(U+1),t[S]=R)}),t}cfiFromRange(o){return new p.a(o,this.cfiBase).toString()}cfiFromElement(o){return new p.a(o,this.cfiBase).toString()}unload(){this.document=void 0,this.contents=void 0,this.output=void 0}destroy(){this.unload(),this.hooks.serialize.clear(),this.hooks.content.clear(),this.hooks=void 0,this.idref=void 0,this.linear=void 0,this.properties=void 0,this.index=void 0,this.href=void 0,this.url=void 0,this.next=void 0,this.prev=void 0,this.cfiBase=void 0}},k=class{constructor(){this.spineItems=[],this.spineByHref={},this.spineById={},this.hooks={},this.hooks.serialize=new u.a,this.hooks.content=new u.a,this.hooks.content.register(b.a),this.hooks.content.register(b.b),this.hooks.content.register(b.d),this.epubcfi=new p.a,this.loaded=!1,this.items=void 0,this.manifest=void 0,this.spineNodeIndex=void 0,this.baseUrl=void 0,this.length=void 0}unpack(o,t,c){this.items=o.spine,this.manifest=o.manifest,this.spineNodeIndex=o.spineNodeIndex,this.baseUrl=o.baseUrl||o.basePath||"",this.length=this.items.length,this.items.forEach((S,R)=>{var z,U=this.manifest[S.idref];S.index=R,S.cfiBase=this.epubcfi.generateChapterComponent(this.spineNodeIndex,S.index,S.id),S.href&&(S.url=t(S.href,!0),S.canonical=c(S.href)),U&&(S.href=U.href,S.url=t(S.href,!0),S.canonical=c(S.href),U.properties.length&&S.properties.push.apply(S.properties,U.properties)),S.linear==="yes"?(S.prev=function(){let X=S.index;for(;X>0;){let $=this.get(X-1);if($&&$.linear)return $;X-=1}}.bind(this),S.next=function(){let X=S.index;for(;X<this.spineItems.length-1;){let $=this.get(X+1);if($&&$.linear)return $;X+=1}}.bind(this)):(S.prev=function(){},S.next=function(){}),z=new y(S,this.hooks),this.append(z)}),this.loaded=!0}get(o){var t=0;if(o===void 0)for(;t<this.spineItems.length;){let c=this.spineItems[t];if(c&&c.linear)break;t+=1}else this.epubcfi.isCfiString(o)?t=new p.a(o).spinePos:typeof o=="number"||isNaN(o)===!1?t=o:typeof o=="string"&&o.indexOf("#")===0?t=this.spineById[o.substring(1)]:typeof o=="string"&&(o=o.split("#")[0],t=this.spineByHref[o]||this.spineByHref[encodeURI(o)]);return this.spineItems[t]||null}append(o){var t=this.spineItems.length;return o.index=t,this.spineItems.push(o),this.spineByHref[decodeURI(o.href)]=t,this.spineByHref[encodeURI(o.href)]=t,this.spineByHref[o.href]=t,this.spineById[o.idref]=t,t}prepend(o){return this.spineByHref[o.href]=0,this.spineById[o.idref]=0,this.spineItems.forEach(function(t,c){t.index=c}),0}remove(o){var t=this.spineItems.indexOf(o);if(t>-1)return delete this.spineByHref[o.href],delete this.spineById[o.idref],this.spineItems.splice(t,1)}each(){return this.spineItems.forEach.apply(this.spineItems,arguments)}first(){let o=0;do{let t=this.get(o);if(t&&t.linear)return t;o+=1}while(o<this.spineItems.length)}last(){let o=this.spineItems.length-1;do{let t=this.get(o);if(t&&t.linear)return t;o-=1}while(o>=0)}destroy(){this.each(o=>o.destroy()),this.spineItems=void 0,this.spineByHref=void 0,this.spineById=void 0,this.hooks.serialize.clear(),this.hooks.content.clear(),this.hooks=void 0,this.epubcfi=void 0,this.loaded=!1,this.items=void 0,this.manifest=void 0,this.spineNodeIndex=void 0,this.baseUrl=void 0,this.length=void 0}},n=N(9),e=N(1);class s{constructor(t,c,S){this.spine=t,this.request=c,this.pause=S||100,this.q=new n.a(this),this.epubcfi=new p.a,this._locations=[],this._locationsWords=[],this.total=0,this.break=150,this._current=0,this._wordCounter=0,this.currentLocation="",this._currentCfi="",this.processingTimeout=void 0}generate(t){return t&&(this.break=t),this.q.pause(),this.spine.each(function(c){c.linear&&this.q.enqueue(this.process.bind(this),c)}.bind(this)),this.q.run().then(function(){return this.total=this._locations.length-1,this._currentCfi&&(this.currentLocation=this._currentCfi),this._locations}.bind(this))}createRange(){return{startContainer:void 0,startOffset:void 0,endContainer:void 0,endOffset:void 0}}process(t){return t.load(this.request).then(function(c){var S=new x.defer,R=this.parse(c,t.cfiBase);return this._locations=this._locations.concat(R),t.unload(),this.processingTimeout=setTimeout(()=>S.resolve(R),this.pause),S.promise}.bind(this))}parse(t,c,S){var R,z,U=[],X=t.ownerDocument,$=Object(x.qs)(X,"body"),J=0,ot=S||this.break;if(Object(x.sprint)($,function(ut){var pt,gt=ut.length,E=0;if(ut.textContent.trim().length===0)return!1;for(J==0&&((R=this.createRange()).startContainer=ut,R.startOffset=0),(pt=ot-J)>gt&&(J+=gt,E=gt);E<gt;)if(pt=ot-J,J===0&&(E+=1,(R=this.createRange()).startContainer=ut,R.startOffset=E),E+pt>=gt)J+=gt-E,E=gt;else{E+=pt,R.endContainer=ut,R.endOffset=E;let _=new p.a(R,c).toString();U.push(_),J=0}z=ut}.bind(this)),R&&R.startContainer&&z){R.endContainer=z,R.endOffset=z.length;let ut=new p.a(R,c).toString();U.push(ut),J=0}return U}generateFromWords(t,c,S){var R=t?new p.a(t):void 0;return this.q.pause(),this._locationsWords=[],this._wordCounter=0,this.spine.each(function(z){z.linear&&(R?z.index>=R.spinePos&&this.q.enqueue(this.processWords.bind(this),z,c,R,S):this.q.enqueue(this.processWords.bind(this),z,c,R,S))}.bind(this)),this.q.run().then(function(){return this._currentCfi&&(this.currentLocation=this._currentCfi),this._locationsWords}.bind(this))}processWords(t,c,S,R){return R&&this._locationsWords.length>=R?Promise.resolve():t.load(this.request).then(function(z){var U=new x.defer,X=this.parseWords(z,t,c,S),$=R-this._locationsWords.length;return this._locationsWords=this._locationsWords.concat(X.length>=R?X.slice(0,$):X),t.unload(),this.processingTimeout=setTimeout(()=>U.resolve(X),this.pause),U.promise}.bind(this))}countWords(t){return(t=(t=(t=t.replace(/(^\s*)|(\s*$)/gi,"")).replace(/[ ]{2,}/gi," ")).replace(/\n /,`
`)).split(" ").length}parseWords(t,c,S,R){var z,U=c.cfiBase,X=[],$=t.ownerDocument,J=Object(x.qs)($,"body"),ot=S,ut=!R||R.spinePos!==c.index;return R&&c.index===R.spinePos&&(z=R.findNode(R.range?R.path.steps.concat(R.start.steps):R.path.steps,t.ownerDocument)),Object(x.sprint)(J,function(pt){if(!ut){if(pt!==z)return!1;ut=!0}if(pt.textContent.length<10&&pt.textContent.trim().length===0)return!1;var gt,E=this.countWords(pt.textContent),_=0;if(E===0)return!1;for((gt=ot-this._wordCounter)>E&&(this._wordCounter+=E,_=E);_<E;)if(_+(gt=ot-this._wordCounter)>=E)this._wordCounter+=E-_,_=E;else{_+=gt;let O=new p.a(pt,U);X.push({cfi:O.toString(),wordCount:this._wordCounter}),this._wordCounter=0}}.bind(this)),X}locationFromCfi(t){let c;return p.a.prototype.isCfiString(t)&&(t=new p.a(t)),this._locations.length===0?-1:(c=Object(x.locationOf)(t,this._locations,this.epubcfi.compare),c>this.total?this.total:c)}percentageFromCfi(t){if(this._locations.length===0)return null;var c=this.locationFromCfi(t);return this.percentageFromLocation(c)}percentageFromLocation(t){return t&&this.total?t/this.total:0}cfiFromLocation(t){var c=-1;return typeof t!="number"&&(t=parseInt(t)),t>=0&&t<this._locations.length&&(c=this._locations[t]),c}cfiFromPercentage(t){let c;if(t>1&&console.warn("Normalize cfiFromPercentage value to between 0 - 1"),t>=1){let S=new p.a(this._locations[this.total]);return S.collapse(),S.toString()}return c=Math.ceil(this.total*t),this.cfiFromLocation(c)}load(t){return this._locations=typeof t=="string"?JSON.parse(t):t,this.total=this._locations.length-1,this._locations}save(){return JSON.stringify(this._locations)}getCurrent(){return this._current}setCurrent(t){var c;if(typeof t=="string")this._currentCfi=t;else{if(typeof t!="number")return;this._current=t}this._locations.length!==0&&(typeof t=="string"?(c=this.locationFromCfi(t),this._current=c):c=t,this.emit(e.c.LOCATIONS.CHANGED,{percentage:this.percentageFromLocation(c)}))}get currentLocation(){return this._current}set currentLocation(t){this.setCurrent(t)}length(){return this._locations.length}destroy(){this.spine=void 0,this.request=void 0,this.pause=void 0,this.q.stop(),this.q=void 0,this.epubcfi=void 0,this._locations=void 0,this.total=void 0,this.break=void 0,this._current=void 0,this.currentLocation=void 0,this._currentCfi=void 0,clearTimeout(this.processingTimeout)}}j()(s.prototype);var d=s,l=N(7),f=N.n(l),i=class{constructor(o){this.packagePath="",this.directory="",this.encoding="",o&&this.parse(o)}parse(o){var t;if(!o)throw new Error("Container File Not Found");if(!(t=Object(x.qs)(o,"rootfile")))throw new Error("No RootFile Found");this.packagePath=t.getAttribute("full-path"),this.directory=f.a.dirname(this.packagePath),this.encoding=o.xmlEncoding}destroy(){this.packagePath=void 0,this.directory=void 0,this.encoding=void 0}},w=class{constructor(o){this.manifest={},this.navPath="",this.ncxPath="",this.coverPath="",this.spineNodeIndex=0,this.spine=[],this.metadata={},o&&this.parse(o)}parse(o){var t,c,S;if(!o)throw new Error("Package File Not Found");if(!(t=Object(x.qs)(o,"metadata")))throw new Error("No Metadata Found");if(!(c=Object(x.qs)(o,"manifest")))throw new Error("No Manifest Found");if(!(S=Object(x.qs)(o,"spine")))throw new Error("No Spine Found");return this.manifest=this.parseManifest(c),this.navPath=this.findNavPath(c),this.ncxPath=this.findNcxPath(c,S),this.coverPath=this.findCoverPath(o),this.spineNodeIndex=Object(x.indexOfElementNode)(S),this.spine=this.parseSpine(S,this.manifest),this.uniqueIdentifier=this.findUniqueIdentifier(o),this.metadata=this.parseMetadata(t),this.metadata.direction=S.getAttribute("page-progression-direction"),{metadata:this.metadata,spine:this.spine,manifest:this.manifest,navPath:this.navPath,ncxPath:this.ncxPath,coverPath:this.coverPath,spineNodeIndex:this.spineNodeIndex}}parseMetadata(o){var t={};return t.title=this.getElementText(o,"title"),t.creator=this.getElementText(o,"creator"),t.description=this.getElementText(o,"description"),t.pubdate=this.getElementText(o,"date"),t.publisher=this.getElementText(o,"publisher"),t.identifier=this.getElementText(o,"identifier"),t.language=this.getElementText(o,"language"),t.rights=this.getElementText(o,"rights"),t.modified_date=this.getPropertyText(o,"dcterms:modified"),t.layout=this.getPropertyText(o,"rendition:layout"),t.orientation=this.getPropertyText(o,"rendition:orientation"),t.flow=this.getPropertyText(o,"rendition:flow"),t.viewport=this.getPropertyText(o,"rendition:viewport"),t.media_active_class=this.getPropertyText(o,"media:active-class"),t.spread=this.getPropertyText(o,"rendition:spread"),t}parseManifest(o){var t={},c=Object(x.qsa)(o,"item");return Array.prototype.slice.call(c).forEach(function(S){var R=S.getAttribute("id"),z=S.getAttribute("href")||"",U=S.getAttribute("media-type")||"",X=S.getAttribute("media-overlay")||"",$=S.getAttribute("properties")||"";t[R]={href:z,type:U,overlay:X,properties:$.length?$.split(" "):[]}}),t}parseSpine(o,t){var c=[],S=Object(x.qsa)(o,"itemref");return Array.prototype.slice.call(S).forEach(function(R,z){var U=R.getAttribute("idref"),X=R.getAttribute("properties")||"",$=X.length?X.split(" "):[],J={id:R.getAttribute("id"),idref:U,linear:R.getAttribute("linear")||"yes",properties:$,index:z};c.push(J)}),c}findUniqueIdentifier(o){var t=o.documentElement.getAttribute("unique-identifier");if(!t)return"";var c=o.getElementById(t);return c&&c.localName==="identifier"&&c.namespaceURI==="http://purl.org/dc/elements/1.1/"&&c.childNodes.length>0?c.childNodes[0].nodeValue.trim():""}findNavPath(o){var t=Object(x.qsp)(o,"item",{properties:"nav"});return!!t&&t.getAttribute("href")}findNcxPath(o,t){var c,S=Object(x.qsp)(o,"item",{"media-type":"application/x-dtbncx+xml"});return S||(c=t.getAttribute("toc"))&&(S=o.querySelector("#"+c)),!!S&&S.getAttribute("href")}findCoverPath(o){Object(x.qs)(o,"package").getAttribute("version");var t=Object(x.qsp)(o,"item",{properties:"cover-image"});if(t)return t.getAttribute("href");var c=Object(x.qsp)(o,"meta",{name:"cover"});if(c){var S=c.getAttribute("content"),R=o.getElementById(S);return R?R.getAttribute("href"):""}return!1}getElementText(o,t){var c,S=o.getElementsByTagNameNS("http://purl.org/dc/elements/1.1/",t);return S&&S.length!==0&&(c=S[0]).childNodes.length?c.childNodes[0].nodeValue:""}getPropertyText(o,t){var c=Object(x.qsp)(o,"meta",{property:t});return c&&c.childNodes.length?c.childNodes[0].nodeValue:""}load(o){this.metadata=o.metadata;let t=o.readingOrder||o.spine;return this.spine=t.map((c,S)=>(c.index=S,c.linear=c.linear||"yes",c)),o.resources.forEach((c,S)=>{this.manifest[S]=c,c.rel&&c.rel[0]==="cover"&&(this.coverPath=c.href)}),this.spineNodeIndex=0,this.toc=o.toc.map((c,S)=>(c.label=c.title,c)),{metadata:this.metadata,spine:this.spine,manifest:this.manifest,navPath:this.navPath,ncxPath:this.ncxPath,coverPath:this.coverPath,spineNodeIndex:this.spineNodeIndex,toc:this.toc}}destroy(){this.manifest=void 0,this.navPath=void 0,this.ncxPath=void 0,this.coverPath=void 0,this.spineNodeIndex=void 0,this.spine=void 0,this.metadata=void 0}},C=class{constructor(o){this.toc=[],this.tocByHref={},this.tocById={},this.landmarks=[],this.landmarksByType={},this.length=0,o&&this.parse(o)}parse(o){let t,c,S=o.nodeType;S&&(t=Object(x.qs)(o,"html"),c=Object(x.qs)(o,"ncx")),S?t?(this.toc=this.parseNav(o),this.landmarks=this.parseLandmarks(o)):c&&(this.toc=this.parseNcx(o)):this.toc=this.load(o),this.length=0,this.unpack(this.toc)}unpack(o){for(var t,c=0;c<o.length;c++)(t=o[c]).href&&(this.tocByHref[t.href]=c),t.id&&(this.tocById[t.id]=c),this.length++,t.subitems.length&&this.unpack(t.subitems)}get(o){var t;return o?(o.indexOf("#")===0?t=this.tocById[o.substring(1)]:o in this.tocByHref&&(t=this.tocByHref[o]),this.getByIndex(o,t,this.toc)):this.toc}getByIndex(o,t,c){if(c.length===0)return;const S=c[t];if(!S||o!==S.id&&o!==S.href){let R;for(let z=0;z<c.length&&(R=this.getByIndex(o,t,c[z].subitems),!R);++z);return R}return S}landmark(o){var t;return o?(t=this.landmarksByType[o],this.landmarks[t]):this.landmarks}parseNav(o){var t=Object(x.querySelectorByType)(o,"nav","toc"),c=[];if(!t)return c;let S=Object(x.filterChildren)(t,"ol",!0);return S?c=this.parseNavList(S):c}parseNavList(o,t){const c=[];if(!o||!o.children)return c;for(let S=0;S<o.children.length;S++){const R=this.navItem(o.children[S],t);R&&c.push(R)}return c}navItem(o,t){let c=o.getAttribute("id")||void 0,S=Object(x.filterChildren)(o,"a",!0)||Object(x.filterChildren)(o,"span",!0);if(!S)return;let R=S.getAttribute("href")||"";c||(c=R);let z=S.textContent||"",U=[],X=Object(x.filterChildren)(o,"ol",!0);return X&&(U=this.parseNavList(X,c)),{id:c,href:R,label:z,subitems:U,parent:t}}parseLandmarks(o){var t,c,S=Object(x.querySelectorByType)(o,"nav","landmarks"),R=S?Object(x.qsa)(S,"li"):[],z=R.length,U=[];if(!R||z===0)return U;for(t=0;t<z;++t)(c=this.landmarkItem(R[t]))&&(U.push(c),this.landmarksByType[c.type]=t);return U}landmarkItem(o){let t=Object(x.filterChildren)(o,"a",!0);if(!t)return;let c=t.getAttributeNS("http://www.idpf.org/2007/ops","type")||void 0;return{href:t.getAttribute("href")||"",label:t.textContent||"",type:c}}parseNcx(o){var t,c,S=Object(x.qsa)(o,"navPoint"),R=S.length,z={},U=[];if(!S||R===0)return U;for(t=0;t<R;++t)z[(c=this.ncxItem(S[t])).id]=c,c.parent?z[c.parent].subitems.push(c):U.push(c);return U}ncxItem(o){var t,c=o.getAttribute("id")||!1,S=Object(x.qs)(o,"content").getAttribute("src"),R=Object(x.qs)(o,"navLabel"),z=R.textContent?R.textContent:"",U=o.parentNode;return!U||U.nodeName!=="navPoint"&&U.nodeName.split(":").slice(-1)[0]!=="navPoint"||(t=U.getAttribute("id")),{id:c,href:S,label:z,subitems:[],parent:t}}load(o){return o.map(t=>(t.label=t.title,t.subitems=t.children?this.load(t.children):[],t))}forEach(o){return this.toc.forEach(o)}},L={application:{ecmascript:["es","ecma"],javascript:"js",ogg:"ogx",pdf:"pdf",postscript:["ps","ai","eps","epsi","epsf","eps2","eps3"],"rdf+xml":"rdf",smil:["smi","smil"],"xhtml+xml":["xhtml","xht"],xml:["xml","xsl","xsd","opf","ncx"],zip:"zip","x-httpd-eruby":"rhtml","x-latex":"latex","x-maker":["frm","maker","frame","fm","fb","book","fbdoc"],"x-object":"o","x-shockwave-flash":["swf","swfl"],"x-silverlight":"scr","epub+zip":"epub","font-tdpfr":"pfr","inkml+xml":["ink","inkml"],json:"json","jsonml+json":"jsonml","mathml+xml":"mathml","metalink+xml":"metalink",mp4:"mp4s","omdoc+xml":"omdoc",oxps:"oxps","vnd.amazon.ebook":"azw",widget:"wgt","x-dtbook+xml":"dtb","x-dtbresource+xml":"res","x-font-bdf":"bdf","x-font-ghostscript":"gsf","x-font-linux-psf":"psf","x-font-otf":"otf","x-font-pcf":"pcf","x-font-snf":"snf","x-font-ttf":["ttf","ttc"],"x-font-type1":["pfa","pfb","pfm","afm"],"x-font-woff":"woff","x-mobipocket-ebook":["prc","mobi"],"x-mspublisher":"pub","x-nzb":"nzb","x-tgif":"obj","xaml+xml":"xaml","xml-dtd":"dtd","xproc+xml":"xpl","xslt+xml":"xslt","internet-property-stream":"acx","x-compress":"z","x-compressed":"tgz","x-gzip":"gz"},audio:{flac:"flac",midi:["mid","midi","kar","rmi"],mpeg:["mpga","mpega","mp2","mp3","m4a","mp2a","m2a","m3a"],mpegurl:"m3u",ogg:["oga","ogg","spx"],"x-aiff":["aif","aiff","aifc"],"x-ms-wma":"wma","x-wav":"wav",adpcm:"adp",mp4:"mp4a",webm:"weba","x-aac":"aac","x-caf":"caf","x-matroska":"mka","x-pn-realaudio-plugin":"rmp",xm:"xm",mid:["mid","rmi"]},image:{gif:"gif",ief:"ief",jpeg:["jpeg","jpg","jpe"],pcx:"pcx",png:"png","svg+xml":["svg","svgz"],tiff:["tiff","tif"],"x-icon":"ico",bmp:"bmp",webp:"webp","x-pict":["pic","pct"],"x-tga":"tga","cis-cod":"cod"},text:{"cache-manifest":["manifest","appcache"],css:"css",csv:"csv",html:["html","htm","shtml","stm"],mathml:"mml",plain:["txt","text","brf","conf","def","list","log","in","bas"],richtext:"rtx","tab-separated-values":"tsv","x-bibtex":"bib"},video:{mpeg:["mpeg","mpg","mpe","m1v","m2v","mp2","mpa","mpv2"],mp4:["mp4","mp4v","mpg4"],quicktime:["qt","mov"],ogg:"ogv","vnd.mpegurl":["mxu","m4u"],"x-flv":"flv","x-la-asf":["lsf","lsx"],"x-mng":"mng","x-ms-asf":["asf","asx","asr"],"x-ms-wm":"wm","x-ms-wmv":"wmv","x-ms-wmx":"wmx","x-ms-wvx":"wvx","x-msvideo":"avi","x-sgi-movie":"movie","x-matroska":["mpv","mkv","mk3d","mks"],"3gpp2":"3g2",h261:"h261",h263:"h263",h264:"h264",jpeg:"jpgv",jpm:["jpm","jpgm"],mj2:["mj2","mjp2"],"vnd.ms-playready.media.pyv":"pyv","vnd.uvvu.mp4":["uvu","uvvu"],"vnd.vivo":"viv",webm:"webm","x-f4v":"f4v","x-m4v":"m4v","x-ms-vob":"vob","x-smv":"smv"}},F=function(){var o,t,c,S,R={};for(o in L)if(L.hasOwnProperty(o)){for(t in L[o])if(L[o].hasOwnProperty(t))if(typeof(c=L[o][t])=="string")R[c]=o+"/"+t;else for(S=0;S<c.length;S++)R[c[S]]=o+"/"+t}return R}(),W={lookup:function(o){return o&&F[o.split(".").pop().toLowerCase()]||"text/plain"}},q=class{constructor(o,t){this.settings={replacements:t&&t.replacements||"base64",archive:t&&t.archive,resolver:t&&t.resolver,request:t&&t.request},this.process(o)}process(o){this.manifest=o,this.resources=Object.keys(o).map(function(t){return o[t]}),this.replacementUrls=[],this.html=[],this.assets=[],this.css=[],this.urls=[],this.cssUrls=[],this.split(),this.splitUrls()}split(){this.html=this.resources.filter(function(o){if(o.type==="application/xhtml+xml"||o.type==="text/html")return!0}),this.assets=this.resources.filter(function(o){if(o.type!=="application/xhtml+xml"&&o.type!=="text/html")return!0}),this.css=this.resources.filter(function(o){if(o.type==="text/css")return!0})}splitUrls(){this.urls=this.assets.map(function(o){return o.href}.bind(this)),this.cssUrls=this.css.map(function(o){return o.href})}createUrl(o){var t=new v.a(o),c=W.lookup(t.filename);return this.settings.archive?this.settings.archive.createUrl(o,{base64:this.settings.replacements==="base64"}):this.settings.replacements==="base64"?this.settings.request(o,"blob").then(S=>Object(x.blob2base64)(S)).then(S=>Object(x.createBase64Url)(S,c)):this.settings.request(o,"blob").then(S=>Object(x.createBlobUrl)(S,c))}replacements(){if(this.settings.replacements==="none")return new Promise(function(t){t(this.urls)}.bind(this));var o=this.urls.map(t=>{var c=this.settings.resolver(t);return this.createUrl(c).catch(S=>(console.error(S),null))});return Promise.all(o).then(t=>(this.replacementUrls=t.filter(c=>typeof c=="string"),t))}replaceCss(o,t){var c=[];return o=o||this.settings.archive,t=t||this.settings.resolver,this.cssUrls.forEach(function(S){var R=this.createCssFile(S,o,t).then(function(z){var U=this.urls.indexOf(S);U>-1&&(this.replacementUrls[U]=z)}.bind(this));c.push(R)}.bind(this)),Promise.all(c)}createCssFile(o){if(f.a.isAbsolute(o))return new Promise(function(R){R()});var t,c=this.settings.resolver(o);t=this.settings.archive?this.settings.archive.getText(c):this.settings.request(c,"text");var S=this.urls.map(R=>{var z=this.settings.resolver(R);return new h.a(c).relative(z)});return t?t.then(R=>(R=Object(b.e)(R,S,this.replacementUrls),this.settings.replacements==="base64"?Object(x.createBase64Url)(R,"text/css"):Object(x.createBlobUrl)(R,"text/css")),R=>new Promise(function(z){z()})):new Promise(function(R){R()})}relativeTo(o,t){return t=t||this.settings.resolver,this.urls.map(function(c){var S=t(c);return new h.a(o).relative(S)}.bind(this))}get(o){var t=this.urls.indexOf(o);if(t!==-1)return this.replacementUrls.length?new Promise(function(c,S){c(this.replacementUrls[t])}.bind(this)):this.createUrl(o)}substitute(o,t){var c;return c=t?this.relativeTo(t):this.urls,Object(b.e)(o,c,this.replacementUrls)}destroy(){this.settings=void 0,this.manifest=void 0,this.resources=void 0,this.replacementUrls=void 0,this.html=void 0,this.assets=void 0,this.css=void 0,this.urls=void 0,this.cssUrls=void 0}},G=class{constructor(o){this.pages=[],this.locations=[],this.epubcfi=new p.a,this.firstPage=0,this.lastPage=0,this.totalPages=0,this.toc=void 0,this.ncx=void 0,o&&(this.pageList=this.parse(o)),this.pageList&&this.pageList.length&&this.process(this.pageList)}parse(o){var t=Object(x.qs)(o,"html"),c=Object(x.qs)(o,"ncx");return t?this.parseNav(o):c?this.parseNcx(o):void 0}parseNav(o){var t,c,S=Object(x.querySelectorByType)(o,"nav","page-list"),R=S?Object(x.qsa)(S,"li"):[],z=R.length,U=[];if(!R||z===0)return U;for(t=0;t<z;++t)c=this.item(R[t]),U.push(c);return U}parseNcx(o){var t,c,S,R,z=[],U=0;if(!(c=Object(x.qs)(o,"pageList"))||(R=(S=Object(x.qsa)(c,"pageTarget")).length,!S||S.length===0))return z;for(U=0;U<R;++U)t=this.ncxItem(S[U]),z.push(t);return z}ncxItem(o){var t=Object(x.qs)(o,"navLabel"),c=Object(x.qs)(t,"text").textContent;return{href:Object(x.qs)(o,"content").getAttribute("src"),page:parseInt(c,10)}}item(o){var t,c,S=Object(x.qs)(o,"a"),R=S.getAttribute("href")||"",z=S.textContent||"",U=parseInt(z);return R.indexOf("epubcfi")!=-1?(c=(t=R.split("#"))[0],{cfi:t.length>1&&t[1],href:R,packageUrl:c,page:U}):{href:R,page:U}}process(o){o.forEach(function(t){this.pages.push(t.page),t.cfi&&this.locations.push(t.cfi)},this),this.firstPage=parseInt(this.pages[0]),this.lastPage=parseInt(this.pages[this.pages.length-1]),this.totalPages=this.lastPage-this.firstPage}pageFromCfi(o){var t=-1;if(this.locations.length===0)return-1;var c=Object(x.indexOfSorted)(o,this.locations,this.epubcfi.compare);return c!=-1?t=this.pages[c]:(t=(c=Object(x.locationOf)(o,this.locations,this.epubcfi.compare))-1>=0?this.pages[c-1]:this.pages[0])!==void 0||(t=-1),t}cfiFromPage(o){var t=-1;typeof o!="number"&&(o=parseInt(o));var c=this.pages.indexOf(o);return c!=-1&&(t=this.locations[c]),t}pageFromPercentage(o){return Math.round(this.totalPages*o)}percentageFromPage(o){var t=(o-this.firstPage)/this.totalPages;return Math.round(1e3*t)/1e3}percentageFromCfi(o){var t=this.pageFromCfi(o);return this.percentageFromPage(t)}destroy(){this.pages=void 0,this.locations=void 0,this.epubcfi=void 0,this.pageList=void 0,this.toc=void 0,this.ncx=void 0}},Y=N(16),Q=N(29),et=N.n(Q),it=class{constructor(){this.zip=void 0,this.urlCache={},this.checkRequirements()}checkRequirements(){try{this.zip=new et.a}catch{throw new Error("JSZip lib not loaded")}}open(o,t){return this.zip.loadAsync(o,{base64:t})}openUrl(o,t){return T(o,"binary").then(function(c){return this.zip.loadAsync(c,{base64:t})}.bind(this))}request(o,t){var c,S=new x.defer,R=new h.a(o);return t||(t=R.extension),(c=t=="blob"?this.getBlob(o):this.getText(o))?c.then(function(z){let U=this.handleResponse(z,t);S.resolve(U)}.bind(this)):S.reject({message:"File not found in the epub: "+o,stack:new Error().stack}),S.promise}handleResponse(o,t){return t=="json"?JSON.parse(o):Object(x.isXml)(t)?Object(x.parse)(o,"text/xml"):t=="xhtml"?Object(x.parse)(o,"application/xhtml+xml"):t=="html"||t=="htm"?Object(x.parse)(o,"text/html"):o}getBlob(o,t){var c=window.decodeURIComponent(o.substr(1)),S=this.zip.file(c);if(S)return t=t||W.lookup(S.name),S.async("uint8array").then(function(R){return new Blob([R],{type:t})})}getText(o,t){var c=window.decodeURIComponent(o.substr(1)),S=this.zip.file(c);if(S)return S.async("string").then(function(R){return R})}getBase64(o,t){var c=window.decodeURIComponent(o.substr(1)),S=this.zip.file(c);if(S)return t=t||W.lookup(S.name),S.async("base64").then(function(R){return"data:"+t+";base64,"+R})}createUrl(o,t){var c,S,R=new x.defer,z=window.URL||window.webkitURL||window.mozURL,U=t&&t.base64;return o in this.urlCache?(R.resolve(this.urlCache[o]),R.promise):(U?(S=this.getBase64(o))&&S.then(function(X){this.urlCache[o]=X,R.resolve(X)}.bind(this)):(S=this.getBlob(o))&&S.then(function(X){c=z.createObjectURL(X),this.urlCache[o]=c,R.resolve(c)}.bind(this)),S||R.reject({message:"File not found in the epub: "+o,stack:new Error().stack}),R.promise)}revokeUrl(o){var t=window.URL||window.webkitURL||window.mozURL,c=this.urlCache[o];c&&t.revokeObjectURL(c)}destroy(){var o=window.URL||window.webkitURL||window.mozURL;for(let t in this.urlCache)o.revokeObjectURL(t);this.zip=void 0,this.urlCache={}}},tt=N(23),ht=N.n(tt);class ft{constructor(t,c,S){this.urlCache={},this.storage=void 0,this.name=t,this.requester=c||T,this.resolver=S,this.online=!0,this.checkRequirements(),this.addListeners()}checkRequirements(){try{let t;ht.a===void 0&&(t=ht.a),this.storage=t.createInstance({name:this.name})}catch{throw new Error("localForage lib not loaded")}}addListeners(){this._status=this.status.bind(this),window.addEventListener("online",this._status),window.addEventListener("offline",this._status)}removeListeners(){window.removeEventListener("online",this._status),window.removeEventListener("offline",this._status),this._status=void 0}status(t){let c=navigator.onLine;this.online=c,c?this.emit("online",this):this.emit("offline",this)}add(t,c){let S=t.resources.map(R=>{let{href:z}=R,U=this.resolver(z),X=window.encodeURIComponent(U);return this.storage.getItem(X).then($=>!$||c?this.requester(U,"binary").then(J=>this.storage.setItem(X,J)):$)});return Promise.all(S)}put(t,c,S){let R=window.encodeURIComponent(t);return this.storage.getItem(R).then(z=>z||this.requester(t,"binary",c,S).then(U=>this.storage.setItem(R,U)))}request(t,c,S,R){return this.online?this.requester(t,c,S,R).then(z=>(this.put(t),z)):this.retrieve(t,c)}retrieve(t,c){new x.defer;var S=new h.a(t);return c||(c=S.extension),(c=="blob"?this.getBlob(t):this.getText(t)).then(R=>{var z,U=new x.defer;return R?(z=this.handleResponse(R,c),U.resolve(z)):U.reject({message:"File not found in storage: "+t,stack:new Error().stack}),U.promise})}handleResponse(t,c){return c=="json"?JSON.parse(t):Object(x.isXml)(c)?Object(x.parse)(t,"text/xml"):c=="xhtml"?Object(x.parse)(t,"application/xhtml+xml"):c=="html"||c=="htm"?Object(x.parse)(t,"text/html"):t}getBlob(t,c){let S=window.encodeURIComponent(t);return this.storage.getItem(S).then(function(R){if(R)return c=c||W.lookup(t),new Blob([R],{type:c})})}getText(t,c){let S=window.encodeURIComponent(t);return c=c||W.lookup(t),this.storage.getItem(S).then(function(R){var z,U=new x.defer,X=new FileReader;if(R)return z=new Blob([R],{type:c}),X.addEventListener("loadend",()=>{U.resolve(X.result)}),X.readAsText(z,c),U.promise})}getBase64(t,c){let S=window.encodeURIComponent(t);return c=c||W.lookup(t),this.storage.getItem(S).then(R=>{var z,U=new x.defer,X=new FileReader;if(R)return z=new Blob([R],{type:c}),X.addEventListener("loadend",()=>{U.resolve(X.result)}),X.readAsDataURL(z,c),U.promise})}createUrl(t,c){var S,R,z=new x.defer,U=window.URL||window.webkitURL||window.mozURL,X=c&&c.base64;return t in this.urlCache?(z.resolve(this.urlCache[t]),z.promise):(X?(R=this.getBase64(t))&&R.then(function($){this.urlCache[t]=$,z.resolve($)}.bind(this)):(R=this.getBlob(t))&&R.then(function($){S=U.createObjectURL($),this.urlCache[t]=S,z.resolve(S)}.bind(this)),R||z.reject({message:"File not found in storage: "+t,stack:new Error().stack}),z.promise)}revokeUrl(t){var c=window.URL||window.webkitURL||window.mozURL,S=this.urlCache[t];S&&c.revokeObjectURL(S)}destroy(){var t=window.URL||window.webkitURL||window.mozURL;for(let c in this.urlCache)t.revokeObjectURL(c);this.urlCache={},this.removeListeners()}}j()(ft.prototype);var nt=ft,ct=class{constructor(o){this.interactive="",this.fixedLayout="",this.openToSpread="",this.orientationLock="",o&&this.parse(o)}parse(o){if(!o)return this;const t=Object(x.qs)(o,"display_options");return t?(Object(x.qsa)(t,"option").forEach(c=>{let S="";switch(c.childNodes.length&&(S=c.childNodes[0].nodeValue),c.attributes.name.value){case"interactive":this.interactive=S;break;case"fixed-layout":this.fixedLayout=S;break;case"open-to-spread":this.openToSpread=S;break;case"orientation-lock":this.orientationLock=S}}),this):this}destroy(){this.interactive=void 0,this.fixedLayout=void 0,this.openToSpread=void 0,this.orientationLock=void 0}};const yt="binary",bt="base64",at="epub",dt="opf",mt="json",Et="directory";class vt{constructor(t,c){c===void 0&&typeof t!="string"&&!(t instanceof Blob)&&!(t instanceof ArrayBuffer)&&(c=t,t=void 0),this.settings=Object(x.extend)(this.settings||{},{requestMethod:void 0,requestCredentials:void 0,requestHeaders:void 0,encoding:void 0,replacements:void 0,canonical:void 0,openAs:void 0,store:void 0}),Object(x.extend)(this.settings,c),this.opening=new x.defer,this.opened=this.opening.promise,this.isOpen=!1,this.loading={manifest:new x.defer,spine:new x.defer,metadata:new x.defer,cover:new x.defer,navigation:new x.defer,pageList:new x.defer,resources:new x.defer,displayOptions:new x.defer},this.loaded={manifest:this.loading.manifest.promise,spine:this.loading.spine.promise,metadata:this.loading.metadata.promise,cover:this.loading.cover.promise,navigation:this.loading.navigation.promise,pageList:this.loading.pageList.promise,resources:this.loading.resources.promise,displayOptions:this.loading.displayOptions.promise},this.ready=Promise.all([this.loaded.manifest,this.loaded.spine,this.loaded.metadata,this.loaded.cover,this.loaded.navigation,this.loaded.resources,this.loaded.displayOptions]),this.isRendered=!1,this.request=this.settings.requestMethod||T,this.spine=new k,this.locations=new d(this.spine,this.load.bind(this)),this.navigation=void 0,this.pageList=void 0,this.url=void 0,this.path=void 0,this.archived=!1,this.archive=void 0,this.storage=void 0,this.resources=void 0,this.rendition=void 0,this.container=void 0,this.packaging=void 0,this.displayOptions=void 0,this.settings.store&&this.store(this.settings.store),t&&this.open(t,this.settings.openAs).catch(S=>{var R=new Error("Cannot load book at "+t);this.emit(e.c.BOOK.OPEN_FAILED,R)})}open(t,c){var S,R=c||this.determineType(t);return R===yt?(this.archived=!0,this.url=new v.a("/",""),S=this.openEpub(t)):R===bt?(this.archived=!0,this.url=new v.a("/",""),S=this.openEpub(t,R)):R===at?(this.archived=!0,this.url=new v.a("/",""),S=this.request(t,"binary",this.settings.requestCredentials,this.settings.requestHeaders).then(this.openEpub.bind(this))):R==dt?(this.url=new v.a(t),S=this.openPackaging(this.url.Path.toString())):R==mt?(this.url=new v.a(t),S=this.openManifest(this.url.Path.toString())):(this.url=new v.a(t),S=this.openContainer("META-INF/container.xml").then(this.openPackaging.bind(this))),S}openEpub(t,c){return this.unarchive(t,c||this.settings.encoding).then(()=>this.openContainer("META-INF/container.xml")).then(S=>this.openPackaging(S))}openContainer(t){return this.load(t).then(c=>(this.container=new i(c),this.resolve(this.container.packagePath)))}openPackaging(t){return this.path=new h.a(t),this.load(t).then(c=>(this.packaging=new w(c),this.unpack(this.packaging)))}openManifest(t){return this.path=new h.a(t),this.load(t).then(c=>(this.packaging=new w,this.packaging.load(c),this.unpack(this.packaging)))}load(t){var c=this.resolve(t);return this.archived?this.archive.request(c):this.request(c,null,this.settings.requestCredentials,this.settings.requestHeaders)}resolve(t,c){if(t){var S=t;return t.indexOf("://")>-1?t:(this.path&&(S=this.path.resolve(t)),c!=0&&this.url&&(S=this.url.resolve(S)),S)}}canonical(t){return t?this.settings.canonical?this.settings.canonical(t):this.resolve(t,!0):""}determineType(t){var c;return this.settings.encoding==="base64"?bt:typeof t!="string"?yt:((c=new v.a(t).path().extension)&&(c=c.replace(/\?.*$/,"")),c?c==="epub"?at:c==="opf"?dt:c==="json"?mt:void 0:Et)}unpack(t){this.package=t,this.packaging.metadata.layout===""?this.load(this.url.resolve("META-INF/com.apple.ibooks.display-options.xml")).then(c=>{this.displayOptions=new ct(c),this.loading.displayOptions.resolve(this.displayOptions)}).catch(c=>{this.displayOptions=new ct,this.loading.displayOptions.resolve(this.displayOptions)}):(this.displayOptions=new ct,this.loading.displayOptions.resolve(this.displayOptions)),this.spine.unpack(this.packaging,this.resolve.bind(this),this.canonical.bind(this)),this.resources=new q(this.packaging.manifest,{archive:this.archive,resolver:this.resolve.bind(this),request:this.request.bind(this),replacements:this.settings.replacements||(this.archived?"blobUrl":"base64")}),this.loadNavigation(this.packaging).then(()=>{this.loading.navigation.resolve(this.navigation)}),this.packaging.coverPath&&(this.cover=this.resolve(this.packaging.coverPath)),this.loading.manifest.resolve(this.packaging.manifest),this.loading.metadata.resolve(this.packaging.metadata),this.loading.spine.resolve(this.spine),this.loading.cover.resolve(this.cover),this.loading.resources.resolve(this.resources),this.loading.pageList.resolve(this.pageList),this.isOpen=!0,this.archived||this.settings.replacements&&this.settings.replacements!="none"?this.replacements().then(()=>{this.loaded.displayOptions.then(()=>{this.opening.resolve(this)})}).catch(c=>{console.error(c)}):this.loaded.displayOptions.then(()=>{this.opening.resolve(this)})}loadNavigation(t){let c=t.navPath||t.ncxPath,S=t.toc;return S?new Promise((R,z)=>{this.navigation=new C(S),t.pageList&&(this.pageList=new G(t.pageList)),R(this.navigation)}):c?this.load(c,"xml").then(R=>(this.navigation=new C(R),this.pageList=new G(R),this.navigation)):new Promise((R,z)=>{this.navigation=new C,this.pageList=new G,R(this.navigation)})}section(t){return this.spine.get(t)}renderTo(t,c){return this.rendition=new Y.a(this,c),this.rendition.attachTo(t),this.rendition}setRequestCredentials(t){this.settings.requestCredentials=t}setRequestHeaders(t){this.settings.requestHeaders=t}unarchive(t,c){return this.archive=new it,this.archive.open(t,c)}store(t){let c=this.settings.replacements&&this.settings.replacements!=="none",S=this.url,R=this.settings.requestMethod||T.bind(this);return this.storage=new nt(t,R,this.resolve.bind(this)),this.request=this.storage.request.bind(this.storage),this.opened.then(()=>{this.archived&&(this.storage.requester=this.archive.request.bind(this.archive));let z=(U,X)=>{X.output=this.resources.substitute(U,X.url)};this.resources.settings.replacements=c||"blobUrl",this.resources.replacements().then(()=>this.resources.replaceCss()),this.storage.on("offline",()=>{this.url=new v.a("/",""),this.spine.hooks.serialize.register(z)}),this.storage.on("online",()=>{this.url=S,this.spine.hooks.serialize.deregister(z)})}),this.storage}coverUrl(){return this.loaded.cover.then(()=>this.cover?this.archived?this.archive.createUrl(this.cover):this.cover:null)}replacements(){return this.spine.hooks.serialize.register((t,c)=>{c.output=this.resources.substitute(t,c.url)}),this.resources.replacements().then(()=>this.resources.replaceCss())}getRange(t){var c=new p.a(t),S=this.spine.get(c.spinePos),R=this.load.bind(this);return S?S.load(R).then(function(z){return c.toRange(S.document)}):new Promise((z,U)=>{U("CFI could not be found")})}key(t){var c=t||this.packaging.metadata.identifier||this.url.filename;return`epubjs:${e.b}:${c}`}destroy(){this.opened=void 0,this.loading=void 0,this.loaded=void 0,this.ready=void 0,this.isOpen=!1,this.isRendered=!1,this.spine&&this.spine.destroy(),this.locations&&this.locations.destroy(),this.pageList&&this.pageList.destroy(),this.archive&&this.archive.destroy(),this.resources&&this.resources.destroy(),this.container&&this.container.destroy(),this.packaging&&this.packaging.destroy(),this.rendition&&this.rendition.destroy(),this.displayOptions&&this.displayOptions.destroy(),this.spine=void 0,this.locations=void 0,this.pageList=void 0,this.archive=void 0,this.resources=void 0,this.container=void 0,this.packaging=void 0,this.rendition=void 0,this.navigation=void 0,this.url=void 0,this.path=void 0,this.archived=!1}}j()(vt.prototype),P.a=vt},function(V,P,N){var A=N(14).NAMESPACE;function j(r){return r!==""}function x(r,a){return r.hasOwnProperty(a)||(r[a]=!0),r}function v(r){if(!r)return[];var a=function(g){return g?g.split(/[\t\n\f\r ]+/).filter(j):[]}(r);return Object.keys(a.reduce(x,{}))}function h(r,a){for(var g in r)a[g]=r[g]}function p(r,a){var g=r.prototype;if(!(g instanceof a)){let I=function(){};I.prototype=a.prototype,h(g,I=new I),r.prototype=g=I}g.constructor!=r&&(typeof r!="function"&&console.error("unknown Class:"+r),g.constructor=r)}var u={},b=u.ELEMENT_NODE=1,T=u.ATTRIBUTE_NODE=2,m=u.TEXT_NODE=3,y=u.CDATA_SECTION_NODE=4,k=u.ENTITY_REFERENCE_NODE=5,n=u.ENTITY_NODE=6,e=u.PROCESSING_INSTRUCTION_NODE=7,s=u.COMMENT_NODE=8,d=u.DOCUMENT_NODE=9,l=u.DOCUMENT_TYPE_NODE=10,f=u.DOCUMENT_FRAGMENT_NODE=11,i=u.NOTATION_NODE=12,w={},C={},L=(w.INDEX_SIZE_ERR=(C[1]="Index size error",1),w.DOMSTRING_SIZE_ERR=(C[2]="DOMString size error",2),w.HIERARCHY_REQUEST_ERR=(C[3]="Hierarchy request error",3)),F=(w.WRONG_DOCUMENT_ERR=(C[4]="Wrong document",4),w.INVALID_CHARACTER_ERR=(C[5]="Invalid character",5),w.NO_DATA_ALLOWED_ERR=(C[6]="No data allowed",6),w.NO_MODIFICATION_ALLOWED_ERR=(C[7]="No modification allowed",7),w.NOT_FOUND_ERR=(C[8]="Not found",8)),W=(w.NOT_SUPPORTED_ERR=(C[9]="Not supported",9),w.INUSE_ATTRIBUTE_ERR=(C[10]="Attribute in use",10));w.INVALID_STATE_ERR=(C[11]="Invalid state",11),w.SYNTAX_ERR=(C[12]="Syntax error",12),w.INVALID_MODIFICATION_ERR=(C[13]="Invalid modification",13),w.NAMESPACE_ERR=(C[14]="Invalid namespace",14),w.INVALID_ACCESS_ERR=(C[15]="Invalid access",15);function q(r,a){if(a instanceof Error)var g=a;else g=this,Error.call(this,C[r]),this.message=C[r],Error.captureStackTrace&&Error.captureStackTrace(this,q);return g.code=r,a&&(this.message=this.message+": "+a),g}function G(){}function Y(r,a){this._node=r,this._refresh=a,Q(this)}function Q(r){var a=r._node._inc||r._node.ownerDocument._inc;if(r._inc!=a){var g=r._refresh(r._node);O(r,"length",g.length),h(g,r),r._inc=a}}function et(){}function it(r,a){for(var g=r.length;g--;)if(r[g]===a)return g}function tt(r,a,g,I){if(I?a[it(a,I)]=g:a[a.length++]=g,r){g.ownerElement=r;var D=r.ownerDocument;D&&(I&&at(D,r,I),function(M,B,H){M&&M._inc++,H.namespaceURI===A.XMLNS&&(B._nsMap[H.prefix?H.localName:""]=H.value)}(D,r,g))}}function ht(r,a,g){var I=it(a,g);if(!(I>=0))throw q(F,new Error(r.tagName+"@"+g));for(var D=a.length-1;I<D;)a[I]=a[++I];if(a.length=D,r){var M=r.ownerDocument;M&&(at(M,r,g),g.ownerElement=null)}}function ft(){}function nt(){}function ct(r){return(r=="<"?"&lt;":r==">"&&"&gt;")||r=="&"&&"&amp;"||r=='"'&&"&quot;"||"&#"+r.charCodeAt()+";"}function yt(r,a){if(a(r))return!0;if(r=r.firstChild)do if(yt(r,a))return!0;while(r=r.nextSibling)}function bt(){}function at(r,a,g,I){r&&r._inc++,g.namespaceURI===A.XMLNS&&delete a._nsMap[g.prefix?g.localName:""]}function dt(r,a,g){if(r&&r._inc){r._inc++;var I=a.childNodes;if(g)I[I.length++]=g;else{for(var D=a.firstChild,M=0;D;)I[M++]=D,D=D.nextSibling;I.length=M}}}function mt(r,a){var g=a.previousSibling,I=a.nextSibling;return g?g.nextSibling=I:r.firstChild=I,I?I.previousSibling=g:r.lastChild=g,dt(r.ownerDocument,r),a}function Et(r,a,g){var I=a.parentNode;if(I&&I.removeChild(a),a.nodeType===f){var D=a.firstChild;if(D==null)return a;var M=a.lastChild}else D=M=a;var B=g?g.previousSibling:r.lastChild;D.previousSibling=B,M.nextSibling=g,B?B.nextSibling=D:r.firstChild=D,g==null?r.lastChild=M:g.previousSibling=M;do D.parentNode=r;while(D!==M&&(D=D.nextSibling));return dt(r.ownerDocument||r,r),a.nodeType==f&&(a.firstChild=a.lastChild=null),a}function vt(){this._nsMap={}}function o(){}function t(){}function c(){}function S(){}function R(){}function z(){}function U(){}function X(){}function $(){}function J(){}function ot(){}function ut(){}function pt(r,a){var g=[],I=this.nodeType==9&&this.documentElement||this,D=I.prefix,M=I.namespaceURI;if(M&&D==null&&(D=I.lookupPrefix(M))==null)var B=[{namespace:M,prefix:null}];return _(this,g,r,a,B),g.join("")}function gt(r,a,g){var I=r.prefix||"",D=r.namespaceURI;if(!D||I==="xml"&&D===A.XML||D===A.XMLNS)return!1;for(var M=g.length;M--;){var B=g[M];if(B.prefix===I)return B.namespace!==D}return!0}function E(r,a,g){r.push(" ",a,'="',g.replace(/[<&"]/g,ct),'"')}function _(r,a,g,I,D){if(D||(D=[]),I){if(!(r=I(r)))return;if(typeof r=="string")return void a.push(r)}switch(r.nodeType){case b:var M=r.attributes,B=M.length,H=r.firstChild,K=r.tagName,Z=K;if(!(g=A.isHTML(r.namespaceURI)||g)&&!r.prefix&&r.namespaceURI){for(var rt,st=0;st<M.length;st++)if(M.item(st).name==="xmlns"){rt=M.item(st).value;break}if(!rt){for(var lt=D.length-1;lt>=0;lt--)if((wt=D[lt]).prefix===""&&wt.namespace===r.namespaceURI){rt=wt.namespace;break}}if(rt!==r.namespaceURI)for(lt=D.length-1;lt>=0;lt--){var wt;if((wt=D[lt]).namespace===r.namespaceURI){wt.prefix&&(Z=wt.prefix+":"+K);break}}}a.push("<",Z);for(var xt=0;xt<B;xt++)(St=M.item(xt)).prefix=="xmlns"?D.push({prefix:St.localName,namespace:St.value}):St.nodeName=="xmlns"&&D.push({prefix:"",namespace:St.value});for(xt=0;xt<B;xt++){var St,Nt,Tt;gt(St=M.item(xt),0,D)&&(E(a,(Nt=St.prefix||"")?"xmlns:"+Nt:"xmlns",Tt=St.namespaceURI),D.push({prefix:Nt,namespace:Tt})),_(St,a,g,I,D)}if(K===Z&&gt(r,0,D)&&(E(a,(Nt=r.prefix||"")?"xmlns:"+Nt:"xmlns",Tt=r.namespaceURI),D.push({prefix:Nt,namespace:Tt})),H||g&&!/^(?:meta|link|img|br|hr|input)$/i.test(K)){if(a.push(">"),g&&/^script$/i.test(K))for(;H;)H.data?a.push(H.data):_(H,a,g,I,D.slice()),H=H.nextSibling;else for(;H;)_(H,a,g,I,D.slice()),H=H.nextSibling;a.push("</",Z,">")}else a.push("/>");return;case d:case f:for(H=r.firstChild;H;)_(H,a,g,I,D.slice()),H=H.nextSibling;return;case T:return E(a,r.name,r.value);case m:return a.push(r.data.replace(/[<&]/g,ct).replace(/]]>/g,"]]&gt;"));case y:return a.push("<![CDATA[",r.data,"]]>");case s:return a.push("<!--",r.data,"-->");case l:var Rt=r.publicId,Ot=r.systemId;if(a.push("<!DOCTYPE ",r.name),Rt)a.push(" PUBLIC ",Rt),Ot&&Ot!="."&&a.push(" ",Ot),a.push(">");else if(Ot&&Ot!=".")a.push(" SYSTEM ",Ot,">");else{var At=r.internalSubset;At&&a.push(" [",At,"]"),a.push(">")}return;case e:return a.push("<?",r.target," ",r.data,"?>");case k:return a.push("&",r.nodeName,";");default:a.push("??",r.nodeName)}}function O(r,a,g){r[a]=g}q.prototype=Error.prototype,h(w,q),G.prototype={length:0,item:function(r){return this[r]||null},toString:function(r,a){for(var g=[],I=0;I<this.length;I++)_(this[I],g,r,a);return g.join("")}},Y.prototype.item=function(r){return Q(this),this[r]},p(Y,G),et.prototype={length:0,item:G.prototype.item,getNamedItem:function(r){for(var a=this.length;a--;){var g=this[a];if(g.nodeName==r)return g}},setNamedItem:function(r){var a=r.ownerElement;if(a&&a!=this._ownerElement)throw new q(W);var g=this.getNamedItem(r.nodeName);return tt(this._ownerElement,this,r,g),g},setNamedItemNS:function(r){var a,g=r.ownerElement;if(g&&g!=this._ownerElement)throw new q(W);return a=this.getNamedItemNS(r.namespaceURI,r.localName),tt(this._ownerElement,this,r,a),a},removeNamedItem:function(r){var a=this.getNamedItem(r);return ht(this._ownerElement,this,a),a},removeNamedItemNS:function(r,a){var g=this.getNamedItemNS(r,a);return ht(this._ownerElement,this,g),g},getNamedItemNS:function(r,a){for(var g=this.length;g--;){var I=this[g];if(I.localName==a&&I.namespaceURI==r)return I}return null}},ft.prototype={hasFeature:function(r,a){return!0},createDocument:function(r,a,g){var I=new bt;if(I.implementation=this,I.childNodes=new G,I.doctype=g||null,g&&I.appendChild(g),a){var D=I.createElementNS(r,a);I.appendChild(D)}return I},createDocumentType:function(r,a,g){var I=new z;return I.name=r,I.nodeName=r,I.publicId=a||"",I.systemId=g||"",I}},nt.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(r,a){return Et(this,r,a)},replaceChild:function(r,a){this.insertBefore(r,a),a&&this.removeChild(a)},removeChild:function(r){return mt(this,r)},appendChild:function(r){return this.insertBefore(r,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(r){return function a(g,I,D){var M=new I.constructor;for(var B in I){var H=I[B];typeof H!="object"&&H!=M[B]&&(M[B]=H)}switch(I.childNodes&&(M.childNodes=new G),M.ownerDocument=g,M.nodeType){case b:var K=I.attributes,Z=M.attributes=new et,rt=K.length;Z._ownerElement=M;for(var st=0;st<rt;st++)M.setAttributeNode(a(g,K.item(st),!0));break;case T:D=!0}if(D)for(var lt=I.firstChild;lt;)M.appendChild(a(g,lt,D)),lt=lt.nextSibling;return M}(this.ownerDocument||this,this,r)},normalize:function(){for(var r=this.firstChild;r;){var a=r.nextSibling;a&&a.nodeType==m&&r.nodeType==m?(this.removeChild(a),r.appendData(a.data)):(r.normalize(),r=a)}},isSupported:function(r,a){return this.ownerDocument.implementation.hasFeature(r,a)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(r){for(var a=this;a;){var g=a._nsMap;if(g){for(var I in g)if(g[I]==r)return I}a=a.nodeType==T?a.ownerDocument:a.parentNode}return null},lookupNamespaceURI:function(r){for(var a=this;a;){var g=a._nsMap;if(g&&r in g)return g[r];a=a.nodeType==T?a.ownerDocument:a.parentNode}return null},isDefaultNamespace:function(r){return this.lookupPrefix(r)==null}},h(u,nt),h(u,nt.prototype),bt.prototype={nodeName:"#document",nodeType:d,doctype:null,documentElement:null,_inc:1,insertBefore:function(r,a){if(r.nodeType==f){for(var g=r.firstChild;g;){var I=g.nextSibling;this.insertBefore(g,a),g=I}return r}return this.documentElement==null&&r.nodeType==b&&(this.documentElement=r),Et(this,r,a),r.ownerDocument=this,r},removeChild:function(r){return this.documentElement==r&&(this.documentElement=null),mt(this,r)},importNode:function(r,a){return function g(I,D,M){var B;switch(D.nodeType){case b:(B=D.cloneNode(!1)).ownerDocument=I;case f:break;case T:M=!0}if(B||(B=D.cloneNode(!1)),B.ownerDocument=I,B.parentNode=null,M)for(var H=D.firstChild;H;)B.appendChild(g(I,H,M)),H=H.nextSibling;return B}(this,r,a)},getElementById:function(r){var a=null;return yt(this.documentElement,function(g){if(g.nodeType==b&&g.getAttribute("id")==r)return a=g,!0}),a},getElementsByClassName:function(r){var a=v(r);return new Y(this,function(g){var I=[];return a.length>0&&yt(g.documentElement,function(D){if(D!==g&&D.nodeType===b){var M=D.getAttribute("class");if(M){var B=r===M;if(!B){var H=v(M);B=a.every((K=H,function(Z){return K&&K.indexOf(Z)!==-1}))}B&&I.push(D)}}var K}),I})},createElement:function(r){var a=new vt;return a.ownerDocument=this,a.nodeName=r,a.tagName=r,a.localName=r,a.childNodes=new G,(a.attributes=new et)._ownerElement=a,a},createDocumentFragment:function(){var r=new J;return r.ownerDocument=this,r.childNodes=new G,r},createTextNode:function(r){var a=new c;return a.ownerDocument=this,a.appendData(r),a},createComment:function(r){var a=new S;return a.ownerDocument=this,a.appendData(r),a},createCDATASection:function(r){var a=new R;return a.ownerDocument=this,a.appendData(r),a},createProcessingInstruction:function(r,a){var g=new ot;return g.ownerDocument=this,g.tagName=g.target=r,g.nodeValue=g.data=a,g},createAttribute:function(r){var a=new o;return a.ownerDocument=this,a.name=r,a.nodeName=r,a.localName=r,a.specified=!0,a},createEntityReference:function(r){var a=new $;return a.ownerDocument=this,a.nodeName=r,a},createElementNS:function(r,a){var g=new vt,I=a.split(":"),D=g.attributes=new et;return g.childNodes=new G,g.ownerDocument=this,g.nodeName=a,g.tagName=a,g.namespaceURI=r,I.length==2?(g.prefix=I[0],g.localName=I[1]):g.localName=a,D._ownerElement=g,g},createAttributeNS:function(r,a){var g=new o,I=a.split(":");return g.ownerDocument=this,g.nodeName=a,g.name=a,g.namespaceURI=r,g.specified=!0,I.length==2?(g.prefix=I[0],g.localName=I[1]):g.localName=a,g}},p(bt,nt),vt.prototype={nodeType:b,hasAttribute:function(r){return this.getAttributeNode(r)!=null},getAttribute:function(r){var a=this.getAttributeNode(r);return a&&a.value||""},getAttributeNode:function(r){return this.attributes.getNamedItem(r)},setAttribute:function(r,a){var g=this.ownerDocument.createAttribute(r);g.value=g.nodeValue=""+a,this.setAttributeNode(g)},removeAttribute:function(r){var a=this.getAttributeNode(r);a&&this.removeAttributeNode(a)},appendChild:function(r){return r.nodeType===f?this.insertBefore(r,null):function(a,g){var I=g.parentNode;if(I){var D=a.lastChild;I.removeChild(g),D=a.lastChild}return D=a.lastChild,g.parentNode=a,g.previousSibling=D,g.nextSibling=null,D?D.nextSibling=g:a.firstChild=g,a.lastChild=g,dt(a.ownerDocument,a,g),g}(this,r)},setAttributeNode:function(r){return this.attributes.setNamedItem(r)},setAttributeNodeNS:function(r){return this.attributes.setNamedItemNS(r)},removeAttributeNode:function(r){return this.attributes.removeNamedItem(r.nodeName)},removeAttributeNS:function(r,a){var g=this.getAttributeNodeNS(r,a);g&&this.removeAttributeNode(g)},hasAttributeNS:function(r,a){return this.getAttributeNodeNS(r,a)!=null},getAttributeNS:function(r,a){var g=this.getAttributeNodeNS(r,a);return g&&g.value||""},setAttributeNS:function(r,a,g){var I=this.ownerDocument.createAttributeNS(r,a);I.value=I.nodeValue=""+g,this.setAttributeNode(I)},getAttributeNodeNS:function(r,a){return this.attributes.getNamedItemNS(r,a)},getElementsByTagName:function(r){return new Y(this,function(a){var g=[];return yt(a,function(I){I===a||I.nodeType!=b||r!=="*"&&I.tagName!=r||g.push(I)}),g})},getElementsByTagNameNS:function(r,a){return new Y(this,function(g){var I=[];return yt(g,function(D){D===g||D.nodeType!==b||r!=="*"&&D.namespaceURI!==r||a!=="*"&&D.localName!=a||I.push(D)}),I})}},bt.prototype.getElementsByTagName=vt.prototype.getElementsByTagName,bt.prototype.getElementsByTagNameNS=vt.prototype.getElementsByTagNameNS,p(vt,nt),o.prototype.nodeType=T,p(o,nt),t.prototype={data:"",substringData:function(r,a){return this.data.substring(r,r+a)},appendData:function(r){r=this.data+r,this.nodeValue=this.data=r,this.length=r.length},insertData:function(r,a){this.replaceData(r,0,a)},appendChild:function(r){throw new Error(C[L])},deleteData:function(r,a){this.replaceData(r,a,"")},replaceData:function(r,a,g){g=this.data.substring(0,r)+g+this.data.substring(r+a),this.nodeValue=this.data=g,this.length=g.length}},p(t,nt),c.prototype={nodeName:"#text",nodeType:m,splitText:function(r){var a=this.data,g=a.substring(r);a=a.substring(0,r),this.data=this.nodeValue=a,this.length=a.length;var I=this.ownerDocument.createTextNode(g);return this.parentNode&&this.parentNode.insertBefore(I,this.nextSibling),I}},p(c,t),S.prototype={nodeName:"#comment",nodeType:s},p(S,t),R.prototype={nodeName:"#cdata-section",nodeType:y},p(R,t),z.prototype.nodeType=l,p(z,nt),U.prototype.nodeType=i,p(U,nt),X.prototype.nodeType=n,p(X,nt),$.prototype.nodeType=k,p($,nt),J.prototype.nodeName="#document-fragment",J.prototype.nodeType=f,p(J,nt),ot.prototype.nodeType=e,p(ot,nt),ut.prototype.serializeToString=function(r,a,g){return pt.call(r,a,g)},nt.prototype.toString=pt;try{Object.defineProperty&&(Object.defineProperty(Y.prototype,"length",{get:function(){return Q(this),this.$$length}}),Object.defineProperty(nt.prototype,"textContent",{get:function(){return function r(a){switch(a.nodeType){case b:case f:var g=[];for(a=a.firstChild;a;)a.nodeType!==7&&a.nodeType!==8&&g.push(r(a)),a=a.nextSibling;return g.join("");default:return a.nodeValue}}(this)},set:function(r){switch(this.nodeType){case b:case f:for(;this.firstChild;)this.removeChild(this.firstChild);(r||String(r))&&this.appendChild(this.ownerDocument.createTextNode(r));break;default:this.data=r,this.value=r,this.nodeValue=r}}}),O=function(r,a,g){r["$$"+a]=g})}catch{}P.DocumentType=z,P.DOMException=q,P.DOMImplementation=ft,P.Element=vt,P.Node=nt,P.NodeList=G,P.XMLSerializer=ut},function(V,P,N){var A=N(52),j=typeof self=="object"&&self&&self.Object===Object&&self,x=A||j||Function("return this")();V.exports=x},function(V,P,N){var A=N(26).Symbol;V.exports=A},function(V,P,N){var A=N(21),j=N(19);V.exports=function(x,v,h){var p=!0,u=!0;if(typeof x!="function")throw new TypeError("Expected a function");return j(h)&&(p="leading"in h?!!h.leading:p,u="trailing"in h?!!h.trailing:u),A(x,v,{leading:p,maxWait:v,trailing:u})}},function(V,P){V.exports=Ct},function(V,P,N){N.r(P),function(A){var j=N(24),x=N(16),v=N(2),h=N(12),p=N(0),u=N(1);N(20),N(10),N(22);function b(T,m){return new j.a(T,m)}b.VERSION=u.b,A!==void 0&&(A.EPUBJS_VERSION=u.b),b.Book=j.a,b.Rendition=x.a,b.Contents=h.a,b.CFI=v.a,b.utils=p,P.default=b}.call(this,N(17))},function(V,P,N){var A=N(32),j=N(40),x=N(41),v=N(42);(V.exports=function(h,p){var u,b,T,m,y;return arguments.length<2||typeof h!="string"?(m=p,p=h,h=null):m=arguments[2],h==null?(u=T=!0,b=!1):(u=v.call(h,"c"),b=v.call(h,"e"),T=v.call(h,"w")),y={value:p,configurable:u,enumerable:b,writable:T},m?A(j(m),y):y}).gs=function(h,p,u){var b,T,m,y;return typeof h!="string"?(m=u,u=p,p=h,h=null):m=arguments[3],p==null?p=void 0:x(p)?u==null?u=void 0:x(u)||(m=u,u=void 0):(m=p,p=u=void 0),h==null?(b=!0,T=!1):(b=v.call(h,"c"),T=v.call(h,"e")),y={get:p,set:u,configurable:b,enumerable:T},m?A(j(m),y):y}},function(V,P,N){V.exports=N(33)()?Object.assign:N(34)},function(V,P,N){V.exports=function(){var A,j=Object.assign;return typeof j=="function"&&(j(A={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),A.foo+A.bar+A.trzy==="razdwatrzy")}},function(V,P,N){var A=N(35),j=N(39),x=Math.max;V.exports=function(v,h){var p,u,b,T=x(arguments.length,2);for(v=Object(j(v)),b=function(m){try{v[m]=h[m]}catch(y){p||(p=y)}},u=1;u<T;++u)A(h=arguments[u]).forEach(b);if(p!==void 0)throw p;return v}},function(V,P,N){V.exports=N(36)()?Object.keys:N(37)},function(V,P,N){V.exports=function(){try{return Object.keys("primitive"),!0}catch{return!1}}},function(V,P,N){var A=N(18),j=Object.keys;V.exports=function(x){return j(A(x)?Object(x):x)}},function(V,P,N){V.exports=function(){}},function(V,P,N){var A=N(18);V.exports=function(j){if(!A(j))throw new TypeError("Cannot use null or undefined");return j}},function(V,P,N){var A=N(18),j=Array.prototype.forEach,x=Object.create,v=function(h,p){var u;for(u in h)p[u]=h[u]};V.exports=function(h){var p=x(null);return j.call(arguments,function(u){A(u)&&v(Object(u),p)}),p}},function(V,P,N){V.exports=function(A){return typeof A=="function"}},function(V,P,N){V.exports=N(43)()?String.prototype.contains:N(44)},function(V,P,N){var A="razdwatrzy";V.exports=function(){return typeof A.contains=="function"&&A.contains("dwa")===!0&&A.contains("foo")===!1}},function(V,P,N){var A=String.prototype.indexOf;V.exports=function(j){return A.call(this,j,arguments[1])>-1}},function(V,P,N){V.exports=function(A){if(typeof A!="function")throw new TypeError(A+" is not a function");return A}},function(V,P,N){var A=N(14),j=N(25),x=N(47),v=N(48),h=j.DOMImplementation,p=A.NAMESPACE,u=v.ParseError,b=v.XMLReader;function T(s){this.options=s||{locator:{}}}function m(){this.cdata=!1}function y(s,d){d.lineNumber=s.lineNumber,d.columnNumber=s.columnNumber}function k(s){if(s)return`
@`+(s.systemId||"")+"#[line:"+s.lineNumber+",col:"+s.columnNumber+"]"}function n(s,d,l){return typeof s=="string"?s.substr(d,l):s.length>=d+l||d?new java.lang.String(s,d,l)+"":s}function e(s,d){s.currentElement?s.currentElement.appendChild(d):s.doc.appendChild(d)}T.prototype.parseFromString=function(s,d){var l=this.options,f=new b,i=l.domBuilder||new m,w=l.errorHandler,C=l.locator,L=l.xmlns||{},F=/\/x?html?$/.test(d),W=F?x.HTML_ENTITIES:x.XML_ENTITIES;return C&&i.setDocumentLocator(C),f.errorHandler=function(q,G,Y){if(!q){if(G instanceof m)return G;q=G}var Q={},et=q instanceof Function;function it(tt){var ht=q[tt];!ht&&et&&(ht=q.length==2?function(ft){q(tt,ft)}:q),Q[tt]=ht&&function(ft){ht("[xmldom "+tt+"]	"+ft+k(Y))}||function(){}}return Y=Y||{},it("warning"),it("error"),it("fatalError"),Q}(w,i,C),f.domBuilder=l.domBuilder||i,F&&(L[""]=p.HTML),L.xml=L.xml||p.XML,s&&typeof s=="string"?f.parse(s,L,W):f.errorHandler.error("invalid doc source"),i.doc},m.prototype={startDocument:function(){this.doc=new h().createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(s,d,l,f){var i=this.doc,w=i.createElementNS(s,l||d),C=f.length;e(this,w),this.currentElement=w,this.locator&&y(this.locator,w);for(var L=0;L<C;L++){s=f.getURI(L);var F=f.getValue(L),W=(l=f.getQName(L),i.createAttributeNS(s,l));this.locator&&y(f.getLocator(L),W),W.value=W.nodeValue=F,w.setAttributeNode(W)}},endElement:function(s,d,l){var f=this.currentElement;f.tagName,this.currentElement=f.parentNode},startPrefixMapping:function(s,d){},endPrefixMapping:function(s){},processingInstruction:function(s,d){var l=this.doc.createProcessingInstruction(s,d);this.locator&&y(this.locator,l),e(this,l)},ignorableWhitespace:function(s,d,l){},characters:function(s,d,l){if(s=n.apply(this,arguments)){if(this.cdata)var f=this.doc.createCDATASection(s);else f=this.doc.createTextNode(s);this.currentElement?this.currentElement.appendChild(f):/^\s*$/.test(s)&&this.doc.appendChild(f),this.locator&&y(this.locator,f)}},skippedEntity:function(s){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(s){(this.locator=s)&&(s.lineNumber=0)},comment:function(s,d,l){s=n.apply(this,arguments);var f=this.doc.createComment(s);this.locator&&y(this.locator,f),e(this,f)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(s,d,l){var f=this.doc.implementation;if(f&&f.createDocumentType){var i=f.createDocumentType(s,d,l);this.locator&&y(this.locator,i),e(this,i),this.doc.doctype=i}},warning:function(s){console.warn("[xmldom warning]	"+s,k(this.locator))},error:function(s){console.error("[xmldom error]	"+s,k(this.locator))},fatalError:function(s){throw new u(s,this.locator)}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(s){m.prototype[s]=function(){return null}}),P.__DOMHandler=m,P.DOMParser=T,P.DOMImplementation=j.DOMImplementation,P.XMLSerializer=j.XMLSerializer},function(V,P,N){var A=N(14).freeze;P.XML_ENTITIES=A({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),P.HTML_ENTITIES=A({lt:"<",gt:">",amp:"&",quot:'"',apos:"'",Agrave:"À",Aacute:"Á",Acirc:"Â",Atilde:"Ã",Auml:"Ä",Aring:"Å",AElig:"Æ",Ccedil:"Ç",Egrave:"È",Eacute:"É",Ecirc:"Ê",Euml:"Ë",Igrave:"Ì",Iacute:"Í",Icirc:"Î",Iuml:"Ï",ETH:"Ð",Ntilde:"Ñ",Ograve:"Ò",Oacute:"Ó",Ocirc:"Ô",Otilde:"Õ",Ouml:"Ö",Oslash:"Ø",Ugrave:"Ù",Uacute:"Ú",Ucirc:"Û",Uuml:"Ü",Yacute:"Ý",THORN:"Þ",szlig:"ß",agrave:"à",aacute:"á",acirc:"â",atilde:"ã",auml:"ä",aring:"å",aelig:"æ",ccedil:"ç",egrave:"è",eacute:"é",ecirc:"ê",euml:"ë",igrave:"ì",iacute:"í",icirc:"î",iuml:"ï",eth:"ð",ntilde:"ñ",ograve:"ò",oacute:"ó",ocirc:"ô",otilde:"õ",ouml:"ö",oslash:"ø",ugrave:"ù",uacute:"ú",ucirc:"û",uuml:"ü",yacute:"ý",thorn:"þ",yuml:"ÿ",nbsp:" ",iexcl:"¡",cent:"¢",pound:"£",curren:"¤",yen:"¥",brvbar:"¦",sect:"§",uml:"¨",copy:"©",ordf:"ª",laquo:"«",not:"¬",shy:"­­",reg:"®",macr:"¯",deg:"°",plusmn:"±",sup2:"²",sup3:"³",acute:"´",micro:"µ",para:"¶",middot:"·",cedil:"¸",sup1:"¹",ordm:"º",raquo:"»",frac14:"¼",frac12:"½",frac34:"¾",iquest:"¿",times:"×",divide:"÷",forall:"∀",part:"∂",exist:"∃",empty:"∅",nabla:"∇",isin:"∈",notin:"∉",ni:"∋",prod:"∏",sum:"∑",minus:"−",lowast:"∗",radic:"√",prop:"∝",infin:"∞",ang:"∠",and:"∧",or:"∨",cap:"∩",cup:"∪",int:"∫",there4:"∴",sim:"∼",cong:"≅",asymp:"≈",ne:"≠",equiv:"≡",le:"≤",ge:"≥",sub:"⊂",sup:"⊃",nsub:"⊄",sube:"⊆",supe:"⊇",oplus:"⊕",otimes:"⊗",perp:"⊥",sdot:"⋅",Alpha:"Α",Beta:"Β",Gamma:"Γ",Delta:"Δ",Epsilon:"Ε",Zeta:"Ζ",Eta:"Η",Theta:"Θ",Iota:"Ι",Kappa:"Κ",Lambda:"Λ",Mu:"Μ",Nu:"Ν",Xi:"Ξ",Omicron:"Ο",Pi:"Π",Rho:"Ρ",Sigma:"Σ",Tau:"Τ",Upsilon:"Υ",Phi:"Φ",Chi:"Χ",Psi:"Ψ",Omega:"Ω",alpha:"α",beta:"β",gamma:"γ",delta:"δ",epsilon:"ε",zeta:"ζ",eta:"η",theta:"θ",iota:"ι",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",xi:"ξ",omicron:"ο",pi:"π",rho:"ρ",sigmaf:"ς",sigma:"σ",tau:"τ",upsilon:"υ",phi:"φ",chi:"χ",psi:"ψ",omega:"ω",thetasym:"ϑ",upsih:"ϒ",piv:"ϖ",OElig:"Œ",oelig:"œ",Scaron:"Š",scaron:"š",Yuml:"Ÿ",fnof:"ƒ",circ:"ˆ",tilde:"˜",ensp:" ",emsp:" ",thinsp:" ",zwnj:"‌",zwj:"‍",lrm:"‎",rlm:"‏",ndash:"–",mdash:"—",lsquo:"‘",rsquo:"’",sbquo:"‚",ldquo:"“",rdquo:"”",bdquo:"„",dagger:"†",Dagger:"‡",bull:"•",hellip:"…",permil:"‰",prime:"′",Prime:"″",lsaquo:"‹",rsaquo:"›",oline:"‾",euro:"€",trade:"™",larr:"←",uarr:"↑",rarr:"→",darr:"↓",harr:"↔",crarr:"↵",lceil:"⌈",rceil:"⌉",lfloor:"⌊",rfloor:"⌋",loz:"◊",spades:"♠",clubs:"♣",hearts:"♥",diams:"♦"}),P.entityMap=P.HTML_ENTITIES},function(V,P,N){var A=N(14).NAMESPACE,j=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,x=new RegExp("[\\-\\.0-9"+j.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),v=new RegExp("^"+j.source+x.source+"*(?::"+j.source+x.source+"*)?$");function h(d,l){this.message=d,this.locator=l,Error.captureStackTrace&&Error.captureStackTrace(this,h)}function p(){}function u(d,l){return l.lineNumber=d.lineNumber,l.columnNumber=d.columnNumber,l}function b(d,l,f,i,w,C){function L(Q,et,it){f.attributeNames.hasOwnProperty(Q)&&C.fatalError("Attribute "+Q+" redefined"),f.addValue(Q,et,it)}for(var F,W=++l,q=0;;){var G=d.charAt(W);switch(G){case"=":if(q===1)F=d.slice(l,W),q=3;else{if(q!==2)throw new Error("attribute equal must after attrName");q=3}break;case"'":case'"':if(q===3||q===1){if(q===1&&(C.warning('attribute value must after "="'),F=d.slice(l,W)),l=W+1,!((W=d.indexOf(G,l))>0))throw new Error("attribute value no end '"+G+"' match");L(F,Y=d.slice(l,W).replace(/&#?\w+;/g,w),l-1),q=5}else{if(q!=4)throw new Error('attribute value must after "="');L(F,Y=d.slice(l,W).replace(/&#?\w+;/g,w),l),C.warning('attribute "'+F+'" missed start quot('+G+")!!"),l=W+1,q=5}break;case"/":switch(q){case 0:f.setTagName(d.slice(l,W));case 5:case 6:case 7:q=7,f.closed=!0;case 4:case 1:case 2:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return C.error("unexpected end of input"),q==0&&f.setTagName(d.slice(l,W)),W;case">":switch(q){case 0:f.setTagName(d.slice(l,W));case 5:case 6:case 7:break;case 4:case 1:(Y=d.slice(l,W)).slice(-1)==="/"&&(f.closed=!0,Y=Y.slice(0,-1));case 2:q===2&&(Y=F),q==4?(C.warning('attribute "'+Y+'" missed quot(")!'),L(F,Y.replace(/&#?\w+;/g,w),l)):(A.isHTML(i[""])&&Y.match(/^(?:disabled|checked|selected)$/i)||C.warning('attribute "'+Y+'" missed value!! "'+Y+'" instead!!'),L(Y,Y,l));break;case 3:throw new Error("attribute value missed!!")}return W;case"":G=" ";default:if(G<=" ")switch(q){case 0:f.setTagName(d.slice(l,W)),q=6;break;case 1:F=d.slice(l,W),q=2;break;case 4:var Y=d.slice(l,W).replace(/&#?\w+;/g,w);C.warning('attribute "'+Y+'" missed quot(")!!'),L(F,Y,l);case 5:q=6}else switch(q){case 2:f.tagName,A.isHTML(i[""])&&F.match(/^(?:disabled|checked|selected)$/i)||C.warning('attribute "'+F+'" missed value!! "'+F+'" instead2!!'),L(F,F,l),l=W,q=1;break;case 5:C.warning('attribute space is required"'+F+'"!!');case 6:q=1,l=W;break;case 3:q=4,l=W;break;case 7:throw new Error("elements closed character '/' and '>' must be connected to")}}W++}}function T(d,l,f){for(var i=d.tagName,w=null,C=d.length;C--;){var L=d[C],F=L.qName,W=L.value;if((Q=F.indexOf(":"))>0)var q=L.prefix=F.slice(0,Q),G=F.slice(Q+1),Y=q==="xmlns"&&G;else G=F,q=null,Y=F==="xmlns"&&"";L.localName=G,Y!==!1&&(w==null&&(w={},k(f,f={})),f[Y]=w[Y]=W,L.uri=A.XMLNS,l.startPrefixMapping(Y,W))}for(C=d.length;C--;)(q=(L=d[C]).prefix)&&(q==="xml"&&(L.uri=A.XML),q!=="xmlns"&&(L.uri=f[q||""]));var Q;(Q=i.indexOf(":"))>0?(q=d.prefix=i.slice(0,Q),G=d.localName=i.slice(Q+1)):(q=null,G=d.localName=i);var et=d.uri=f[q||""];if(l.startElement(et,G,i,d),!d.closed)return d.currentNSMap=f,d.localNSMap=w,!0;if(l.endElement(et,G,i),w)for(q in w)l.endPrefixMapping(q)}function m(d,l,f,i,w){if(/^(?:script|textarea)$/i.test(f)){var C=d.indexOf("</"+f+">",l),L=d.substring(l+1,C);if(/[&<]/.test(L))return/^script$/i.test(f)?(w.characters(L,0,L.length),C):(L=L.replace(/&#?\w+;/g,i),w.characters(L,0,L.length),C)}return l+1}function y(d,l,f,i){var w=i[f];return w==null&&((w=d.lastIndexOf("</"+f+">"))<l&&(w=d.lastIndexOf("</"+f)),i[f]=w),w<l}function k(d,l){for(var f in d)l[f]=d[f]}function n(d,l,f,i){switch(d.charAt(l+2)){case"-":return d.charAt(l+3)==="-"?(w=d.indexOf("-->",l+4))>l?(f.comment(d,l+4,w-l-4),w+3):(i.error("Unclosed comment"),-1):-1;default:if(d.substr(l+3,6)=="CDATA["){var w=d.indexOf("]]>",l+9);return f.startCDATA(),f.characters(d,l+9,w-l-9),f.endCDATA(),w+3}var C=function(Y,Q){var et,it=[],tt=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(tt.lastIndex=Q,tt.exec(Y);et=tt.exec(Y);)if(it.push(et),et[1])return it}(d,l),L=C.length;if(L>1&&/!doctype/i.test(C[0][0])){var F=C[1][0],W=!1,q=!1;L>3&&(/^public$/i.test(C[2][0])?(W=C[3][0],q=L>4&&C[4][0]):/^system$/i.test(C[2][0])&&(q=C[3][0]));var G=C[L-1];return f.startDTD(F,W,q),f.endDTD(),G.index+G[0].length}}return-1}function e(d,l,f){var i=d.indexOf("?>",l);if(i){var w=d.substring(l,i).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return w?(w[0].length,f.processingInstruction(w[1],w[2]),i+2):-1}return-1}function s(){this.attributeNames={}}h.prototype=new Error,h.prototype.name=h.name,p.prototype={parse:function(d,l,f){var i=this.domBuilder;i.startDocument(),k(l,l={}),function(w,C,L,F,W){function q(X){var $=X.slice(1,-1);return $ in L?L[$]:$.charAt(0)==="#"?function(J){if(J>65535){var ot=55296+((J-=65536)>>10),ut=56320+(1023&J);return String.fromCharCode(ot,ut)}return String.fromCharCode(J)}(parseInt($.substr(1).replace("x","0x"))):(W.error("entity not found:"+X),X)}function G(X){if(X>nt){var $=w.substring(nt,X).replace(/&#?\w+;/g,q);tt&&Y(nt),F.characters($,0,X-nt),nt=X}}function Y(X,$){for(;X>=et&&($=it.exec(w));)Q=$.index,et=Q+$[0].length,tt.lineNumber++;tt.columnNumber=X-Q+1}for(var Q=0,et=0,it=/.*(?:\r\n?|\n)|.*$/g,tt=F.locator,ht=[{currentNSMap:C}],ft={},nt=0;;){try{var ct=w.indexOf("<",nt);if(ct<0){if(!w.substr(nt).match(/^\s*$/)){var yt=F.doc,bt=yt.createTextNode(w.substr(nt));yt.appendChild(bt),F.currentElement=bt}return}switch(ct>nt&&G(ct),w.charAt(ct+1)){case"/":var at=w.indexOf(">",ct+3),dt=w.substring(ct+2,at).replace(/[ \t\n\r]+$/g,""),mt=ht.pop();at<0?(dt=w.substring(ct+2).replace(/[\s<].*/,""),W.error("end tag name: "+dt+" is not complete:"+mt.tagName),at=ct+1+dt.length):dt.match(/\s</)&&(dt=dt.replace(/[\s<].*/,""),W.error("end tag name: "+dt+" maybe not complete"),at=ct+1+dt.length);var Et=mt.localNSMap,vt=mt.tagName==dt;if(vt||mt.tagName&&mt.tagName.toLowerCase()==dt.toLowerCase()){if(F.endElement(mt.uri,mt.localName,dt),Et)for(var o in Et)F.endPrefixMapping(o);vt||W.fatalError("end tag name: "+dt+" is not match the current start tagName:"+mt.tagName)}else ht.push(mt);at++;break;case"?":tt&&Y(ct),at=e(w,ct,F);break;case"!":tt&&Y(ct),at=n(w,ct,F,W);break;default:tt&&Y(ct);var t=new s,c=ht[ht.length-1].currentNSMap,S=(at=b(w,ct,t,c,q,W),t.length);if(!t.closed&&y(w,at,t.tagName,ft)&&(t.closed=!0,L.nbsp||W.warning("unclosed xml attribute")),tt&&S){for(var R=u(tt,{}),z=0;z<S;z++){var U=t[z];Y(U.offset),U.locator=u(tt,{})}F.locator=R,T(t,F,c)&&ht.push(t),F.locator=tt}else T(t,F,c)&&ht.push(t);A.isHTML(t.uri)&&!t.closed?at=m(w,at,t.tagName,q,F):at++}}catch(X){if(X instanceof h)throw X;W.error("element parse error: "+X),at=-1}at>nt?nt=at:G(Math.max(ct,nt)+1)}}(d,l,f,i,this.errorHandler),i.endDocument()}},s.prototype={setTagName:function(d){if(!v.test(d))throw new Error("invalid tagName:"+d);this.tagName=d},addValue:function(d,l,f){if(!v.test(d))throw new Error("invalid attribute:"+d);this.attributeNames[d]=this.length,this[this.length++]={qName:d,value:l,offset:f}},length:0,getLocalName:function(d){return this[d].localName},getLocator:function(d){return this[d].locator},getQName:function(d){return this[d].qName},getURI:function(d){return this[d].uri},getValue:function(d){return this[d].value}},P.XMLReader=p,P.ParseError=h},function(V,P,N){function A(j){return document.createElementNS("http://www.w3.org/2000/svg",j)}Object.defineProperty(P,"__esModule",{value:!0}),P.createElement=A,P.default={createElement:A}},function(V,P,N){function A(v,h){function p(m){for(var y=h.length-1;y>=0;y--){var k=h[y],n=m.clientX,e=m.clientY;if(m.touches&&m.touches.length&&(n=m.touches[0].clientX,e=m.touches[0].clientY),x(k,v,n,e)){k.dispatchEvent(j(m));break}}}if(v.nodeName==="iframe"||v.nodeName==="IFRAME")try{this.target=v.contentDocument}catch{this.target=v}else this.target=v;for(var u=["mouseup","mousedown","click","touchstart"],b=0;b<u.length;b++){var T=u[b];this.target.addEventListener(T,function(m){return p(m)},!1)}}function j(v){var h=Object.assign({},v,{bubbles:!1});try{return new MouseEvent(v.type,h)}catch{var p=document.createEvent("MouseEvents");return p.initMouseEvent(v.type,!1,h.cancelable,h.view,h.detail,h.screenX,h.screenY,h.clientX,h.clientY,h.ctrlKey,h.altKey,h.shiftKey,h.metaKey,h.button,h.relatedTarget),p}}function x(v,h,p,u){var b=h.getBoundingClientRect();function T(n,e,s){var d=n.top-b.top,l=n.left-b.left,f=d+n.height,i=l+n.width;return d<=s&&l<=e&&f>s&&i>e}if(!T(v.getBoundingClientRect(),p,u))return!1;for(var m=v.getClientRects(),y=0,k=m.length;y<k;y++)if(T(m[y],p,u))return!0;return!1}Object.defineProperty(P,"__esModule",{value:!0}),P.proxyMouse=A,P.clone=j,P.default={proxyMouse:A}},function(V,P,N){var A=N(26);V.exports=function(){return A.Date.now()}},function(V,P,N){(function(A){var j=typeof A=="object"&&A&&A.Object===Object&&A;V.exports=j}).call(this,N(17))},function(V,P,N){var A=N(54),j=N(19),x=N(56),v=/^[-+]0x[0-9a-f]+$/i,h=/^0b[01]+$/i,p=/^0o[0-7]+$/i,u=parseInt;V.exports=function(b){if(typeof b=="number")return b;if(x(b))return NaN;if(j(b)){var T=typeof b.valueOf=="function"?b.valueOf():b;b=j(T)?T+"":T}if(typeof b!="string")return b===0?b:+b;b=A(b);var m=h.test(b);return m||p.test(b)?u(b.slice(2),m?2:8):v.test(b)?NaN:+b}},function(V,P,N){var A=N(55),j=/^\s+/;V.exports=function(x){return x&&x.slice(0,A(x)+1).replace(j,"")}},function(V,P){var N=/\s/;V.exports=function(A){for(var j=A.length;j--&&N.test(A.charAt(j)););return j}},function(V,P,N){var A=N(57),j=N(60);V.exports=function(x){return typeof x=="symbol"||j(x)&&A(x)=="[object Symbol]"}},function(V,P,N){var A=N(27),j=N(58),x=N(59),v=A?A.toStringTag:void 0;V.exports=function(h){return h==null?h===void 0?"[object Undefined]":"[object Null]":v&&v in Object(h)?j(h):x(h)}},function(V,P,N){var A=N(27),j=Object.prototype,x=j.hasOwnProperty,v=j.toString,h=A?A.toStringTag:void 0;V.exports=function(p){var u=x.call(p,h),b=p[h];try{p[h]=void 0;var T=!0}catch{}var m=v.call(p);return T&&(u?p[h]=b:delete p[h]),m}},function(V,P){var N=Object.prototype.toString;V.exports=function(A){return N.call(A)}},function(V,P){V.exports=function(N){return N!=null&&typeof N=="object"}}]).default})})(Pt);const Mt=Lt(It),qt=jt({__proto__:null,default:Mt},[It]);export{qt as e};
